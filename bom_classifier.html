j<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BOM –ö–ª–∞—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä - –î–µ—Ç–∞–π–ª–∏ –∏ –ß–∞—Å—Ç–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-assembly-display {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px auto;
            max-width: 800px;
            display: flex;
            align-items: center;
            gap: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .main-assembly-image {
            width: 150px;
            height: 150px;
            object-fit: cover;
            border-radius: 10px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
        }

        .main-assembly-info {
            flex: 1;
            text-align: left;
        }

        .main-assembly-name {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #fff;
        }

        .progress-display {
            text-align: center;
            min-width: 200px;
        }

        .progress-number {
            font-size: 4em;
            font-weight: bold;
            color: #4CAF50;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 5px;
            font-family: 'Arial Black', Arial, sans-serif;
        }

        .progress-label {
            font-size: 1.2em;
            opacity: 0.9;
            color: #fff;
        }

        .progress-details {
            font-size: 1em;
            opacity: 0.8;
            margin-top: 10px;
            color: #fff;
        }

        .main-content {
            display: flex;
            min-height: 70vh;
        }

        .classification-panel {
            flex: 1;
            padding: 30px;
            background: #f8f9fa;
        }

        .results-panel {
            flex: 1;
            padding: 30px;
            background: white;
            border-left: 3px solid #e9ecef;
        }

        .current-item {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .item-image {
            width: 200px;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin: 15px auto;
            display: block;
            border: 3px solid #dee2e6;
            background: #f8f9fa;
        }

        .item-info h3 {
            color: #2c3e50;
            font-size: 1.4em;
            margin-bottom: 10px;
        }

        .item-path {
            color: #6c757d;
            font-size: 0.9em;
            margin-bottom: 15px;
            font-family: monospace;
            background: #f8f9fa;
            padding: 8px;
            border-radius: 5px;
        }

        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .btn-yes {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .btn-no {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .results-section {
            margin-bottom: 30px;
        }

        .results-section h3 {
            color: #2c3e50;
            font-size: 1.3em;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e9ecef;
        }

        .workshop-items {
            border-left: 4px solid #28a745;
        }

        .external-items {
            border-left: 4px solid #dc3545;
        }

        .result-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .result-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 5px;
            border: 2px solid #dee2e6;
        }

        .result-info {
            flex: 1;
        }

        .result-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .result-path {
            font-size: 0.8em;
            color: #6c757d;
            font-family: monospace;
        }

        .progress {
            background: #e9ecef;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.3s ease;
        }

        .stats {
            text-align: center;
            color: #6c757d;
            margin-bottom: 20px;
        }

        .export-btn {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            width: 100%;
            margin-top: 20px;
        }

        .save-btn {
            background: linear-gradient(135deg, #6f42c1, #5a32a3);
            color: white;
            width: 100%;
            margin-top: 20px;
        }

        .save-btn:hover {
            background: linear-gradient(135deg, #5a32a3, #4a2c8a);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(111, 66, 193, 0.3);
        }

        .item-details {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #6c757d;
        }

        .details-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .parts-list, .subassemblies-list {
            margin-bottom: 15px;
        }

        .part-item, .subassembly-item {
            padding: 5px 0;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
        }

        .part-item:last-child, .subassembly-item:last-child {
            border-bottom: none;
        }

        .item-name {
            flex: 1;
            color: #495057;
        }

        .item-quantity {
            font-weight: bold;
            color: #007bff;
        }

        .summary-stats {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 1.1em;
        }

        .stat-label {
            font-weight: bold;
            color: #1976d2;
        }

        .stat-value {
            color: #0d47a1;
        }

        .final-report {
            background: white;
            border-radius: 0;
            padding: 0;
            margin: 20px 0;
            box-shadow: none;
            display: none;
            font-family: Arial, sans-serif;
            page-break-inside: avoid;
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 3px solid #2c5aa0;
            background: #f8f9fa;
        }

        .company-info {
            font-size: 0.9em;
            color: #2c5aa0;
            font-weight: bold;
        }

        .company-logo {
            font-size: 2em;
            font-weight: bold;
            color: #2c5aa0;
            font-family: 'Arial Black', Arial, sans-serif;
        }

        .report-main {
            display: flex;
            min-height: 600px;
        }

        .report-visual {
            flex: 1;
            padding: 20px;
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .main-assembly-visual {
            max-width: 300px;
            max-height: 400px;
            border: 2px solid #2c5aa0;
            border-radius: 10px;
            background: white;
            padding: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .report-tables {
            flex: 1;
            padding: 20px;
            background: white;
        }

        .report-title {
            font-size: 1.5em;
            color: #2c5aa0;
            text-align: center;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .classification-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            border: 2px solid #2c5aa0;
        }

        .classification-table th {
            background: #2c5aa0;
            color: white;
            padding: 8px;
            text-align: center;
            font-weight: bold;
            border: 1px solid #2c5aa0;
        }

        .classification-table td {
            padding: 6px;
            border: 1px solid #2c5aa0;
            text-align: center;
            font-size: 0.9em;
        }

        .workshop-row {
            background: #d4edda;
        }

        .external-row {
            background: #f8d7da;
        }

        .table-section {
            margin-bottom: 30px;
        }

        .section-header {
            background: #2c5aa0;
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .section-icon {
            font-size: 1.5em;
        }

        .parts-table {
            width: 100%;
            border-collapse: collapse;
            border: 2px solid #6c757d;
            font-size: 0.85em;
        }

        .parts-table th {
            background: #6c757d;
            color: white;
            padding: 6px;
            text-align: center;
            border: 1px solid #6c757d;
        }

        .parts-table td {
            padding: 4px 6px;
            border: 1px solid #6c757d;
            text-align: center !important;
        }

        .qty-column {
            text-align: center !important;
            font-weight: bold;
            width: 60px;
        }

        .report-section {
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.4em;
            color: #34495e;
            margin-bottom: 15px;
            padding: 10px;
            background: linear-gradient(135deg, #ecf0f1, #bdc3c7);
            border-radius: 8px;
        }

        .assembly-report-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            border-left: 5px solid;
        }

        .workshop-assembly {
            border-left-color: #28a745;
        }

        .external-assembly {
            border-left-color: #dc3545;
        }

        .assembly-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .assembly-path {
            font-size: 0.9em;
            color: #6c757d;
            margin-bottom: 15px;
            font-family: monospace;
        }

        .parts-summary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .parts-column h4 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .print-btn {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
            margin-top: 10px;
            width: 100%;
        }

        .auto-classification-info {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            font-size: 0.9em;
            color: #856404;
        }

        .auto-classification-info::before {
            content: "‚ö° ";
            font-weight: bold;
        }

        .skip-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ffc107;
            color: #212529;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .current-item {
            position: relative;
        }

        .hidden {
            display: none;
        }

        .file-input {
            margin: 20px 0;
            text-align: center;
        }

        .file-input input[type="file"] {
            margin: 10px;
            padding: 10px;
            border: 2px dashed #ccc;
            border-radius: 5px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .completed {
            text-align: center;
            padding: 40px;
            color: #28a745;
        }

        /* Image Tooltip Styles */
        .image-tooltip {
            position: relative;
            cursor: pointer;
            color: #007bff;
            text-decoration: underline;
        }

        .image-tooltip:hover {
            color: #0056b3;
        }

        .tooltip-image {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: none;
            padding: 0;
            border-radius: 0;
            box-shadow: none;
            border: none;
            z-index: 1000;
            display: none;
            width: 500px;
            height: 375px;
            pointer-events: none;
        }

        /* –ê–ª—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–∞–Ω–µ –∑–∞ tooltip-–∏ –±–ª–∏–∑–æ –¥–æ –∫—Ä–∞–∏—â–∞—Ç–∞ */
        .tooltip-image.left-aligned {
            left: 0;
            transform: translateX(0);
        }

        .tooltip-image.right-aligned {
            left: auto;
            right: 0;
            transform: translateX(0);
        }

        .tooltip-image img {
            width: 100%;
            height: 100%;
            border-radius: 6px;
            object-fit: cover;
            border: 2px solid #007bff;
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .tooltip-image::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: #007bff;
        }

        /* Modal Styles */
        .image-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            position: relative;
            background-color: white;
            margin: 2% auto;
            padding: 0;
            border-radius: 8px;
            width: 85%;
            max-width: 1200px;
            max-height: 90vh;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 12px 16px;
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.1em;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
        }

        .modal-body {
            padding: 15px;
            text-align: center;
            overflow: hidden;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-grow: 1;
        }

        .modal-body img {
            width: 100%;
            height: auto;
            max-height: calc(90vh - 80px);
            border-radius: 6px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            object-fit: contain;
            display: block;
        }

        .no-image {
            color: #6c757d;
            font-style: italic;
            padding: 40px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Color Selection Styles */
        .color-section {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #6f42c1;
        }

        .color-section h4 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 16px;
        }

        .ral-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .ral-option {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .ral-option label {
            font-weight: bold;
            color: #495057;
            font-size: 14px;
        }

        .ral-option select {
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
            background: white;
        }

        .ral-option select:focus {
            outline: none;
            border-color: #6f42c1;
            box-shadow: 0 0 0 2px rgba(111, 66, 193, 0.2);
        }

        .btn-color {
            background: linear-gradient(135deg, #6f42c1, #5a32a3);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
            transition: all 0.2s ease;
        }

        .btn-color:hover {
            background: linear-gradient(135deg, #5a32a3, #4a2c8a);
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(111, 66, 193, 0.3);
        }

        .color-hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß –ö–ª–∞—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –Ω–∞ –î–µ—Ç–∞–π–ª–∏ –∏ –ß–∞—Å—Ç–∏</h1>
            <p>–ö–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ –¥–µ—Ç–∞–π–ª–∏ –∏ —á–∞—Å—Ç–∏ - –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –∏–ª–∏ –ó–∞–∫—É–ø—É–≤–∞–Ω–µ</p>
            
            <div id="mainAssemblyDisplay" class="main-assembly-display hidden">
                <img id="mainAssemblyImage" class="main-assembly-image" src="" alt="–ì–ª–∞–≤–Ω–∞ —Å–±–æ—Ä–∫–∞" />
                <div class="main-assembly-info">
                    <div class="main-assembly-name" id="mainAssemblyName">–ì–ª–∞–≤–Ω–∞ —Å–±–æ—Ä–∫–∞</div>
                    <div class="progress-details">
                        <div>–û–±—Ä–∞–±–æ—Ç–µ–Ω–∏: <span id="processedCount">0</span></div>
                        <div>–û–±—â–æ —Å–±–æ—Ä–∫–∏: <span id="totalAssemblies">0</span></div>
                    </div>
                </div>
                <div class="progress-display">
                    <div class="progress-number" id="progressPercent">0%</div>
                    <div class="progress-label">–ó–∞–≤—ä—Ä—à–µ–Ω–æ</div>
                </div>
            </div>
        </div>

        <div class="file-input">
            <label for="bomFile">–ò–∑–±–µ—Ä–µ—Ç–µ BOM —Ñ–∞–π–ª (JSON –∏–ª–∏ CSV):</label>
            <input type="file" id="bomFile" accept=".json,.csv" />
            <button onclick="loadBOM()" class="btn" style="background: #007bff; color: white;">–ó–∞—Ä–µ–¥–∏ BOM</button>
        </div>

        <!-- –î–æ–±–∞–≤—è–º–µ —Ç–∞–±–ª–∏—Ü–∞ —Å –æ–±–æ–±—â–µ–Ω–∏–µ -->
        <div id="summaryTable" class="hidden" style="margin: 20px 0;">
            <h3>üìä –û–±–æ–±—â–µ–Ω–∏–µ –Ω–∞ –∞—Å–µ–º–±–ª–∏—Ç–∞—Ç–∞</h3>
            <table style="width: 100%; border-collapse: collapse; border: 1px solid #ddd;">
                <thead style="background: #4472C4; color: white;">
                    <tr>
                        <th style="border: 1px solid #ddd; padding: 10px; width: 120px;">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                        <th style="border: 1px solid #ddd; padding: 10px; width: 60px;">‚Ññ</th>
                        <th style="border: 1px solid #ddd; padding: 10px;">–ò–º–µ –Ω–∞ —Å–±–æ—Ä–∫–∞—Ç–∞</th>
                        <th style="border: 1px solid #ddd; padding: 10px; width: 80px;">–ë—Ä–æ–π</th>
                        <th style="border: 1px solid #ddd; padding: 10px; width: 60px;">‚úì</th>
                    </tr>
                </thead>
                <tbody id="summaryTableBody">
                    <!-- –†–µ–¥–æ–≤–µ—Ç–µ —â–µ —Å–µ –≥–µ–Ω–µ—Ä–∏—Ä–∞—Ç –¥–∏–Ω–∞–º–∏—á–Ω–æ -->
                </tbody>
            </table>
            <div style="text-align: center; margin-top: 15px;">
                <button onclick="startClassification()" class="btn" style="background: #28a745; color: white; padding: 12px 30px; font-size: 1.1em;">
                    üöÄ –ó–∞–ø–æ—á–Ω–∏ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ –∞—Å–µ–º–±–ª–∏—Ç–∞—Ç–∞
                </button>
            </div>
        </div>

        <div class="main-content">
            <div class="classification-panel">
                <div id="loadingMessage" class="loading">
                    –ú–æ–ª—è, –∑–∞—Ä–µ–¥–µ—Ç–µ BOM —Ñ–∞–π–ª –∑–∞ –¥–∞ –∑–∞–ø–æ—á–Ω–µ—Ç–µ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è—Ç–∞ –Ω–∞ –¥–µ—Ç–∞–π–ª–∏ –∏ —á–∞—Å—Ç–∏...
                </div>

                <div id="classificationArea" class="hidden">
                    <div class="stats">
                        –ü—Ä–æ–≥—Ä–µ—Å: <span id="currentIndex">0</span> –æ—Ç <span id="totalItems">0</span>
                    </div>
                    <div class="progress">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>

                    <div class="current-item">
                        <div class="item-info">
                            <h3 id="currentName">–ò–º–µ –Ω–∞ —Å–±–æ—Ä–∫–∞—Ç–∞</h3>
                            <div class="item-path" id="currentPath">–ü—ä—Ç –∫—ä–º —Å–±–æ—Ä–∫–∞—Ç–∞</div>
                        </div>
                        <img id="currentImage" class="item-image" src="" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ —Å–±–æ—Ä–∫–∞—Ç–∞" />
                        
                        <div id="itemDetails" class="item-details">
                            <div class="summary-stats">
                                <div class="stat-row">
                                    <span class="stat-label">–û–±—â–æ –¥–µ—Ç–∞–π–ª–∏:</span>
                                    <span class="stat-value" id="partsCount">0</span>
                                </div>
                                <div class="stat-row">
                                    <span class="stat-label">–ü–æ–¥–∞—Å–µ–º–±–ª–∏—Ç–∞:</span>
                                    <span class="stat-value" id="subAssembliesCount">0</span>
                                </div>
                            </div>
                            
                            <div id="partsList" class="parts-list"></div>
                            <div id="subAssembliesList" class="subassemblies-list"></div>
                        </div>
                        
                        <div class="buttons">
                            <button class="btn btn-yes" onclick="classifyItem(true)">
                                ‚úÖ –î–ê - –°–≥–ª–æ–±—è–≤–∞ —Å–µ –≤ —Ü–µ—Ö–∞
                            </button>
                            <button class="btn btn-no" onclick="classifyItem(false)">
                                ‚ùå –ù–ï - –°–≥–ª–æ–±—è–≤–∞ —Å–µ –Ω–∞ –æ–±–µ–∫—Ç–∞
                            </button>
                        </div>
                    </div>
                </div>

                <div id="completedMessage" class="completed hidden">
                    <h2>üéâ –ö–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è—Ç–∞ –µ –∑–∞–≤—ä—Ä—à–µ–Ω–∞!</h2>
                    <p>–í—Å–∏—á–∫–∏ —Å–±–æ—Ä–∫–∏ —Å–∞ –æ–±—Ä–∞–±–æ—Ç–µ–Ω–∏ —É—Å–ø–µ—à–Ω–æ.</p>
                </div>
            </div>

            <div class="results-panel">
                <div class="results-section workshop-items">
                    <h3>üè≠ –°–≥–ª–æ–±—è–≤–∞ —Å–µ –≤ —Ü–µ—Ö–∞ (<span id="workshopCount">0</span>)</h3>
                    <div id="workshopList"></div>
                </div>

                <div class="results-section external-items">
                    <h3>üèóÔ∏è –°–≥–ª–æ–±—è–≤–∞ —Å–µ –Ω–∞ –æ–±–µ–∫—Ç–∞ (<span id="externalCount">0</span>)</h3>
                    <div id="externalList"></div>
                </div>

                <button class="btn export-btn" onclick="exportResults()">
                    üìä –ï–∫—Å–ø–æ—Ä—Ç –Ω–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ
                </button>
                
                <button class="btn btn-color" onclick="openColorModal()" style="margin-top: 10px;">
                    üé® –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ RAL —Ü–≤–µ—Ç–æ–≤–µ
                </button>
                
                <button class="btn export-btn" onclick="showFinalReport()" style="background: linear-gradient(135deg, #28a745, #20c997); margin-top: 10px;">
                    üìã –ü–æ–∫–∞–∂–∏ —Ñ–∏–Ω–∞–ª–µ–Ω –æ—Ç—á–µ—Ç
                </button>
            </div>
        </div>

        <!-- –§–∏–Ω–∞–ª–µ–Ω –æ—Ç—á–µ—Ç -->
        <div id="finalReport" class="final-report">
            <!-- –ó–∞–≥–ª–∞–≤–∏–µ —Å –ª–æ–≥–æ -->
            <div class="report-header">
                <div class="company-info">
                    –≥—Ä. –†—É—Å–µ<br>
                    —Ç–µ–ª. 082 888 777<br>
                    email: office@company.bg
                </div>
                <div class="company-logo">TREZ</div>
            </div>

            <!-- –ì–ª–∞–≤–Ω–∞ —Å–µ–∫—Ü–∏—è -->
            <div class="report-main">
                <!-- –í–∏–∑—É–∞–ª–Ω–∞ —Å–µ–∫—Ü–∏—è -->
                <div class="report-visual">
                    <div class="report-title" id="reportMainTitle">–°–±–æ—Ä–∫–∞ + –ö–∞–±–∏–Ω–∞</div>
                    <img id="reportMainImage" class="main-assembly-visual" src="" alt="–ì–ª–∞–≤–Ω–∞ —Å–±–æ—Ä–∫–∞"/>
                    <div style="margin-top: 20px; font-size: 2em; color: #2c5aa0; font-weight: bold;">
                        –û–±–µ–∫—Ç <span id="reportObjectNumber">454</span>
                    </div>
                </div>

                <!-- –¢–∞–±–ª–∏—Ü–∏ —Å–µ–∫—Ü–∏—è -->
                <div class="report-tables">
                    <!-- –ö–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü–∞ -->
                    <table class="classification-table">
                        <thead>
                            <tr>
                                <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                <th>‚Ññ</th>
                                <th>–ò–º–µ –Ω–∞ —Å–±–æ—Ä–∫–∞—Ç–∞</th>
                                <th>–ë—Ä–æ–π</th>
                                <th>‚úì</th>
                            </tr>
                        </thead>
                        <tbody id="classificationTableBody">
                        </tbody>
                    </table>

                    <!-- –¶–µ—Ö–æ–≤–∏ –¥–µ—Ç–∞–π–ª–∏ -->
                    <div class="table-section">
                        <div class="section-header workshop-row">
                            <span class="section-icon">üè≠</span>
                            <span>–î–µ—Ç–∞–π–ª–∏ –∑–∞ —Ü–µ—Ö–æ–≤–æ —Å–≥–ª–æ–±—è–≤–∞–Ω–µ</span>
                        </div>
                        <table class="parts-table">
                            <thead>
                                <tr>
                                    <th>‚Ññ</th>
                                    <th>–ò–º–µ –Ω–∞ –¥–µ—Ç–∞–π–ª–∞</th>
                                    <th>–ë—Ä–æ–π</th>
                                </tr>
                            </thead>
                            <tbody id="workshopPartsTable">
                            </tbody>
                        </table>
                    </div>

                    <!-- –í—ä–Ω—à–Ω–∏ –¥–µ—Ç–∞–π–ª–∏ -->
                    <div class="table-section">
                        <div class="section-header external-row">
                            <span class="section-icon">üöö</span>
                            <span>–î–µ—Ç–∞–π–ª–∏ –∑–∞ –≤—ä–Ω—à–Ω–æ —Å–≥–ª–æ–±—è–≤–∞–Ω–µ</span>
                        </div>
                        <table class="parts-table">
                            <thead>
                                <tr>
                                    <th>‚Ññ</th>
                                    <th>–ò–º–µ –Ω–∞ –¥–µ—Ç–∞–π–ª–∞</th>
                                    <th>–ë—Ä–æ–π</th>
                                </tr>
                            </thead>
                            <tbody id="externalPartsTable">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –ù–æ–º–µ—Ä –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
            <div style="text-align: center; padding: 10px; color: #6c757d; border-top: 1px solid #dee2e6;">
                1
            </div>

            <div style="margin-top: 20px; text-align: center;">
                <button class="btn print-btn" onclick="printReport()">
                    üñ®Ô∏è –ü—Ä–∏–Ω—Ç–∏—Ä–∞–π –æ—Ç—á–µ—Ç–∞
                </button>
                
                <button class="btn export-btn" onclick="exportDetailedResults()">
                    üìä –ï–∫—Å–ø–æ—Ä—Ç –Ω–∞ –ø–æ–¥—Ä–æ–±–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏
                </button>
                
                <button class="btn save-btn" onclick="saveClassifications()">
                    üíæ –ó–∞–ø–∞–∑–∏ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏—Ç–µ –≤ JSON
                </button>
            </div>
        </div>
    </div>

    <script>
        let bomData = [];
        let allItemsData = []; // –í—Å–∏—á–∫–∏ –µ–ª–µ–º–µ–Ω—Ç–∏ –≤–∫–ª—é—á–∏—Ç–µ–ª–Ω–æ —á–∞—Å—Ç–∏
        let currentIndex = 0;
        let workshopItems = [];
        let externalItems = [];
        let workshopPaths = new Set(); // –ü—ä—Ç–∏—â–∞ –Ω–∞ —Å–±–æ—Ä–∫–∏ –∫–ª–∞—Å–∏—Ñ–∏—Ü–∏—Ä–∞–Ω–∏ –∑–∞ —Ü–µ—Ö
        let externalPaths = new Set(); // –ü—ä—Ç–∏—â–∞ –Ω–∞ —Å–±–æ—Ä–∫–∏ –∫–ª–∞—Å–∏—Ñ–∏—Ü–∏—Ä–∞–Ω–∏ –∫–∞—Ç–æ –≤—ä–Ω—à–Ω–∏

        // –†–µ—á–Ω–∏–∫ –∑–∞ –ø—Ä–µ–≤–æ–¥ –æ—Ç –∞–Ω–≥–ª–∏–π—Å–∫–∏/–Ω–µ–º—Å–∫–∏ –Ω–∞ –±—ä–ª–≥–∞—Ä—Å–∫–∏
        const translationDictionary = {
            // –û—Å–Ω–æ–≤–Ω–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏
            'Komplekt': '–ö–æ–º–ø–ª–µ–∫—Ç',
            'komplekt': '–∫–æ–º–ø–ª–µ–∫—Ç',
            'Bufer': '–ë—É—Ñ–µ—Ä', 
            'bufer': '–±—É—Ñ–µ—Ä',
            'Planka': '–ü–ª–∞–Ω–∫–∞',
            'planka': '–ø–ª–∞–Ω–∫–∞',
            'Anker': '–ê–Ω–∫–µ—Ä',
            'anker': '–∞–Ω–∫–µ—Ä', 
            'Pizzato': '–ü–∏–∑–∞—Ç–æ',
            'pizzato': '–ø–∏–∑–∞—Ç–æ',
            'Reze': '–†–µ–∑–µ',
            'reze': '—Ä–µ–∑–µ',
            'Chast': '–ß–∞—Å—Ç',
            'chast': '—á–∞—Å—Ç',
            'Service': '–°–µ—Ä–≤–∏–∑',
            'service': '—Å–µ—Ä–≤–∏–∑',
            
            // –í–∏–Ω—Ç–æ–≤–µ –∏ –∫—Ä–µ–ø–µ–∂–∏ - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏ —Ä–∞–∑–º–µ—Ä–∏
            'M4x16': '–ú4—Ö16',
            'M4x35': '–ú4—Ö35', 
            'M8x20': '–ú8—Ö20',
            'M10x80': '–ú10—Ö80',
            'M12x30': '–ú12—Ö30',
            
            // –û–±—â–∏ –¥—É–º–∏
            'ALL': '–í–°–ò–ß–ö–ò',
            'GE': '–ì–ï',
            'ot': '–æ—Ç'
        };

        // –§—É–Ω–∫—Ü–∏—è –∑–∞ –ø—Ä–µ–≤–æ–¥ –Ω–∞ –∏–º–µ–Ω–∞
        function translateName(name) {
            let translatedName = name;
            
            // –ü—Ä–µ–≤–æ–¥–∏–º –≤—Å—è–∫–∞ –¥—É–º–∞ –æ—Ç —Ä–µ—á–Ω–∏–∫–∞
            Object.keys(translationDictionary).forEach(englishWord => {
                const bulgarianWord = translationDictionary[englishWord];
                // –ò–∑–ø–æ–ª–∑–≤–∞–º–µ —Ä–µ–≥—É–ª—è—Ä–µ–Ω –∏–∑—Ä–∞–∑ –∑–∞ –¥–∞ –∑–∞–º–µ–Ω–∏–º —Ü—è–ª–∞—Ç–∞ –¥—É–º–∞ (–Ω–µ —á–∞—Å—Ç –æ—Ç –¥—Ä—É–≥–∞ –¥—É–º–∞)
                const regex = new RegExp('\\b' + englishWord.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + '\\b', 'g');
                translatedName = translatedName.replace(regex, bulgarianWord);
            });
            
            return translatedName;
        }

        // –û–±—âa —Ñ—É–Ω–∫—Ü–∏—è –∑–∞ —Å–æ—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –∏–º–µ–Ω–∞ (—á–∏—Å–ª–∞ –ø—ä—Ä–≤–æ, –ø–æ—Å–ª–µ –±—É–∫–≤–∏ –∞–∑–±—É—á–Ω–æ)
        function sortByName(items, nameProperty = 'name') {
            return items.sort((a, b) => {
                const nameA = a[nameProperty].toLowerCase();
                const nameB = b[nameProperty].toLowerCase();
                
                // –ü—Ä–æ–≤–µ—Ä—è–≤–∞–º–µ –¥–∞–ª–∏ –∏–º–µ–Ω–∞—Ç–∞ –∑–∞–ø–æ—á–≤–∞—Ç —Å —á–∏—Å–ª–∞
                const startsWithNumberA = /^\d/.test(nameA);
                const startsWithNumberB = /^\d/.test(nameB);
                
                // –ê–∫–æ –∏ –¥–≤–µ—Ç–µ –∑–∞–ø–æ—á–≤–∞—Ç —Å —á–∏—Å–ª–∞
                if (startsWithNumberA && startsWithNumberB) {
                    // –ò–∑–≤–ª–∏—á–∞–º–µ —á–∏—Å–ª–æ–≤–∞—Ç–∞ —á–∞—Å—Ç
                    const numberA = parseInt(nameA.match(/^\d+/)[0]);
                    const numberB = parseInt(nameB.match(/^\d+/)[0]);
                    
                    // –°—Ä–∞–≤–Ω—è–≤–∞–º–µ —á–∏—Å–ª–∞—Ç–∞
                    if (numberA !== numberB) {
                        return numberA - numberB;
                    }
                    // –ê–∫–æ —á–∏—Å–ª–∞—Ç–∞ —Å–∞ –µ–¥–Ω–∞–∫–≤–∏, —Å—Ä–∞–≤–Ω—è–≤–∞–º–µ —Ü–µ–ª–∏—Ç–µ –∏–º–µ–Ω–∞
                    return nameA.localeCompare(nameB);
                }
                
                // –ê–∫–æ —Å–∞–º–æ –µ–¥–Ω–æ—Ç–æ –∑–∞–ø–æ—á–≤–∞ —Å —á–∏—Å–ª–æ, —Ç–æ –µ –ø—ä—Ä–≤–æ
                if (startsWithNumberA && !startsWithNumberB) {
                    return -1;
                }
                if (!startsWithNumberA && startsWithNumberB) {
                    return 1;
                }
                
                // –ò –¥–≤–µ—Ç–µ –∑–∞–ø–æ—á–≤–∞—Ç —Å –±—É–∫–≤–∏ - —Å–æ—Ä—Ç–∏—Ä–∞–º–µ –∞–∑–±—É—á–Ω–æ
                return nameA.localeCompare(nameB, 'bg', { numeric: true });
            });
        }

        function unifyAssemblies(assemblies) {
            const unifiedAssemblies = new Map();
            
            assemblies.forEach((assembly, index) => {
                // –ü—Ä–µ–º–∞—Ö–≤–∞–º–µ <1>, <2> –∏ —Ç.–Ω. –æ—Ç –∏–º–µ—Ç–æ –Ω–∞ –∞—Å–µ–º–±–ª–∏—Ç–æ
                const cleanName = assembly.name.replace(/<\d+>$/, '').trim();
                console.log(`–û–±—Ä–∞–±–æ—Ç–≤–∞–º –∞—Å–µ–º–±–ª–∏ ${index + 1}: "${assembly.name}" ‚Üí "${cleanName}", –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${assembly.quantity}`);
                
                if (unifiedAssemblies.has(cleanName)) {
                    // –ê–∫–æ –∞—Å–µ–º–±–ª–∏—Ç–æ –≤–µ—á–µ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞, —É–≤–µ–ª–∏—á–∞–≤–∞–º–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ—Ç–æ –º—É
                    const existingAssembly = unifiedAssemblies.get(cleanName);
                    const oldQuantity = existingAssembly.quantity;
                    existingAssembly.quantity += assembly.quantity || 1;
                    console.log(`  ‚Üí –û–±–µ–¥–∏–Ω—è–≤–∞–º —Å —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â–æ: ${oldQuantity} + ${assembly.quantity} = ${existingAssembly.quantity}`);
                    
                    // –û–±–µ–¥–∏–Ω—è–≤–∞–º–µ —á–∞—Å—Ç–∏—Ç–µ - –æ–±–µ–¥–∏–Ω—è–≤–∞–º–µ –ø–æ –∏–º–µ –∏ —Å—É–º–∏—Ä–∞–º–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞—Ç–∞
                    if (assembly.parts && assembly.parts.length > 0) {
                        assembly.parts.forEach(part => {
                            const cleanPartName = part.name.replace(/<\d+>$/, '').trim();
                            const existingPart = existingAssembly.parts.find(p => 
                                p.name.replace(/<\d+>$/, '').trim() === cleanPartName
                            );
                            if (existingPart) {
                                existingPart.quantity += part.quantity || 1;
                                existingPart.name = cleanPartName;
                            } else {
                                existingAssembly.parts.push({
                                    ...part,
                                    name: cleanPartName
                                });
                            }
                        });
                    }
                    
                    // –û–±–µ–¥–∏–Ω—è–≤–∞–º–µ –ø–æ–¥–∞—Å–µ–º–±–ª–∏—Ç–∞—Ç–∞
                    if (assembly.subAssemblies && assembly.subAssemblies.length > 0) {
                        assembly.subAssemblies.forEach(subAsm => {
                            const cleanSubName = subAsm.name.replace(/<\d+>$/, '').trim();
                            const existingSubAsm = existingAssembly.subAssemblies.find(s => 
                                s.name.replace(/<\d+>$/, '').trim() === cleanSubName
                            );
                            if (existingSubAsm) {
                                existingSubAsm.quantity += subAsm.quantity || 1;
                                existingSubAsm.name = cleanSubName;
                            } else {
                                existingAssembly.subAssemblies.push({
                                    ...subAsm,
                                    name: cleanSubName
                                });
                            }
                        });
                    }
                } else {
                    // –°—ä–∑–¥–∞–≤–∞–º–µ –Ω–æ–≤–æ –∞—Å–µ–º–±–ª–∏ —Å –ø–æ—á–∏—Å—Ç–µ–Ω–æ –∏–º–µ
                    console.log(`  ‚Üí –°—ä–∑–¥–∞–≤–∞–º –Ω–æ–≤–æ –∞—Å–µ–º–±–ª–∏: "${cleanName}", –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${assembly.quantity || 1}`);
                    const newAssembly = {
                        ...assembly,
                        name: cleanName,
                        originalName: assembly.name,
                        quantity: assembly.quantity || 1, // –í–∞–∂–Ω–æ: –∑–∞–ø–∞–∑–≤–∞–º–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ—Ç–æ
                        parts: assembly.parts ? assembly.parts.map(part => ({
                            ...part,
                            name: part.name.replace(/<\d+>$/, '').trim()
                        })) : [],
                        subAssemblies: assembly.subAssemblies ? assembly.subAssemblies.map(sub => ({
                            ...sub,
                            name: sub.name.replace(/<\d+>$/, '').trim()
                        })) : []
                    };
                    unifiedAssemblies.set(cleanName, newAssembly);
                }
            });
            
            const result = Array.from(unifiedAssemblies.values());
            console.log('–†–µ–∑—É–ª—Ç–∞—Ç –æ—Ç –æ–±–µ–¥–∏–Ω—è–≤–∞–Ω–µ:');
            result.forEach((asm, index) => {
                console.log(`${index + 1}. "${asm.name}" - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${asm.quantity}`);
            });
            
            return result;
        }

        function showSummaryTable() {
            const tableBody = document.getElementById('summaryTableBody');
            const summaryDiv = document.getElementById('summaryTable');
            
            tableBody.innerHTML = '';
            
            // –°–æ—Ä—Ç–∏—Ä–∞–º–µ –∞—Å–µ–º–±–ª–∏—Ç–∞—Ç–∞ –ø—Ä–µ–¥–∏ –ø–æ–∫–∞–∑–≤–∞–Ω–µ
            const sortedBomData = sortByName([...bomData]);
            
            sortedBomData.forEach((assembly, index) => {
                const row = document.createElement('tr');
                row.style.backgroundColor = index % 2 === 0 ? '#E7F3E7' : '#F0F8F0';
                
                // –ö–∞—Ç–µ–≥–æ—Ä–∏—è –∫–æ–ª–æ–Ω–∞ (—Å—ä—Å –∑–µ–ª–µ–Ω —Ñ–æ–Ω)
                const categoryCell = document.createElement('td');
                categoryCell.style.cssText = 'background: #70AD47; color: white; text-align: center; padding: 8px; border: 1px solid #ddd; font-weight: bold;';
                categoryCell.rowSpan = 1; // –ó–∞ —Å–µ–≥–∞ –≤—Å—è–∫–æ –∞—Å–µ–º–±–ª–∏ –µ –æ—Ç–¥–µ–ª–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è
                categoryCell.innerHTML = '<div style="writing-mode: vertical-lr; text-orientation: mixed;">–¶–ï–•</div>';
                
                // –ù–æ–º–µ—Ä
                const numberCell = document.createElement('td');
                numberCell.style.cssText = 'border: 1px solid #ddd; padding: 8px; text-align: center;';
                numberCell.textContent = index + 1;
                
                // –ò–º–µ –Ω–∞ —Å–±–æ—Ä–∫–∞—Ç–∞ —Å –±—É—Ç–æ–Ω –∑–∞ —Ä–∞–∑–≥—Ä—ä—â–∞–Ω–µ
                const nameCell = document.createElement('td');
                nameCell.style.cssText = 'border: 1px solid #ddd; padding: 8px; text-align: left;';
                
                // –°—ä–∑–¥–∞–≤–∞–º–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞ –∏–º–µ—Ç–æ –∏ –±—É—Ç–æ–Ω–∞
                const nameContainer = document.createElement('div');
                nameContainer.style.cssText = 'display: flex; align-items: center; justify-content: space-between;';
                
                const nameSpan = document.createElement('span');
                nameSpan.innerHTML = createImageTooltip(translateName(assembly.name), assembly.imagePath);
                
                const expandButton = document.createElement('button');
                expandButton.innerHTML = '+';
                expandButton.style.cssText = 'background: #28a745; color: white; border: none; width: 25px; height: 25px; border-radius: 50%; cursor: pointer; font-weight: bold; margin-left: 10px;';
                expandButton.onclick = () => toggleAssemblyDetails(index, assembly);
                
                nameContainer.appendChild(nameSpan);
                nameContainer.appendChild(expandButton);
                nameCell.appendChild(nameContainer);
                
                // –ë—Ä–æ–π
                const quantityCell = document.createElement('td');
                quantityCell.style.cssText = 'border: 1px solid #ddd; padding: 8px; text-align: center; font-weight: bold;';
                quantityCell.textContent = assembly.quantity || 1;
                
                // –ß–µ–∫–±–æ–∫—Å
                const checkCell = document.createElement('td');
                checkCell.style.cssText = 'border: 1px solid #ddd; padding: 8px; text-align: center; color: #70AD47; font-size: 18px;';
                checkCell.innerHTML = '‚úì';
                
                row.appendChild(categoryCell);
                row.appendChild(numberCell);
                row.appendChild(nameCell);
                row.appendChild(quantityCell);
                row.appendChild(checkCell);
                
                tableBody.appendChild(row);
                
                // –î–æ–±–∞–≤—è–º–µ —Å–∫—Ä–∏—Ç —Ä–µ–¥ —Å –¥–µ—Ç–∞–π–ª–∏—Ç–µ
                const detailsRow = document.createElement('tr');
                detailsRow.id = `details-row-${index}`;
                detailsRow.style.display = 'none';
                detailsRow.innerHTML = `
                    <td colspan="5" style="padding: 0; border: 1px solid #ddd;">
                        <div id="details-content-${index}" style="padding: 15px; background: #f8f9fa;">
                            <!-- –î–µ—Ç–∞–π–ª–∏—Ç–µ —â–µ —Å–µ –∑–∞—Ä–µ–∂–¥–∞—Ç –¥–∏–Ω–∞–º–∏—á–Ω–æ -->
                        </div>
                    </td>
                `;
                tableBody.appendChild(detailsRow);
            });
            
            summaryDiv.classList.remove('hidden');
        }

        function toggleAssemblyDetails(assemblyIndex, assembly) {
            const detailsRow = document.getElementById(`details-row-${assemblyIndex}`);
            const detailsContent = document.getElementById(`details-content-${assemblyIndex}`);
            const button = event.target;
            
            if (detailsRow.style.display === 'none') {
                // –ü–æ–∫–∞–∑–≤–∞–º–µ –¥–µ—Ç–∞–π–ª–∏—Ç–µ
                detailsRow.style.display = 'table-row';
                button.innerHTML = '‚àí';
                button.style.background = '#dc3545';
                
                // –ó–∞—Ä–µ–∂–¥–∞–º–µ –¥–µ—Ç–∞–π–ª–∏—Ç–µ (–ø–æ–¥–∞–≤–∞–º–µ –¥–∏—Ä–µ–∫—Ç–Ω–æ assembly –æ–±–µ–∫—Ç–∞)
                loadAssemblyDetails(assembly, detailsContent);
            } else {
                // –°–∫—Ä–∏–≤–∞–º–µ –¥–µ—Ç–∞–π–ª–∏—Ç–µ
                detailsRow.style.display = 'none';
                button.innerHTML = '+';
                button.style.background = '#28a745';
            }
        }

        function loadAssemblyDetails(assembly, container) {
            const parts = assembly.parts || [];
            const subAssemblies = assembly.subAssemblies || [];
            
            // –û–±–µ–¥–∏–Ω—è–≤–∞–º–µ —á–∞—Å—Ç–∏—Ç–µ
            const unifiedParts = new Map();
            parts.forEach(part => {
                const cleanName = part.name.replace(/<\d+>/g, '').trim();
                if (unifiedParts.has(cleanName)) {
                    unifiedParts.set(cleanName, {
                        name: cleanName,
                        quantity: unifiedParts.get(cleanName).quantity + part.quantity,
                        imagePath: unifiedParts.get(cleanName).imagePath || part.imagePath // –ó–∞–ø–∞–∑–≤–∞–º–µ –ø—ä—Ä–≤–∏—è imagePath
                    });
                } else {
                    unifiedParts.set(cleanName, {
                        name: cleanName,
                        quantity: part.quantity,
                        imagePath: part.imagePath
                    });
                }
            });
            
            // –û–±–µ–¥–∏–Ω—è–≤–∞–º–µ –ø–æ–¥–∞—Å–µ–º–±–ª–∏—Ç–∞—Ç–∞
            const unifiedSubAssemblies = new Map();
            subAssemblies.forEach(subAssembly => {
                const cleanName = subAssembly.name.replace(/<\d+>/g, '').trim();
                if (unifiedSubAssemblies.has(cleanName)) {
                    unifiedSubAssemblies.set(cleanName, {
                        name: cleanName,
                        quantity: unifiedSubAssemblies.get(cleanName).quantity + subAssembly.quantity,
                        imagePath: unifiedSubAssemblies.get(cleanName).imagePath || subAssembly.imagePath
                    });
                } else {
                    unifiedSubAssemblies.set(cleanName, {
                        name: cleanName,
                        quantity: subAssembly.quantity,
                        imagePath: subAssembly.imagePath
                    });
                }
            });
            
            let html = '<div style="display: flex; gap: 30px;">';
            
            // –î–µ—Ç–∞–π–ª–∏ –∫–æ–ª–æ–Ω–∞
            if (unifiedParts.size > 0) {
                html += '<div style="flex: 1;"><h4 style="color: #2c5aa0; margin-bottom: 10px;">üîß –î–µ—Ç–∞–π–ª–∏:</h4>';
                
                // –°–æ—Ä—Ç–∏—Ä–∞–º–µ –¥–µ—Ç–∞–π–ª–∏—Ç–µ
                const sortedParts = sortByName(Array.from(unifiedParts.values()));
                sortedParts.forEach(part => {
                    html += `<div style="padding: 5px 0; border-bottom: 1px solid #eee; text-align: center;">
                        <span>${createImageTooltip(translateName(part.name), part.imagePath)}</span>
                        <span style="float: right; font-weight: bold; color: #28a745;">${part.quantity} –±—Ä.</span>
                    </div>`;
                });
                html += '</div>';
            }
            
            // –ü–æ–¥–∞—Å–µ–º–±–ª–∏—Ç–∞ –∫–æ–ª–æ–Ω–∞
            if (unifiedSubAssemblies.size > 0) {
                html += '<div style="flex: 1;"><h4 style="color: #2c5aa0; margin-bottom: 10px;">üèóÔ∏è –ü–æ–¥–∞—Å–µ–º–±–ª–∏—Ç–∞:</h4>';
                
                // –°–æ—Ä—Ç–∏—Ä–∞–º–µ –ø–æ–¥–∞—Å–µ–º–±–ª–∏—Ç–∞—Ç–∞
                const sortedSubAssemblies = sortByName(Array.from(unifiedSubAssemblies.values()));
                sortedSubAssemblies.forEach(subAssembly => {
                    html += `<div style="padding: 5px 0; border-bottom: 1px solid #eee; text-align: center;">
                        <span style="font-style: italic;">${createImageTooltip(translateName(subAssembly.name), subAssembly.imagePath)}</span>
                        <span style="float: right; font-weight: bold; color: #17a2b8;">${subAssembly.quantity} –±—Ä.</span>
                    </div>`;
                });
                html += '</div>';
            }
            
            html += '</div>';
            
            if (unifiedParts.size === 0 && unifiedSubAssemblies.size === 0) {
                html = '<p style="text-align: center; color: #6c757d; font-style: italic;">–ù—è–º–∞ –¥–µ—Ç–∞–π–ª–∏ –∑–∞ –ø–æ–∫–∞–∑–≤–∞–Ω–µ</p>';
            }
            
            container.innerHTML = html;
        }

        function startClassification() {
            // –°–∫—Ä–∏–≤–∞–º–µ —Å—Ä–µ–¥–Ω–∞—Ç–∞ —Ç–∞–±–ª–∏—Ü–∞ (classification-table)
            const classificationTable = document.querySelector('.classification-table');
            if (classificationTable) {
                classificationTable.style.display = 'none';
            }
            
            // –ü–æ–∫–∞–∑–≤–∞–º–µ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω–∞—Ç–∞ —á–∞—Å—Ç
            document.getElementById('classificationArea').classList.remove('hidden');
            // –ó–∞–ø–æ—á–≤–∞–º–µ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω–∏—è –ø—Ä–æ—Ü–µ—Å
            showCurrentItem();
            // –°–∫—Ä–æ–ª–∏–≤–∞–º–µ –¥–æ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω–∞—Ç–∞ —á–∞—Å—Ç
            document.getElementById('classificationArea').scrollIntoView({ behavior: 'smooth' });
        }

        function parseCSVToBOMData(csvContent) {
            const lines = csvContent.split('\n').map(line => line.trim()).filter(line => line);
            if (lines.length === 0) {
                throw new Error('CSV —Ñ–∞–π–ª—ä—Ç –µ –ø—Ä–∞–∑–µ–Ω');
            }

            // –ü—Ä–µ–º–∞—Ö–≤–∞–º–µ BOM marker –∞–∫–æ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞
            if (lines[0].startsWith('\ufeff')) {
                lines[0] = lines[0].substring(1);
            }

            const assemblies = [];
            const processedAssemblies = new Set();
            let mainAssemblyName = '';
            const headerLine = lines[0].toLowerCase();

            // –ü—Ä–æ–≤–µ—Ä—è–≤–∞–º–µ –¥–∞–ª–∏ –µ –ø–æ–¥—Ä–æ–±–µ–Ω CSV (—Å –∫–æ–ª–æ–Ω–∏ –∑–∞ —Ç–∏–ø, —Ñ–∞–π–ª–æ–≤ –ø—ä—Ç, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –¥–µ—Ç–∞–π–ª–∏, –ø–æ–¥–∞—Å–µ–º–±–ª–∏—Ç–∞)
            const isEnhancedCSV = headerLine.includes('—Ç–∏–ø') || headerLine.includes('—Ñ–∞–π–ª–æ–≤ –ø—ä—Ç') || headerLine.includes('–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');

            // –û–±—Ä–∞–±–æ—Ç–≤–∞–º–µ –≤—Å–µ–∫–∏ —Ä–µ–¥
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i];
                if (!line) continue;

                // –ü–∞—Ä—Å–∏—Ä–∞–º–µ CSV —Ä–µ–¥–∞ (—Å —É—á–µ—Ç –Ω–∞ –∫–∞–≤–∏—á–∫–∏)
                const columns = parseCSVLine(line);
                if (columns.length < 4) continue;

                const depth = parseInt(columns[0]) || 0;
                const path = columns[1].replace(/"/g, '');
                const name = columns[2].replace(/"/g, '').trim();
                const quantity = parseInt(columns[3]) || 1;

                // –ê–∫–æ –µ –æ—Å–Ω–æ–≤–Ω–æ—Ç–æ –∞—Å–µ–º–±–ª–∏ (–Ω–∏–≤–æ 0), –≥–æ –∑–∞–ø–∞–∑–≤–∞–º–µ
                if (depth === 0 && !mainAssemblyName) {
                    mainAssemblyName = name;
                }

                if (isEnhancedCSV && columns.length >= 9) {
                    // –û–±—Ä–∞–±–æ—Ç–≤–∞–º–µ –ø–æ–¥—Ä–æ–±–µ–Ω CSV —Å –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ –∫–æ–ª–æ–Ω–∏
                    const type = columns[4].replace(/"/g, '');
                    const filePath = columns[5].replace(/"/g, '');
                    const imagePath = columns[6].replace(/"/g, '');
                    const partsInfo = columns[7].replace(/"/g, '');
                    const subAssembliesInfo = columns[8].replace(/"/g, '');

                    // –ü—Ä–µ—Å–∫–∞—á–∞–º–µ —Ä–µ–¥–æ–≤–µ, –∫–æ–∏—Ç–æ –Ω–µ —Å–∞ –∞—Å–µ–º–±–ª–∏—Ç–∞
                    if (type !== 'assembly' && type !== 'main_assembly') {
                        continue;
                    }

                    // –ü—Ä–æ–≤–µ—Ä—è–≤–∞–º–µ –¥–∞–ª–∏ —Ç–æ–≤–∞ –∞—Å–µ–º–±–ª–∏ –≤–µ—á–µ –µ –æ–±—Ä–∞–±–æ—Ç–µ–Ω–æ
                    const assemblyKey = `${path}_${depth}`;
                    if (processedAssemblies.has(assemblyKey)) {
                        continue;
                    }
                    processedAssemblies.add(assemblyKey);

                    // –ü–∞—Ä—Å–∏—Ä–∞–º–µ –¥–µ—Ç–∞–π–ª–∏—Ç–µ –∏ –ø–æ–¥–∞—Å–µ–º–±–ª–∏—Ç–∞—Ç–∞
                    const parts = partsInfo ? partsInfo.split(';').map(part => {
                        const match = part.trim().match(/^(.+)\((\d+)\)$/);
                        return match ? {
                            name: match[1],
                            quantity: parseInt(match[2]),
                            type: 'part'
                        } : null;
                    }).filter(p => p) : [];

                    const subAssemblies = subAssembliesInfo ? subAssembliesInfo.split(';').map(sub => {
                        const match = sub.trim().match(/^(.+)\((\d+)\)$/);
                        return match ? {
                            name: match[1],
                            quantity: parseInt(match[2]),
                            type: 'subassembly'
                        } : null;
                    }).filter(s => s) : [];

                    // –°—ä–∑–¥–∞–≤–∞–º–µ –æ–±–µ–∫—Ç –∑–∞ –∞—Å–µ–º–±–ª–∏—Ç–æ
                    const assemblyItem = {
                        name: name,
                        path: path,
                        depth: depth,
                        quantity: quantity,
                        filePath: filePath,
                        imagePath: imagePath,
                        type: type,
                        parts: parts,
                        subAssemblies: subAssemblies
                    };

                    assemblies.push(assemblyItem);

                } else {
                    // –û–±—Ä–∞–±–æ—Ç–≤–∞–º–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–µ–Ω CSV (—Å—Ç–∞—Ä–∞ –ª–æ–≥–∏–∫–∞)
                    
                    // –û–±—Ä–∞–±–æ—Ç–≤–∞–º–µ —Å–∞–º–æ –∞—Å–µ–º–±–ª–∏—Ç–∞ (–ø–æ–¥–∞—Å–µ–º–±–ª–∏—Ç–∞), –Ω–µ –æ—Ç–¥–µ–ª–Ω–∏—Ç–µ –¥–µ—Ç–∞–π–ª–∏
                    if (name === '<–ø–æ–¥–∞—Å–µ–º–±–ª–∏>' || name.startsWith('    ')) {
                        continue; // –ü—Ä–µ—Å–∫–∞—á–∞–º–µ –ø–æ–¥–∞—Å–µ–º–±–ª–∏—Ç–∞ –º–∞—Ä–∫–µ—Ä–∏ –∏ –∏–Ω–¥–µ–Ω—Ç–∏—Ä–∞–Ω–∏ –¥–µ—Ç–∞–π–ª–∏
                    }

                    // –ò–∑–≤–ª–∏—á–∞–º–µ –∏–º–µ—Ç–æ –Ω–∞ –∞—Å–µ–º–±–ª–∏—Ç–æ –æ—Ç –ø—ä—Ç—è
                    const pathParts = path.split('/');
                    const assemblyName = pathParts[pathParts.length - 1] || name;

                    // –ü—Ä–æ–≤–µ—Ä—è–≤–∞–º–µ –¥–∞–ª–∏ —Ç–æ–≤–∞ –∞—Å–µ–º–±–ª–∏ –≤–µ—á–µ –µ –æ–±—Ä–∞–±–æ—Ç–µ–Ω–æ
                    const assemblyKey = `${path}_${depth}`;
                    if (processedAssemblies.has(assemblyKey)) {
                        continue;
                    }
                    processedAssemblies.add(assemblyKey);

                    // –°—ä–∑–¥–∞–≤–∞–º–µ –æ–±–µ–∫—Ç –∑–∞ –∞—Å–µ–º–±–ª–∏—Ç–æ
                    const assemblyItem = {
                        name: assemblyName,
                        path: path,
                        depth: depth,
                        quantity: quantity,
                        filePath: '', // –ù—è–º–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ —Ñ–∞–π–ª–æ–≤–∏—è –ø—ä—Ç –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—è CSV
                        imagePath: '', // –ù—è–º–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—è CSV
                        type: depth === 0 ? 'main_assembly' : 'assembly',
                        parts: [], // –ü—Ä–∞–∑–µ–Ω —Å–ø–∏—Å—ä–∫ - –Ω—è–º–∞ –¥–µ—Ç–∞–π–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—è CSV
                        subAssemblies: [] // –ü—Ä–∞–∑–µ–Ω —Å–ø–∏—Å—ä–∫ - –Ω—è–º–∞ –¥–µ—Ç–∞–π–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—è CSV
                    };

                    assemblies.push(assemblyItem);
                }
            }

            return {
                metadata: {
                    mainAssembly: mainAssemblyName || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞ —Å–±–æ—Ä–∫–∞',
                    totalAssemblies: assemblies.length,
                    exportDate: new Date().toISOString().split('T')[0],
                    version: '1.0',
                    source: isEnhancedCSV ? 'Enhanced CSV' : 'Standard CSV'
                },
                assemblies: assemblies
            };
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    if (inQuotes && line[i + 1] === '"') {
                        // Escaped quote
                        current += '"';
                        i++; // Skip next quote
                    } else {
                        // Toggle quote state
                        inQuotes = !inQuotes;
                    }
                } else if (char === ';' && !inQuotes) {
                    // Field separator
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            
            // Add the last field
            result.push(current);
            
            return result;
        }

        function loadBOM() {
            const fileInput = document.getElementById('bomFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('–ú–æ–ª—è, –∏–∑–±–µ—Ä–µ—Ç–µ JSON –∏–ª–∏ CSV —Ñ–∞–π–ª!');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    const fileName = file.name.toLowerCase();
                    let data;

                    if (fileName.endsWith('.json')) {
                        data = JSON.parse(content);
                        originalJsonData = data; // –ó–∞–ø–∞–∑–≤–∞–º–µ –æ—Ä–∏–≥–∏–Ω–∞–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω–∏
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–≤–∞–º–µ —Ä–∞–∑–ª–∏—á–Ω–∏—Ç–µ JSON —Ñ–æ—Ä–º–∞—Ç–∏
                        if (data.metadata && data.metadata.version === '2.0') {
                            if (data.items) {
                                // –ù–æ–≤ –ø—ä–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç - –∏–∑–ø–æ–ª–∑–≤–∞–º–µ –≤—Å–∏—á–∫–∏ –µ–ª–µ–º–µ–Ω—Ç–∏ (–∞—Å–µ–º–±–ª–∏—Ç–∞ –ò —á–∞—Å—Ç–∏)
                                bomData = data.items.filter(item => item.type === 'assembly' || item.type === 'main_assembly');
                                allItemsData = data.items;
                            } else if (data.assemblies) {
                                // –í–∞—à–∏—è—Ç —Ñ–æ—Ä–º–∞—Ç - –≤–µ—Ä—Å–∏—è 2.0 –Ω–æ —Å —á–∞—Å—Ç–∏ –≤—ä—Ç—Ä–µ –≤ –∞—Å–µ–º–±–ª–∏—Ç–∞—Ç–∞
                                console.log('–û—Ä–∏–≥–∏–Ω–∞–ª–Ω–∏ –∞—Å–µ–º–±–ª–∏—Ç–∞:', data.assemblies.length);
                                
                                bomData = unifyAssemblies(data.assemblies || []);
                                allItemsData = bomData; // –ß–∞—Å—Ç–∏—Ç–µ —Å–∞ –≤–µ—á–µ –≤ –∞—Å–µ–º–±–ª–∏—Ç–∞—Ç–∞
                                
                                console.log('–û–±–µ–¥–∏–Ω–µ–Ω–∏ –∞—Å–µ–º–±–ª–∏—Ç–∞:', bomData.length);
                                bomData.forEach((asm, index) => {
                                    console.log(`${index + 1}. ${asm.name} - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${asm.quantity}`);
                                });
                            } else {
                                bomData = data.assemblies || [];
                                allItemsData = bomData;
                            }
                        } else {
                            // –°—Ç–∞—Ä —Ñ–æ—Ä–º–∞—Ç (–≤–µ—Ä—Å–∏—è 1.0) - —Å–∞–º–æ –∞—Å–µ–º–±–ª–∏—Ç–∞
                            bomData = data.assemblies || [];
                            allItemsData = bomData;
                        }
                    } else if (fileName.endsWith('.csv')) {
                        data = parseCSVToBOMData(content);
                        bomData = data.assemblies || [];
                        allItemsData = bomData; // CSV –¥–∞–Ω–Ω–∏
                    } else {
                        alert('–ù–µ–ø–æ–¥–¥—ä—Ä–∂–∞–Ω —Ñ–æ—Ä–º–∞—Ç –Ω–∞ —Ñ–∞–π–ª! –ú–æ–ª—è, –∏–∑–±–µ—Ä–µ—Ç–µ JSON –∏–ª–∏ CSV —Ñ–∞–π–ª.');
                        return;
                    }
                    
                    currentIndex = 0;
                    workshopItems = [];
                    externalItems = [];
                    workshopPaths = new Set();
                    externalPaths = new Set();
                    
                    if (bomData.length === 0) {
                        alert('–ù—è–º–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏ —Å–±–æ—Ä–∫–∏ –≤ —Ñ–∞–π–ª–∞!');
                        return;
                    }

                    // –ü–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ –≥–ª–∞–≤–Ω–∞—Ç–∞ —Å–±–æ—Ä–∫–∞
                    setupMainAssemblyDisplay(data);
                    
                    // –ü–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ –æ–±–æ–±—â–µ–Ω–∞—Ç–∞ —Ç–∞–±–ª–∏—Ü–∞
                    showSummaryTable();
                    
                    document.getElementById('loadingMessage').classList.add('hidden');
                    // –ù–µ –ø–æ–∫–∞–∑–≤–∞–º–µ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω–∞—Ç–∞ —á–∞—Å—Ç –ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ
                    // document.getElementById('classificationArea').classList.remove('hidden');
                    document.getElementById('totalItems').textContent = bomData.length;
                    
                    showCurrentItem();
                } catch (error) {
                    alert('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ —á–µ—Ç–µ–Ω–µ –Ω–∞ —Ñ–∞–π–ª–∞: ' + error.message);
                }
            };
            
            reader.readAsText(file);
        }

        function setupMainAssemblyDisplay(data) {
            const mainAssembly = bomData.find(item => item.type === 'main_assembly') || bomData[0];
            
            document.getElementById('mainAssemblyName').textContent = mainAssembly.name;
            document.getElementById('totalAssemblies').textContent = bomData.length;
            document.getElementById('processedCount').textContent = '0';
            document.getElementById('progressPercent').textContent = '0%';
            
            const mainImg = document.getElementById('mainAssemblyImage');
            if (mainAssembly.imagePath && mainAssembly.imagePath !== '') {
                mainImg.src = mainAssembly.imagePath;
                mainImg.onerror = function() {
                    this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJyZ2JhKDI1NSwyNTUsMjU1LDAuMSkiIHN0cm9rZT0icmdiYSgyNTUsMjU1LDI1NSwwLjMpIiBzdHJva2Utd2lkdGg9IjIiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE2IiBmaWxsPSJyZ2JhKDI1NSwyNTUsMjU1LDAuNykiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj7Qk9C70LDQstC90LAg0KHQsdC+0YDQutCwPC90ZXh0Pjwvc3ZnPg==';
                };
            } else {
                mainImg.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJyZ2JhKDI1NSwyNTUsMjU1LDAuMSkiIHN0cm9rZT0icmdiYSgyNTUsMjU1LDI1NSwwLjMpIiBzdHJva2Utd2lkdGg9IjIiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE2IiBmaWxsPSJyZ2JhKDI1NSwyNTUsMjU1LDAuNykiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj7Qk9C70LDQstC90LAg0KHQsdC+0YDQutCwPC90ZXh0Pjwvc3ZnPg==';
            }
            
            document.getElementById('mainAssemblyDisplay').classList.remove('hidden');
        }

        function showCurrentItem() {
            // –ü—Ä–µ—Å–∫–∞—á–∞–º–µ –µ–ª–µ–º–µ–Ω—Ç–∏, –∫–æ–∏—Ç–æ –≤–µ—á–µ —Å–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–ª–∞—Å–∏—Ñ–∏—Ü–∏—Ä–∞–Ω–∏
            while (currentIndex < bomData.length) {
                const item = bomData[currentIndex];
                const autoClassified = checkAutoClassification(item);
                
                if (autoClassified) {
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–ª–∞—Å–∏—Ñ–∏—Ü–∏—Ä–∞–º–µ –∏ –ø—Ä–µ–º–∏–Ω–∞–≤–∞–º–µ –∫—ä–º —Å–ª–µ–¥–≤–∞—â–∏—è
                    if (autoClassified === 'workshop') {
                        workshopItems.push(item);
                        workshopPaths.add(item.path);
                    } else if (autoClassified === 'external') {
                        externalItems.push(item);
                        externalPaths.add(item.path);
                    }
                    updateResults();
                    currentIndex++;
                    updateProgress();
                } else {
                    break; // –ù–∞–º–µ—Ä–∏—Ö–º–µ –µ–ª–µ–º–µ–Ω—Ç, –∫–æ–π—Ç–æ —Ç—Ä—è–±–≤–∞ –¥–∞ –±—ä–¥–µ —Ä—ä—á–Ω–æ –∫–ª–∞—Å–∏—Ñ–∏—Ü–∏—Ä–∞–Ω
                }
            }

            if (currentIndex >= bomData.length) {
                showCompleted();
                return;
            }

            const item = bomData[currentIndex];
            document.getElementById('currentName').textContent = translateName(item.name);
            document.getElementById('currentPath').textContent = item.path;
            document.getElementById('currentIndex').textContent = currentIndex + 1;
            
            // –ü–æ–∫–∞–∑–≤–∞–Ω–µ –¥–∞–ª–∏ –µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –Ω–∞—Å–ª–µ–¥–µ–Ω–∞ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è
            const inheritanceStatus = getInheritanceStatus(item);
            if (inheritanceStatus) {
                document.getElementById('currentPath').innerHTML = 
                    item.path + '<br><small style="color: #28a745; font-weight: bold;">‚ö° ' + inheritanceStatus + '</small>';
            }
            
            // –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            const img = document.getElementById('currentImage');
            if (item.imagePath && item.imagePath !== '') {
                img.src = item.imagePath;
                img.onerror = function() {
                    this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pjwvc3ZnPg==';
                };
            } else {
                img.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pjwvc3ZnPg==';
            }

            // –ü–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ –¥–µ—Ç–∞–π–ª–∏ –∏ –ø–æ–¥–∞—Å–µ–º–±–ª–∏—Ç–∞
            showItemDetails(item);
            
            updateProgress();
        }

        function checkAutoClassification(item) {
            // –ü—Ä–æ–≤–µ—Ä—è–≤–∞–º–µ –¥–∞–ª–∏ —Ä–æ–¥–∏—Ç–µ–ª—Å–∫–∞—Ç–∞ —Å–±–æ—Ä–∫–∞ –µ –∫–ª–∞—Å–∏—Ñ–∏—Ü–∏—Ä–∞–Ω–∞ –∑–∞ —Ü–µ—Ö
            const pathParts = item.path.split('/');
            
            // –ü—Ä–æ–≤–µ—Ä—è–≤–∞–º–µ –≤—Å–∏—á–∫–∏ —Ä–æ–¥–∏—Ç–µ–ª—Å–∫–∏ –ø—ä—Ç–∏—â–∞
            for (let i = pathParts.length - 1; i > 0; i--) {
                const parentPath = pathParts.slice(0, i).join('/');
                
                if (workshopPaths.has(parentPath)) {
                    return 'workshop'; // –†–æ–¥–∏—Ç–µ–ª—è—Ç –µ –≤ —Ü–µ—Ö–∞, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∏ —Ç–æ–≤–∞ –µ –≤ —Ü–µ—Ö–∞
                }
                
                if (externalPaths.has(parentPath)) {
                    // –†–æ–¥–∏—Ç–µ–ª—è—Ç –µ –≤—ä–Ω—à–µ–Ω, –Ω–æ –ø–æ–¥—Å–±–æ—Ä–∫–∏—Ç–µ –º–æ–∂–µ –¥–∞ —Å–∞ —Ü–µ—Ö–æ–≤–∏
                    // –û—Å—Ç–∞–≤—è–º–µ —Ç–æ–≤–∞ –∑–∞ —Ä—ä—á–Ω–æ —Ä–µ—à–µ–Ω–∏–µ
                    return null;
                }
            }
            
            return null; // –ù—è–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è
        }

        function getInheritanceStatus(item) {
            const pathParts = item.path.split('/');
            
            for (let i = pathParts.length - 1; i > 0; i--) {
                const parentPath = pathParts.slice(0, i).join('/');
                const parentName = pathParts[i - 1];
                
                if (workshopPaths.has(parentPath)) {
                    return `–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ: —Ä–æ–¥–∏—Ç–µ–ª—è—Ç "${parentName}" –µ –≤ —Ü–µ—Ö–∞`;
                }
            }
            
            return null;
        }

        function showItemDetails(item) {
            let parts = item.parts || [];
            let subAssemblies = item.subAssemblies || [];
            
            // –ê–∫–æ –∏–∑–ø–æ–ª–∑–≤–∞–º–µ –ø—ä–ª–µ–Ω JSON —Ñ–æ—Ä–º–∞—Ç —Å –æ—Ç–¥–µ–ª–Ω–∏ –µ–ª–µ–º–µ–Ω—Ç–∏
            if (allItemsData && allItemsData.length > 0 && allItemsData !== bomData) {
                // –ù–∞–º–∏—Ä–∞–º–µ –≤—Å–∏—á–∫–∏ —á–∞—Å—Ç–∏, –∫–æ–∏—Ç–æ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –Ω–∞ —Ç–æ–≤–∞ –∞—Å–µ–º–±–ª–∏
                const directParts = allItemsData.filter(dataItem => 
                    dataItem.type === 'part' && 
                    dataItem.parentAssembly === item.name
                );
                
                if (directParts.length > 0) {
                    parts = directParts.map(part => ({
                        name: part.name,
                        quantity: part.quantity,
                        type: part.type
                    }));
                }
            }
            // –ò–Ω–∞—á–µ —á–∞—Å—Ç–∏—Ç–µ —Å–∞ –≤–µ—á–µ –≤ –∞—Å–µ–º–±–ª–∏—Ç–æ (–≤–∞—à–∏—è —Ñ–æ—Ä–º–∞—Ç)
            
            // –û–±–µ–¥–∏–Ω—è–≤–∞–º–µ —á–∞—Å—Ç–∏—Ç–µ –∑–∞ —Ç–æ—á–Ω–æ –±—Ä–æ–µ–Ω–µ
            const unifiedParts = new Map();
            parts.forEach(part => {
                const cleanName = part.name.replace(/<\d+>/g, '').trim();
                if (unifiedParts.has(cleanName)) {
                    unifiedParts.set(cleanName, {
                        name: cleanName,
                        quantity: unifiedParts.get(cleanName).quantity + part.quantity,
                        imagePath: unifiedParts.get(cleanName).imagePath || part.imagePath
                    });
                } else {
                    unifiedParts.set(cleanName, {
                        name: cleanName,
                        quantity: part.quantity,
                        imagePath: part.imagePath
                    });
                }
            });
            
            // –û–±–µ–¥–∏–Ω—è–≤–∞–º–µ –ø–æ–¥–∞—Å–µ–º–±–ª–∏—Ç–∞—Ç–∞ –∑–∞ —Ç–æ—á–Ω–æ –±—Ä–æ–µ–Ω–µ
            const unifiedSubAssemblies = new Map();
            subAssemblies.forEach(subAssembly => {
                const cleanName = subAssembly.name.replace(/<\d+>/g, '').trim();
                if (unifiedSubAssemblies.has(cleanName)) {
                    unifiedSubAssemblies.set(cleanName, {
                        name: cleanName,
                        quantity: unifiedSubAssemblies.get(cleanName).quantity + subAssembly.quantity,
                        imagePath: unifiedSubAssemblies.get(cleanName).imagePath || subAssembly.imagePath
                    });
                } else {
                    unifiedSubAssemblies.set(cleanName, {
                        name: cleanName,
                        quantity: subAssembly.quantity,
                        imagePath: subAssembly.imagePath
                    });
                }
            });
            
            // –û–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏—Ç–µ —Å –æ–±–µ–¥–∏–Ω–µ–Ω–∏—Ç–µ –±—Ä–æ–π–∫–∏
            document.getElementById('partsCount').textContent = unifiedParts.size;
            document.getElementById('subAssembliesCount').textContent = unifiedSubAssemblies.size;
            
            // –ü–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ –¥–µ—Ç–∞–π–ª–∏—Ç–µ
            const partsList = document.getElementById('partsList');
            partsList.innerHTML = '';
            if (unifiedParts.size > 0) {
                const title = document.createElement('div');
                title.className = 'details-title';
                title.textContent = 'üîß –î–µ—Ç–∞–π–ª–∏ –≤ —Å–±–æ—Ä–∫–∞—Ç–∞:';
                partsList.appendChild(title);
                
                // –°–æ—Ä—Ç–∏—Ä–∞–º–µ –¥–µ—Ç–∞–π–ª–∏—Ç–µ –ø—Ä–µ–¥–∏ –ø–æ–∫–∞–∑–≤–∞–Ω–µ
                const sortedParts = sortByName(Array.from(unifiedParts.values()));
                sortedParts.forEach(part => {
                    const div = document.createElement('div');
                    div.className = 'part-item';
                    div.innerHTML = `
                        <span class="item-name">${createImageTooltip(translateName(part.name), part.imagePath)}</span>
                        <span class="item-quantity">${part.quantity} –±—Ä.</span>
                    `;
                    partsList.appendChild(div);
                });
            }
            
            // –ü–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ –ø–æ–¥–∞—Å–µ–º–±–ª–∏—Ç–∞—Ç–∞
            const subAssembliesList = document.getElementById('subAssembliesList');
            subAssembliesList.innerHTML = '';
            if (unifiedSubAssemblies.size > 0) {
                const title = document.createElement('div');
                title.className = 'details-title';
                title.textContent = 'üèóÔ∏è –ü–æ–¥–∞—Å–µ–º–±–ª–∏—Ç–∞:';
                subAssembliesList.appendChild(title);
                
                // –°–æ—Ä—Ç–∏—Ä–∞–º–µ –ø–æ–¥–∞—Å–µ–º–±–ª–∏—Ç–∞—Ç–∞ –ø—Ä–µ–¥–∏ –ø–æ–∫–∞–∑–≤–∞–Ω–µ
                const sortedSubAssemblies = sortByName(Array.from(unifiedSubAssemblies.values()));
                sortedSubAssemblies.forEach(subAssembly => {
                    const div = document.createElement('div');
                    div.className = 'subassembly-item';
                    div.innerHTML = `
                        <span class="item-name">${createImageTooltip(translateName(subAssembly.name), subAssembly.imagePath)}</span>
                        <span class="item-quantity">${subAssembly.quantity} –±—Ä.</span>
                    `;
                    subAssembliesList.appendChild(div);
                });
            }
        }

        function classifyItem(isWorkshop) {
            const item = bomData[currentIndex];
            
            if (isWorkshop) {
                workshopItems.push(item);
                workshopPaths.add(item.path);
                
                // –ü–æ–∫–∞–∑–≤–∞–º–µ —Å—ä–æ–±—â–µ–Ω–∏–µ –∑–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞—Ç–∞ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ –ø–æ–¥—Å–±–æ—Ä–∫–∏—Ç–µ
                const subAssembliesCount = countSubAssemblies(item.path);
                if (subAssembliesCount > 0) {
                    showAutoClassificationMessage(item.name, subAssembliesCount);
                }
            } else {
                externalItems.push(item);
                externalPaths.add(item.path);
            }

            updateResults();
            currentIndex++;
            showCurrentItem();
        }

        function countSubAssemblies(parentPath) {
            let count = 0;
            for (let i = currentIndex + 1; i < bomData.length; i++) {
                const item = bomData[i];
                if (item.path.startsWith(parentPath + '/')) {
                    count++;
                } else if (!item.path.startsWith(parentPath)) {
                    break; // –ò–∑–ª—è–∑–æ—Ö–º–µ –æ—Ç –ø–æ–¥–¥—ä—Ä–≤–æ—Ç–æ
                }
            }
            return count;
        }

        function showAutoClassificationMessage(parentName, count) {
            if (count === 0) return;
            
            // –°—ä–∑–¥–∞–≤–∞–º–µ –≤—Ä–µ–º–µ–Ω–Ω–æ —Å—ä–æ–±—â–µ–Ω–∏–µ
            const message = document.createElement('div');
            message.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #28a745, #20c997);
                color: white;
                padding: 20px 30px;
                border-radius: 10px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 1000;
                text-align: center;
                font-size: 1.1em;
                max-width: 400px;
            `;
            
            message.innerHTML = `
                <div style="font-size: 1.3em; margin-bottom: 10px;">‚ö° –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è</div>
                <div>"${parentName}" ‚Üí –¶–µ—Ö</div>
                <div style="margin-top: 10px; font-size: 0.9em; opacity: 0.9;">
                    ${count} –ø–æ–¥—Å–±–æ—Ä–∫–∏ —Å—ä—â–æ —â–µ –±—ä–¥–∞—Ç –∫–ª–∞—Å–∏—Ñ–∏—Ü–∏—Ä–∞–Ω–∏ –∑–∞ —Ü–µ—Ö–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
                </div>
            `;
            
            document.body.appendChild(message);
            
            // –ü—Ä–µ–º–∞—Ö–≤–∞–º–µ —Å—ä–æ–±—â–µ–Ω–∏–µ—Ç–æ —Å–ª–µ–¥ 3 —Å–µ–∫—É–Ω–¥–∏
            setTimeout(() => {
                if (message.parentNode) {
                    message.parentNode.removeChild(message);
                }
            }, 3000);
        }

        function updateResults() {
            // –¶–µ—Ö–æ–≤–∏ —Å–±–æ—Ä–∫–∏
            document.getElementById('workshopCount').textContent = workshopItems.length;
            const workshopList = document.getElementById('workshopList');
            workshopList.innerHTML = '';
            
            workshopItems.forEach(item => {
                workshopList.appendChild(createResultItem(item));
            });

            // –í—ä–Ω—à–Ω–∏ —Å–±–æ—Ä–∫–∏
            document.getElementById('externalCount').textContent = externalItems.length;
            const externalList = document.getElementById('externalList');
            externalList.innerHTML = '';
            
            externalItems.forEach(item => {
                externalList.appendChild(createResultItem(item));
            });
        }

        function createResultItem(item) {
            const div = document.createElement('div');
            div.className = 'result-item';
            
            // –ü—Ä–æ–≤–µ—Ä—è–≤–∞–º–µ –¥–∞–ª–∏ –µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–ª–∞—Å–∏—Ñ–∏—Ü–∏—Ä–∞–Ω
            const isAutoClassified = checkIfAutoClassified(item);
            if (isAutoClassified) {
                div.style.borderLeft = '4px solid #ffc107';
                div.style.background = 'linear-gradient(90deg, #fff3cd, #f8f9fa)';
            }
            
            const img = document.createElement('img');
            img.className = 'result-image';
            img.src = item.imagePath || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2VlZSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTAiIGZpbGw9IiM5OTkiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5ObyBJbWFnZTwvdGV4dD48L3N2Zz4=';
            img.onerror = function() {
                this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2VlZSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTAiIGZpbGw9IiM5OTkiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5ObyBJbWFnZTwvdGV4dD48L3N2Zz4=';
            };
            
            const infoDiv = document.createElement('div');
            infoDiv.className = 'result-info';
            
            const nameDiv = document.createElement('div');
            nameDiv.className = 'result-name';
            nameDiv.innerHTML = item.name + (isAutoClassified ? ' <span style="color: #ffc107;">‚ö°</span>' : '');
            
            const pathDiv = document.createElement('div');
            pathDiv.className = 'result-path';
            pathDiv.textContent = item.path;
            
            if (isAutoClassified) {
                const autoDiv = document.createElement('div');
                autoDiv.style.cssText = 'font-size: 0.8em; color: #856404; font-style: italic; margin-top: 2px;';
                autoDiv.textContent = '‚ö° –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–ª–∞—Å–∏—Ñ–∏—Ü–∏—Ä–∞–Ω';
                infoDiv.appendChild(autoDiv);
            }
            
            infoDiv.appendChild(nameDiv);
            infoDiv.appendChild(pathDiv);
            
            div.appendChild(img);
            div.appendChild(infoDiv);
            
            return div;
        }

        function checkIfAutoClassified(item) {
            // –ü—Ä–æ–≤–µ—Ä—è–≤–∞–º–µ –¥–∞–ª–∏ –∏–º–∞ —Ä–æ–¥–∏—Ç–µ–ª –≤ —Å—ä—â–∞—Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è
            const pathParts = item.path.split('/');
            
            for (let i = pathParts.length - 1; i > 0; i--) {
                const parentPath = pathParts.slice(0, i).join('/');
                
                if (workshopPaths.has(parentPath)) {
                    return true; // –ò–º–∞ —Ä–æ–¥–∏—Ç–µ–ª –≤ —Ü–µ—Ö–∞
                }
            }
            
            return false;
        }

        function updateProgress() {
            const progress = (currentIndex / bomData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            
            // –û–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ –≥–ª–∞–≤–Ω–∏—è –¥–∏—Å–ø–ª–µ–π
            document.getElementById('processedCount').textContent = currentIndex;
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            
            // –ü—Ä–æ–º—è–Ω–∞ –Ω–∞ —Ü–≤–µ—Ç–∞ –Ω–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–∏—Ç–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç –æ—Ç –Ω–∞–ø—Ä–µ–¥—ä–∫–∞
            const progressElement = document.getElementById('progressPercent');
            if (progress < 30) {
                progressElement.style.color = '#ff6b6b';
            } else if (progress < 70) {
                progressElement.style.color = '#feca57';
            } else {
                progressElement.style.color = '#48dbfb';
            }
            
            if (progress === 100) {
                progressElement.style.color = '#00d2d3';
                progressElement.textContent = '‚úÖ 100%';
            }
        }

        function showCompleted() {
            document.getElementById('classificationArea').classList.add('hidden');
            document.getElementById('completedMessage').classList.remove('hidden');
        }

        function exportResults() {
            const results = {
                timestamp: new Date().toISOString(),
                summary: {
                    total: bomData.length,
                    workshop: workshopItems.length,
                    external: externalItems.length
                },
                workshopAssemblies: workshopItems,
                externalAssemblies: externalItems
            };

            const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'bom_classification_results.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function showFinalReport() {
            generateReport();
            document.getElementById('finalReport').style.display = 'block';
            document.getElementById('finalReport').scrollIntoView({ behavior: 'smooth' });
        }

        function generateReport() {
            // –ì–ª–∞–≤–Ω–∞ —Å–±–æ—Ä–∫–∞
            const mainAssembly = bomData.find(item => item.type === 'main_assembly') || bomData[0];
            document.getElementById('reportMainTitle').textContent = mainAssembly.name;
            
            // –ì–ª–∞–≤–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            const mainImg = document.getElementById('reportMainImage');
            if (mainAssembly.imagePath && mainAssembly.imagePath !== '') {
                mainImg.src = mainAssembly.imagePath;
            } else {
                mainImg.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjhmOWZhIiBzdHJva2U9IiMyYzVhYTAiIHN0cm9rZS13aWR0aD0iMiIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMjAiIGZpbGw9IiMyYzVhYTAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj7Qk9C70LDQstC90LAg0KHQsdC+0YDQutCwPC90ZXh0Pjwvc3ZnPg==';
            }

            // –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞
            generateClassificationTable();
            
            // –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ —Ç–∞–±–ª–∏—Ü–∏ —Å –¥–µ—Ç–∞–π–ª–∏
            generatePartsTable('workshop', workshopItems, 'workshopPartsTable');
            generatePartsTable('external', externalItems, 'externalPartsTable');
        }

        function generateClassificationTable() {
            const tbody = document.getElementById('classificationTableBody');
            tbody.innerHTML = '';
            
            let counter = 1;
            
            // –¶–µ—Ö–æ–≤–∏ —Å–±–æ—Ä–∫–∏
            workshopItems.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'workshop-row';
                row.innerHTML = `
                    <td rowspan="${workshopItems.length}" style="writing-mode: vertical-rl; text-orientation: mixed; background: #28a745; color: white; font-weight: bold;">üè≠ –¶–ï–•</td>
                    <td>${counter++}</td>
                    <td style="text-align: center;">${item.name}</td>
                    <td>1</td>
                    <td style="color: #28a745; font-weight: bold; font-size: 1.2em;">‚úì</td>
                `;
                tbody.appendChild(row);
                
                // –ü—Ä–µ–º–∞—Ö–≤–∞–º–µ rowspan –∑–∞ —Å–ª–µ–¥–≤–∞—â–∏—Ç–µ —Ä–µ–¥–æ–≤–µ
                if (counter > 2) {
                    row.children[0].remove();
                }
            });
            
            // –í—ä–Ω—à–Ω–∏ —Å–±–æ—Ä–∫–∏  
            externalItems.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'external-row';
                row.innerHTML = `
                    <td rowspan="${externalItems.length}" style="writing-mode: vertical-rl; text-orientation: mixed; background: #dc3545; color: white; font-weight: bold;">üöö –í–™–ù–®–ù–û</td>
                    <td>${counter++}</td>
                    <td style="text-align: center;">${item.name}</td>
                    <td>1</td>
                    <td style="color: #dc3545; font-weight: bold; font-size: 1.2em;">‚úì</td>
                `;
                tbody.appendChild(row);
                
                // –ü—Ä–µ–º–∞—Ö–≤–∞–º–µ rowspan –∑–∞ —Å–ª–µ–¥–≤–∞—â–∏—Ç–µ —Ä–µ–¥–æ–≤–µ
                if (counter > workshopItems.length + 2) {
                    row.children[0].remove();
                }
            });
        }

        function generatePartsTable(type, items, tableId) {
            const tbody = document.getElementById(tableId);
            tbody.innerHTML = '';
            
            // –û–±–µ–¥–∏–Ω—è–≤–∞–º–µ –≤—Å–∏—á–∫–∏ parts –∏ subassemblies –≤ –µ–¥–∏–Ω —Å–ø–∏—Å—ä–∫
            const allParts = [];
            
            items.forEach(assembly => {
                // –î–æ–±–∞–≤—è–º–µ –≤—Å–∏—á–∫–∏ parts
                const parts = assembly.parts || [];
                parts.forEach(part => {
                    allParts.push({
                        name: part.name,
                        quantity: part.quantity,
                        imagePath: part.imagePath,
                        isSubAssembly: false
                    });
                });
                
                // –î–æ–±–∞–≤—è–º–µ –ø–æ–¥–∞—Å–µ–º–±–ª–∏—Ç–∞—Ç–∞ –∫–∞—Ç–æ –¥–µ—Ç–∞–π–ª–∏
                const subAssemblies = assembly.subAssemblies || [];
                subAssemblies.forEach(sub => {
                    allParts.push({
                        name: sub.name + ' (–ø–æ–¥–∞—Å–µ–º–±–ª–∏)',
                        quantity: sub.quantity,
                        imagePath: sub.imagePath,
                        isSubAssembly: true
                    });
                });
            });
            
            // –û–±–µ–¥–∏–Ω—è–≤–∞–º–µ –µ–¥–Ω–∞–∫–≤–∏—Ç–µ –¥–µ—Ç–∞–π–ª–∏
            const unifiedParts = new Map();
            
            allParts.forEach(part => {
                // –ü–æ—á–∏—Å—Ç–≤–∞–º–µ –∏–º–µ—Ç–æ –æ—Ç <1>, <2> –∏ —Ç.–Ω.
                const cleanName = part.name.replace(/<\d+>/g, '').trim();
                
                if (unifiedParts.has(cleanName)) {
                    // –ê–∫–æ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞, —É–≤–µ–ª–∏—á–∞–≤–∞–º–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ—Ç–æ
                    unifiedParts.set(cleanName, {
                        name: cleanName,
                        quantity: unifiedParts.get(cleanName).quantity + part.quantity,
                        imagePath: unifiedParts.get(cleanName).imagePath || part.imagePath,
                        isSubAssembly: part.isSubAssembly
                    });
                } else {
                    // –ê–∫–æ –Ω–µ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞, –≥–æ –¥–æ–±–∞–≤—è–º–µ
                    unifiedParts.set(cleanName, {
                        name: cleanName,
                        quantity: part.quantity,
                        imagePath: part.imagePath,
                        isSubAssembly: part.isSubAssembly
                    });
                }
            });
            
            // –°–æ—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–∞–Ω–∏—Ç–µ –¥–µ—Ç–∞–π–ª–∏
            const sortedParts = sortByName(Array.from(unifiedParts.values()));
            
            // –ì–µ–Ω–µ—Ä–∏—Ä–∞–º–µ —Ç–∞–±–ª–∏—Ü–∞—Ç–∞ —Å—ä—Å —Å–æ—Ä—Ç–∏—Ä–∞–Ω–∏—Ç–µ –¥–µ—Ç–∞–π–ª–∏
            let counter = 1;
            sortedParts.forEach(part => {
                const row = document.createElement('tr');
                if (part.isSubAssembly) {
                    row.style.backgroundColor = '#f8f9fa';
                    row.innerHTML = `
                        <td class="qty-column">${counter++}</td>
                        <td style="font-style: italic;">${createImageTooltip(translateName(part.name), part.imagePath)}</td>
                        <td class="qty-column">${part.quantity}</td>
                    `;
                } else {
                    row.innerHTML = `
                        <td class="qty-column">${counter++}</td>
                        <td>${createImageTooltip(translateName(part.name), part.imagePath)}</td>
                        <td class="qty-column">${part.quantity}</td>
                    `;
                }
                tbody.appendChild(row);
            });
            
            // –ê–∫–æ –Ω—è–º–∞ –µ–ª–µ–º–µ–Ω—Ç–∏, –¥–æ–±–∞–≤—è–º–µ –ø—Ä–∞–∑–µ–Ω —Ä–µ–¥
            if (counter === 1) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="3" style="text-align: center; color: #6c757d; font-style: italic;">–ù—è–º–∞ –µ–ª–µ–º–µ–Ω—Ç–∏</td>
                `;
                tbody.appendChild(row);
            }
        }

        function createAssemblyReportItem(item, type) {
            const div = document.createElement('div');
            div.className = `assembly-report-item ${type}-assembly`;
            
            const parts = item.parts || [];
            const subAssemblies = item.subAssemblies || [];
            
            div.innerHTML = `
                <div class="assembly-name">${item.name}</div>
                <div class="assembly-path">${item.path}</div>
                <div class="parts-summary">
                    <div class="parts-column">
                        <h4>üîß –î–µ—Ç–∞–π–ª–∏ (${parts.length}):</h4>
                        ${parts.map(part => `<div>‚Ä¢ ${part.name} - ${part.quantity} –±—Ä.</div>`).join('')}
                    </div>
                    <div class="parts-column">
                        <h4>üèóÔ∏è –ü–æ–¥–∞—Å–µ–º–±–ª–∏—Ç–∞ (${subAssemblies.length}):</h4>
                        ${subAssemblies.map(sub => `<div>‚Ä¢ ${sub.name} - ${sub.quantity} –±—Ä.</div>`).join('')}
                    </div>
                </div>
            `;
            
            return div;
        }

        function printReport() {
            const printWindow = window.open('', '_blank');
            const reportContent = document.getElementById('finalReport').innerHTML;
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –æ—Ç—á–µ—Ç - –ö–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ —Å–±–æ—Ä–∫–∏</title>
                    <style>
                        @page { 
                            size: A4; 
                            margin: 10mm; 
                        }
                        body { 
                            font-family: Arial, sans-serif; 
                            margin: 0; 
                            padding: 0;
                            font-size: 12px;
                        }
                        .report-header {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            padding: 15px;
                            border-bottom: 3px solid #2c5aa0;
                            background: #f8f9fa;
                        }
                        .company-info { font-size: 10px; color: #2c5aa0; font-weight: bold; }
                        .company-logo { font-size: 24px; font-weight: bold; color: #2c5aa0; }
                        .report-main { display: flex; min-height: 500px; }
                        .report-visual {
                            flex: 1;
                            padding: 15px;
                            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
                            display: flex;
                            flex-direction: column;
                            align-items: center;
                            justify-content: center;
                        }
                        .report-title { 
                            font-size: 18px; 
                            color: #2c5aa0; 
                            text-align: center; 
                            margin-bottom: 15px; 
                            font-weight: bold; 
                        }
                        .main-assembly-visual {
                            max-width: 200px;
                            max-height: 300px;
                            border: 2px solid #2c5aa0;
                            border-radius: 10px;
                            background: white;
                            padding: 10px;
                        }
                        .report-tables { flex: 1; padding: 15px; background: white; }
                        .classification-table, .parts-table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-bottom: 15px;
                            border: 2px solid #2c5aa0;
                            font-size: 10px;
                        }
                        .classification-table th, .parts-table th {
                            background: #2c5aa0;
                            color: white;
                            padding: 6px;
                            text-align: center;
                            font-weight: bold;
                            border: 1px solid #2c5aa0;
                        }
                        .classification-table td, .parts-table td {
                            padding: 4px;
                            border: 1px solid #2c5aa0;
                            text-align: center;
                        }
                        .workshop-row { background: #d4edda; }
                        .external-row { background: #f8d7da; }
                        .section-header {
                            background: #2c5aa0;
                            color: white;
                            padding: 8px;
                            text-align: center;
                            font-weight: bold;
                            font-size: 11px;
                        }
                        .parts-table { border: 2px solid #6c757d; }
                        .parts-table th { background: #6c757d; border: 1px solid #6c757d; }
                        .parts-table td { border: 1px solid #6c757d; }
                        button { display: none !important; }
                        .qty-column { text-align: center !important; font-weight: bold; }
                    </style>
                </head>
                <body>${reportContent}</body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.print();
        }

        function exportDetailedResults() {
            const detailedResults = {
                timestamp: new Date().toISOString(),
                metadata: {
                    mainAssembly: bomData.find(item => item.type === 'main_assembly')?.name || 'Unknown',
                    totalAssemblies: bomData.length,
                    workshopAssemblies: workshopItems.length,
                    externalAssemblies: externalItems.length,
                    totalParts: bomData.reduce((total, item) => total + (item.parts || []).length, 0)
                },
                classification: {
                    workshopAssemblies: workshopItems.map(item => ({
                        ...item,
                        classification: 'workshop',
                        partsCount: (item.parts || []).length,
                        subAssembliesCount: (item.subAssemblies || []).length
                    })),
                    externalAssemblies: externalItems.map(item => ({
                        ...item,
                        classification: 'external',
                        partsCount: (item.parts || []).length,
                        subAssembliesCount: (item.subAssemblies || []).length
                    }))
                },
                summary: {
                    workshopParts: workshopItems.reduce((total, item) => total + (item.parts || []).length, 0),
                    externalParts: externalItems.reduce((total, item) => total + (item.parts || []).length, 0),
                    workshopSubAssemblies: workshopItems.reduce((total, item) => total + (item.subAssemblies || []).length, 0),
                    externalSubAssemblies: externalItems.reduce((total, item) => total + (item.subAssemblies || []).length, 0)
                }
            };

            const blob = new Blob([JSON.stringify(detailedResults, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'detailed_bom_classification_report.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (currentIndex < bomData.length) {
                if (e.key === '1' || e.key === 'y' || e.key === 'Y') {
                    classifyItem(true);
                } else if (e.key === '2' || e.key === 'n' || e.key === 'N') {
                    classifyItem(false);
                }
            }
        });

        // Image functionality
        function convertImagePath(imagePath) {
            if (!imagePath || imagePath.trim() === '') {
                return null;
            }
            
            console.log('–û—Ä–∏–≥–∏–Ω–∞–ª–µ–Ω –ø—ä—Ç:', imagePath);
            
            // –ê–∫–æ –ø—ä—Ç—è—Ç –µ –∞–±—Å–æ–ª—é—Ç–µ–Ω, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–∞–º–µ –≥–æ –≤ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª–µ–Ω
            if (imagePath.includes('Screenshots\\')) {
                // –ò–∑–≤–ª–∏—á–∞–º–µ —á–∞—Å—Ç—Ç–∞ —Å–ª–µ–¥ Screenshots
                const parts = imagePath.split('Screenshots\\');
                if (parts.length > 1) {
                    // –ó–∞–º–µ–Ω—è–º–µ –æ–±—Ä–∞—Ç–Ω–∏—Ç–µ —Å–ª–µ—à–æ–≤–µ —Å –æ–±–∏–∫–Ω–æ–≤–µ–Ω–∏
                    let relativePath = parts[1].replace(/\\/g, '/');
                    
                    // –ê–∫–æ –∑–∞–≤—ä—Ä—à–≤–∞ —Å _1_.png, _2_.png –∏ —Ç.–Ω., –º–∞—Ö–∞–º–µ –ø–æ–¥—á–µ—Ä—Ç–∞–≤–∫–∏—Ç–µ
                    // –ü—Ä–∏–º–µ—Ä: "Parts/30_02_S1_1_.png" -> "Parts/30_02_S1_1_.png" (–æ—Å—Ç–∞–≤—è–º–µ –∫–∞–∫—Ç–æ –µ)
                    
                    const finalPath = `images/${relativePath}`;
                    console.log('–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–∞–Ω –ø—ä—Ç:', finalPath);
                    return finalPath;
                }
            }
            
            // –ê–∫–æ –ø—ä—Ç—è—Ç –≤–µ—á–µ –µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª–µ–Ω, –≤—Ä—ä—â–∞–º–µ –≥–æ –∫–∞–∫—Ç–æ –µ
            console.log('–ò–∑–ø–æ–ª–∑–≤–∞–º–µ –æ—Ä–∏–≥–∏–Ω–∞–ª–Ω–∏—è –ø—ä—Ç:', imagePath);
            return imagePath;
        }

        function createImageTooltip(name, imagePath) {
            if (!imagePath) return name;
            
            const convertedPath = convertImagePath(imagePath);
            if (!convertedPath) return name;
            
            return `<span class="image-tooltip" 
                        onmouseover="showTooltip(event, '${convertedPath}')" 
                        onmouseout="hideTooltip()"
                        onclick="showImageModal('${name}', '${convertedPath}')">
                        ${name}
                    </span>`;
        }

        function tryLoadImage(imagePath, callback, attempt = 1) {
            if (attempt > 3) {
                console.log('–í—Å–∏—á–∫–∏ –æ–ø–∏—Ç–∏ –∑–∞ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —Å–Ω–∏–º–∫–∞—Ç–∞ —Å–µ –ø—Ä–æ–≤–∞–ª–∏—Ö–∞:', imagePath);
                callback(false);
                return;
            }

            const img = new Image();
            img.onload = function() {
                console.log('–°–Ω–∏–º–∫–∞—Ç–∞ —Å–µ –∑–∞—Ä–µ–¥–∏ —É—Å–ø–µ—à–Ω–æ:', imagePath);
                callback(true, imagePath);
            };
            
            img.onerror = function() {
                console.log(`–û–ø–∏—Ç ${attempt} - –Ω–µ –º–æ–∂–µ –¥–∞ —Å–µ –∑–∞—Ä–µ–¥–∏:`, imagePath);
                
                if (attempt === 1 && imagePath.includes('Parts/')) {
                    // –ó–∞ —á–∞—Å—Ç–∏ —Å _1_, _2_, –æ–ø–∏—Ç–∞–π –±–µ–∑ —Ç—è—Ö
                    const fileName = imagePath.split('/').pop();
                    if (fileName.includes('_') && fileName.endsWith('.png')) {
                        const baseName = fileName.replace(/_\d+_\.png$/, '.png');
                        const newPath = imagePath.replace(fileName, baseName);
                        console.log('–û–ø–∏—Ç–≤–∞–º –∞–ª—Ç–µ—Ä–Ω–∞—Ç–∏–≤–µ–Ω –ø—ä—Ç:', newPath);
                        tryLoadImage(newPath, callback, attempt + 1);
                        return;
                    }
                }
                
                if (attempt === 2 && imagePath.includes('Parts/')) {
                    // –û–ø–∏—Ç–∞–π —Å _1_ –∞–∫–æ –æ—Å–Ω–æ–≤–Ω–æ—Ç–æ –∏–º–µ –Ω–µ —Ä–∞–±–æ—Ç–∏
                    const fileName = imagePath.split('/').pop();
                    if (!fileName.includes('_1_')) {
                        const baseName = fileName.replace('.png', '_1_.png');
                        const newPath = imagePath.replace(fileName, baseName);
                        console.log('–û–ø–∏—Ç–≤–∞–º —Å _1_:', newPath);
                        tryLoadImage(newPath, callback, attempt + 1);
                        return;
                    }
                }
                
                callback(false);
            };
            
            img.src = imagePath;
        }

        function showTooltip(event, imagePath) {
            // –ü—Ä–µ–º–∞—Ö–≤–∞–º–µ –ø—Ä–µ–¥–∏—à–Ω–∏ tooltip-—É—Ä–∏
            hideTooltip();
            
            console.log('showTooltip –∏–∑–≤–∏–∫–∞–Ω –∑–∞:', imagePath);
            
            tryLoadImage(imagePath, function(success, finalPath) {
                if (!success) {
                    console.log('–ù—è–º–∞ –¥–æ—Å—Ç—ä–ø–Ω–∞ —Å–Ω–∏–º–∫–∞ –∑–∞:', imagePath);
                    return;
                }
                
                const tooltip = document.createElement('div');
                tooltip.className = 'tooltip-image';
                tooltip.id = 'imageTooltip';
                
                // –ò–Ω—Ç–µ–ª–∏–≥–µ–Ω—Ç–Ω–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–∞–Ω–µ —Å–ø—Ä—è–º–æ –ø–æ–∑–∏—Ü–∏—è—Ç–∞ –Ω–∞ –µ–ª–µ–º–µ–Ω—Ç–∞
                const rect = event.target.getBoundingClientRect();
                const windowWidth = window.innerWidth;
                const tooltipWidth = 500; // —à–∏—Ä–∏–Ω–∞—Ç–∞ –Ω–∞ tooltip-–∞
                
                console.log('–ü–æ–∑–∏—Ü–∏—è –Ω–∞ –µ–ª–µ–º–µ–Ω—Ç–∞:', rect.left, rect.right, '–®–∏—Ä–∏–Ω–∞ –Ω–∞ –ø—Ä–æ–∑–æ—Ä–µ—Ü–∞:', windowWidth);
                
                // –ü–æ-–∞–≥—Ä–µ—Å–∏–≤–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ - –∞–∫–æ tooltip-—ä—Ç –±–∏ –∏–∑–ª—è–∑—ä–ª –∏–∑–≤—ä–Ω –µ–∫—Ä–∞–Ω–∞
                const tooltipLeftEdge = rect.left + (rect.width / 2) - (tooltipWidth / 2);
                const tooltipRightEdge = rect.left + (rect.width / 2) + (tooltipWidth / 2);
                
                console.log('Tooltip –±–∏ –±–∏–ª –º–µ–∂–¥—É:', tooltipLeftEdge, '–∏', tooltipRightEdge);
                
                // –ê–∫–æ –ª—è–≤–∞—Ç–∞ —á–∞—Å—Ç –Ω–∞ tooltip-–∞ –±–∏ –±–∏–ª–∞ –∏–∑–≤—ä–Ω –µ–∫—Ä–∞–Ω–∞
                if (tooltipLeftEdge < 0) {
                    tooltip.classList.add('left-aligned');
                    console.log('–î–æ–±–∞–≤–µ–Ω left-aligned –∫–ª–∞—Å - tooltip –±–∏ –∏–∑–ª—è–∑—ä–ª –≤–ª—è–≤–æ');
                }
                // –ê–∫–æ –¥—è—Å–Ω–∞—Ç–∞ —á–∞—Å—Ç –Ω–∞ tooltip-–∞ –±–∏ –±–∏–ª–∞ –∏–∑–≤—ä–Ω –µ–∫—Ä–∞–Ω–∞
                else if (tooltipRightEdge > windowWidth) {
                    tooltip.classList.add('right-aligned');
                    console.log('–î–æ–±–∞–≤–µ–Ω right-aligned –∫–ª–∞—Å - tooltip –±–∏ –∏–∑–ª—è–∑—ä–ª –≤–¥—è—Å–Ω–æ');
                }
                // –ò–Ω–∞—á–µ –∏–∑–ø–æ–ª–∑–≤–∞–º–µ —Ü–µ–Ω—Ç—Ä–∞–ª–Ω–æ—Ç–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–∞–Ω–µ (–ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ)
                else {
                    console.log('–ò–∑–ø–æ–ª–∑–≤–∞–Ω–æ —Ü–µ–Ω—Ç—Ä–∞–ª–Ω–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–∞–Ω–µ - tooltip —Å–µ —Å—ä–±–∏—Ä–∞ –≤ –µ–∫—Ä–∞–Ω–∞');
                }
                
                const img = document.createElement('img');
                img.src = finalPath || imagePath;
                img.style.maxWidth = '100%';
                img.style.height = 'auto';
                
                tooltip.appendChild(img);
                event.target.appendChild(tooltip);
                tooltip.style.display = 'block';
                
                console.log('Tooltip –ø–æ–∫–∞–∑–∞–Ω —Å –∫–ª–∞—Å–æ–≤–µ:', tooltip.className);
            });
        }

        function hideTooltip() {
            const tooltip = document.getElementById('imageTooltip');
            if (tooltip) {
                tooltip.remove();
            }
        }

        function showImageModal(name, imagePath) {
            const modal = document.getElementById('imageModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalImage = document.getElementById('modalImage');
            const noImageMessage = document.getElementById('noImageMessage');
            
            modalTitle.textContent = translateName(name);
            
            if (imagePath && imagePath.trim() !== '') {
                tryLoadImage(imagePath, function(success, finalPath) {
                    if (success) {
                        modalImage.src = finalPath || imagePath;
                        modalImage.style.display = 'block';
                        noImageMessage.style.display = 'none';
                    } else {
                        modalImage.style.display = 'none';
                        noImageMessage.innerHTML = '–ù—è–º–∞ –Ω–∞–ª–∏—á–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞ —Ç–æ–∑–∏ –µ–ª–µ–º–µ–Ω—Ç<br><br><small style="color: #007bff;">üí° –°—ä–≤–µ—Ç: –ü—Ä–æ–≤–µ—Ä–∏ –¥–∞–ª–∏ —Å–Ω–∏–º–∫–∞—Ç–∞ –µ –≤ –ø–∞–ø–∫–∞—Ç–∞ <code>images/</code></small>';
                        noImageMessage.style.display = 'block';
                    }
                });
            } else {
                modalImage.style.display = 'none';
                noImageMessage.innerHTML = '–ù—è–º–∞ —É–∫–∞–∑–∞–Ω –ø—ä—Ç –∫—ä–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ';
                noImageMessage.style.display = 'block';
            }
            
            modal.style.display = 'block';
        }

        function closeImageModal() {
            document.getElementById('imageModal').style.display = 'none';
        }

        // –ó–∞—Ç–≤–∞—Ä—è–Ω–µ –Ω–∞ modal –ø—Ä–∏ –∫–ª–∏–∫–≤–∞–Ω–µ –∏–∑–≤—ä–Ω –Ω–µ–≥–æ
        window.onclick = function(event) {
            const modal = document.getElementById('imageModal');
            if (event.target == modal) {
                closeImageModal();
            }
        };

        // –ó–∞—Ç–≤–∞—Ä—è–Ω–µ –Ω–∞ modal —Å ESC –∫–ª–∞–≤–∏—à
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeImageModal();
            }
        });

        // –ó–∞–ø–∞–∑–≤–∞–Ω–µ –Ω–∞ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏—Ç–µ –æ–±—Ä–∞—Ç–Ω–æ –≤ JSON —Ñ–∞–π–ª–∞
        function saveClassifications() {
            console.log('saveClassifications() —Ñ—É–Ω–∫—Ü–∏—è—Ç–∞ –µ –∏–∑–≤–∏–∫–∞–Ω–∞!');
            console.log('originalJsonData:', originalJsonData);
            console.log('workshopItems:', workshopItems);
            console.log('externalItems:', externalItems);
            
            if (!originalJsonData || (!workshopItems.length && !externalItems.length)) {
                console.log('–ù—è–º–∞ –¥–∞–Ω–Ω–∏ –∑–∞ –∑–∞–ø–∞–∑–≤–∞–Ω–µ!');
                alert('–ù—è–º–∞ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∑–∞ –∑–∞–ø–∞–∑–≤–∞–Ω–µ!');
                return;
            }

            console.log('–ó–∞–ø–æ—á–≤–∞–º–µ –∑–∞–ø–∞–∑–≤–∞–Ω–µ—Ç–æ –Ω–∞ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏—Ç–µ...');

            // –°—ä–∑–¥–∞–≤–∞–º–µ –∫–æ–ø–∏–µ –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω–∏
            const updatedData = JSON.parse(JSON.stringify(originalJsonData));
            console.log('–°—ä–∑–¥–∞–¥–µ–Ω–æ –∫–æ–ø–∏–µ –Ω–∞ –¥–∞–Ω–Ω–∏—Ç–µ');
            
            // –î–æ–±–∞–≤—è–º–µ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∫—ä–º –≤—Å–µ–∫–∏ –µ–ª–µ–º–µ–Ω—Ç
            function addClassificationToItems(items, classificationType) {
                console.log(`–î–æ–±–∞–≤—è–º–µ ${classificationType} –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∫—ä–º:`, items.map(i => i.name));
                
                items.forEach(classifiedItem => {
                    console.log(`–¢—ä—Ä—Å–∏–º: path="${classifiedItem.path}", name="${classifiedItem.name}"`);
                    
                    // –¢—ä—Ä—Å–∏–º –≤ items –∞–∫–æ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—Ç
                    if (updatedData.items) {
                        const matchingItem = updatedData.items.find(item => 
                            (item.path === classifiedItem.path && item.name === classifiedItem.name) ||
                            (item.path === classifiedItem.path && item.originalName === classifiedItem.name) ||
                            (item.name === classifiedItem.name)
                        );
                        if (matchingItem) {
                            console.log(`–ù–∞–º–µ—Ä–µ–Ω –≤ items: ${matchingItem.name}`);
                            matchingItem.classification = classificationType;
                            matchingItem.classificationDate = new Date().toISOString();
                        }
                    }
                    
                    // –¢—ä—Ä—Å–∏–º –≤ assemblies
                    if (updatedData.assemblies) {
                        // –ü—ä—Ä–≤–æ –æ–ø–∏—Ç–≤–∞–º–µ —Ç–æ—á–Ω–æ —Å—ä–≤–ø–∞–¥–µ–Ω–∏–µ
                        let matchingAssembly = updatedData.assemblies.find(asm => 
                            (asm.path === classifiedItem.path && asm.name === classifiedItem.name)
                        );
                        
                        // –ê–∫–æ –Ω–µ –Ω–∞–º–µ—Ä–∏–º, –æ–ø–∏—Ç–≤–∞–º–µ —Å originalName
                        if (!matchingAssembly) {
                            matchingAssembly = updatedData.assemblies.find(asm => 
                                (asm.path === classifiedItem.path && asm.originalName === classifiedItem.name)
                            );
                        }
                        
                        // –ê–∫–æ –ø–∞–∫ –Ω–µ –Ω–∞–º–µ—Ä–∏–º, –æ–ø–∏—Ç–≤–∞–º–µ –¥–∞ –Ω–∞–º–µ—Ä–∏–º –∞—Å–µ–º–±–ª–∏ —Å—ä—Å —Å—ä—â–æ—Ç–æ –±–∞–∑–æ–≤–æ –∏–º–µ
                        if (!matchingAssembly) {
                            matchingAssembly = updatedData.assemblies.find(asm => {
                                // –ü—Ä–æ–≤–µ—Ä—è–≤–∞–º–µ –¥–∞–ª–∏ –ø—ä—Ç—è—Ç —Å—ä–¥—ä—Ä–∂–∞ –∫–ª–∞—Å–∏—Ñ–∏—Ü–∏—Ä–∞–Ω–æ—Ç–æ –∏–º–µ
                                const pathContainsName = asm.path && asm.path.includes(classifiedItem.name);
                                // –ü—Ä–æ–≤–µ—Ä—è–≤–∞–º–µ –¥–∞–ª–∏ –∏–º–µ—Ç–æ –∑–∞–ø–æ—á–≤–∞ —Å—ä—Å —Å—ä—â–æ—Ç–æ –±–∞–∑–æ–≤–æ –∏–º–µ
                                const nameStartsWithBase = asm.name && asm.name.startsWith(classifiedItem.name);
                                
                                return pathContainsName || nameStartsWithBase;
                            });
                        }
                        
                        if (matchingAssembly) {
                            console.log(`–ù–∞–º–µ—Ä–µ–Ω –≤ assemblies: "${matchingAssembly.name}" (—Ç—ä—Ä—Å–µ–Ω: "${classifiedItem.name}")`);
                            matchingAssembly.classification = classificationType;
                            matchingAssembly.classificationDate = new Date().toISOString();
                        } else {
                            console.log(`–ù–ï –µ –Ω–∞–º–µ—Ä–µ–Ω –≤ assemblies: "${classifiedItem.name}"`);
                            console.log('–ù–∞–ª–∏—á–Ω–∏ assemblies:', updatedData.assemblies.map(a => `"${a.name}" (path: "${a.path}")`));
                        }
                    }
                    
                    // –¢—ä—Ä—Å–∏–º –≤ unifiedAssemblies –∞–∫–æ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—Ç
                    if (updatedData.unifiedAssemblies) {
                        const matchingUnified = updatedData.unifiedAssemblies.find(asm => 
                            (asm.name === classifiedItem.name) ||
                            (asm.originalName === classifiedItem.name)
                        );
                        if (matchingUnified) {
                            console.log(`–ù–∞–º–µ—Ä–µ–Ω –≤ unifiedAssemblies: ${matchingUnified.name}`);
                            matchingUnified.classification = classificationType;
                            matchingUnified.classificationDate = new Date().toISOString();
                        }
                    }
                });
            }

            // –î–æ–±–∞–≤—è–º–µ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
            addClassificationToItems(workshopItems, 'workshop');
            addClassificationToItems(externalItems, 'external');

            // –î–æ–±–∞–≤—è–º–µ –º–µ—Ç–∞–¥–∞–Ω–Ω–∏ –∑–∞ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è—Ç–∞
            updatedData.classificationMetadata = {
                classifiedBy: 'HTML Classifier',
                classificationDate: new Date().toISOString(),
                version: '1.0',
                totalClassified: workshopItems.length + externalItems.length,
                workshopCount: workshopItems.length,
                externalCount: externalItems.length
            };

            // –î–æ–±–∞–≤—è–º–µ –≥–ª–æ–±–∞–ª–Ω–∏—Ç–µ RAL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–∫–æ –∏–º–∞ —Ç–∞–∫–∏–≤–∞
            if (Object.keys(globalRalSettings).length > 0) {
                updatedData.globalRalSettings = globalRalSettings;
                console.log('–î–æ–±–∞–≤–µ–Ω–∏ –≥–ª–æ–±–∞–ª–Ω–∏ RAL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:', globalRalSettings);
            }

            // –ó–∞–ø–∏—Å–≤–∞–º–µ —Ñ–∞–π–ª–∞
            const dataStr = JSON.stringify(updatedData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `${updatedData.mainAssembly?.name || 'BOM'}_classified.json`;
            link.click();

            // –ü–æ–∫–∞–∑–≤–∞–º–µ —Å—ä–æ–±—â–µ–Ω–∏–µ –∑–∞ —É—Å–ø–µ—Ö
            const message = document.createElement('div');
            message.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #28a745, #20c997);
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 9999;
                font-weight: bold;
            `;
            message.innerHTML = `
                ‚úÖ –ö–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏—Ç–µ —Å–∞ –∑–∞–ø–∞–∑–µ–Ω–∏!<br>
                <small>–§–∞–π–ª: ${updatedData.mainAssembly?.name || 'BOM'}_classified.json</small>
            `;
            document.body.appendChild(message);

            setTimeout(() => {
                message.remove();
            }, 4000);
        }

        // –ó–∞–ø–∞–∑–≤–∞–º–µ –æ—Ä–∏–≥–∏–Ω–∞–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω–∏ –∫–æ–≥–∞—Ç–æ —Å–µ –∑–∞—Ä–µ–∂–¥–∞—Ç
        let originalJsonData = null;

        // –ì–ª–æ–±–∞–ª–Ω–∏ –ø—Ä–æ–º–µ–Ω–ª–∏–≤–∏ –∑–∞ —Ü–≤–µ—Ç–æ–≤–µ—Ç–µ
        let globalRalSettings = {};

        // –û—Ç–≤–∞—Ä—è–Ω–µ –Ω–∞ —Ü–≤–µ—Ç–æ–≤–∏—è –º–æ–¥–∞–ª
        function openColorModal() {
            const modal = document.getElementById('colorModal');
            
            // –ó–∞—Ä–µ–∂–¥–∞–º–µ –∑–∞–ø–∞–∑–µ–Ω–∏—Ç–µ –≥–ª–æ–±–∞–ª–Ω–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            loadGlobalRalSettings();
            
            modal.style.display = 'flex';
        }

        // –ó–∞—Ç–≤–∞—Ä—è–Ω–µ –Ω–∞ —Ü–≤–µ—Ç–æ–≤–∏—è –º–æ–¥–∞–ª
        function closeColorModal() {
            const modal = document.getElementById('colorModal');
            modal.style.display = 'none';
        }

        // –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –≥–ª–æ–±–∞–ª–Ω–∏ RAL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        function loadGlobalRalSettings() {
            const ralSelects = ['ral-main', 'ral1', 'ral2', 'ral3', 'ral4', 'ral5', 'ral6', 'ral7', 'ral8', 'ral9'];
            
            // –ü—ä—Ä–≤–æ –∏–∑—á–∏—Å—Ç–≤–∞–º–µ –≤—Å–∏—á–∫–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–∏
            ralSelects.forEach(selectId => {
                const selectElement = document.getElementById(selectId);
                if (selectElement) {
                    selectElement.value = '';
                }
            });

            // –ó–∞—Ä–µ–∂–¥–∞–º–µ –∑–∞–ø–∞–∑–µ–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–∫–æ –∏–º–∞ —Ç–∞–∫–∏–≤–∞
            if (Object.keys(globalRalSettings).length > 0) {
                Object.keys(globalRalSettings).forEach(ralKey => {
                    const selectId = ralKey === 'RAL' ? 'ral-main' : ralKey.toLowerCase();
                    const selectElement = document.getElementById(selectId);
                    if (selectElement) {
                        selectElement.value = globalRalSettings[ralKey];
                    }
                });
            }
        }

        // –ó–∞–ø–∞–∑–≤–∞–Ω–µ –Ω–∞ –≥–ª–æ–±–∞–ª–Ω–∏—Ç–µ RAL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        function saveGlobalRalSettings() {
            const ralSelects = ['ral-main', 'ral1', 'ral2', 'ral3', 'ral4', 'ral5', 'ral6', 'ral7', 'ral8', 'ral9'];
            
            globalRalSettings = {};
            
            ralSelects.forEach(selectId => {
                const selectElement = document.getElementById(selectId);
                if (selectElement && selectElement.value) {
                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–≤–∞–º–µ ID-—Ç–æ –æ–±—Ä–∞—Ç–Ω–æ –≤ –ø—Ä–∞–≤–∏–ª–Ω–∏—è –∫–ª—é—á
                    let ralKey = selectId === 'ral-main' ? 'RAL' : selectId.toUpperCase();
                    globalRalSettings[ralKey] = selectElement.value;
                }
            });

            // –ü–æ–∫–∞–∑–≤–∞–º–µ —Å—ä–æ–±—â–µ–Ω–∏–µ –∑–∞ —É—Å–ø–µ—Ö
            const message = document.createElement('div');
            message.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #6f42c1, #5a32a3);
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 9999;
                font-weight: bold;
            `;
            
            message.innerHTML = `
                üé® –ì–ª–æ–±–∞–ª–Ω–∏—Ç–µ RAL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∞ –∑–∞–ø–∞–∑–µ–Ω–∏!<br>
                <small>–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏ ${Object.keys(globalRalSettings).length} RAL –∫–æ–¥–∞</small>
            `;
            document.body.appendChild(message);

            setTimeout(() => {
                message.remove();
            }, 3000);

            console.log('–ì–ª–æ–±–∞–ª–Ω–∏ RAL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:', globalRalSettings);
            
            // –ó–∞—Ç–≤–∞—Ä—è–º–µ –º–æ–¥–∞–ª–∞
            closeColorModal();
        }
    </script>

    <!-- Image Modal -->
    <div id="imageModal" class="image-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</h3>
                <button class="close-btn" onclick="closeImageModal()">&times;</button>
            </div>
            <div class="modal-body">
                <img id="modalImage" src="" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –¥–µ—Ç–∞–π–ª">
                <div id="noImageMessage" class="no-image" style="display: none;">
                    –ù—è–º–∞ –Ω–∞–ª–∏—á–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞ —Ç–æ–∑–∏ –µ–ª–µ–º–µ–Ω—Ç
                </div>
            </div>
        </div>
    </div>

    <!-- RAL Color Modal -->
    <div id="colorModal" class="image-modal" style="display: none;">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh;">
            <div class="modal-header">
                <h3>üé® –ì–ª–æ–±–∞–ª–Ω–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ RAL —Ü–≤–µ—Ç–æ–≤–µ</h3>
                <button class="close-btn" onclick="closeColorModal()">&times;</button>
            </div>
            <div class="modal-body" style="padding: 20px; overflow-y: auto;">
                <div class="color-selection-container">
                    <div style="margin-bottom: 20px; text-align: center; color: #6c757d;">
                        <p>–ó–∞–¥–∞–π—Ç–µ —Å—Ç–æ–π–Ω–æ—Å—Ç–∏—Ç–µ –∑–∞ –≤—Å–µ–∫–∏ RAL –∫–æ–¥, –∫–æ–∏—Ç–æ —â–µ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞—Ç –≤ –ø—Ä–æ–µ–∫—Ç–∞</p>
                    </div>
                    
                    <div class="ral-options">
                        <div class="ral-option">
                            <label>RAL:</label>
                            <select id="ral-main">
                                <option value="">-- –ò–∑–±–µ—Ä–∏ --</option>
                                <option value="RAL 9005">RAL 9005</option>
                                <option value="RAL 5009">RAL 5009</option>
                                <option value="RAL 3020">RAL 3020</option>
                            </select>
                        </div>
                        <div class="ral-option">
                            <label>RAL1:</label>
                            <select id="ral1">
                                <option value="">-- –ò–∑–±–µ—Ä–∏ --</option>
                                <option value="RAL 3020">RAL 3020</option>
                                <option value="Zn">Zn</option>
                            </select>
                        </div>
                        <div class="ral-option">
                            <label>RAL2:</label>
                            <select id="ral2">
                                <option value="">-- –ò–∑–±–µ—Ä–∏ --</option>
                                <option value="RAL 9010">RAL 9010</option>
                                <option value="Zn">Zn</option>
                            </select>
                        </div>
                        <div class="ral-option">
                            <label>RAL3:</label>
                            <select id="ral3">
                                <option value="">-- –ò–∑–±–µ—Ä–∏ --</option>
                                <option value="RAL 9006">RAL 9006</option>
                                <option value="Zn">Zn</option>
                            </select>
                        </div>
                        <div class="ral-option">
                            <label>RAL4:</label>
                            <select id="ral4">
                                <option value="">-- –ò–∑–±–µ—Ä–∏ --</option>
                                <option value="RAL 9006">RAL 9006</option>
                                <option value="Zn">Zn</option>
                            </select>
                        </div>
                        <div class="ral-option">
                            <label>RAL5:</label>
                            <select id="ral5">
                                <option value="">-- –ò–∑–±–µ—Ä–∏ --</option>
                                <option value="RAL 9006">RAL 9006</option>
                                <option value="Zn">Zn</option>
                            </select>
                        </div>
                        <div class="ral-option">
                            <label>RAL6:</label>
                            <select id="ral6">
                                <option value="">-- –ò–∑–±–µ—Ä–∏ --</option>
                                <option value="RAL 1003">RAL 1003</option>
                                <option value="Zn">Zn</option>
                            </select>
                        </div>
                        <div class="ral-option">
                            <label>RAL7:</label>
                            <select id="ral7">
                                <option value="">-- –ò–∑–±–µ—Ä–∏ --</option>
                                <option value="RAL 9010">RAL 9010</option>
                                <option value="Zn">Zn</option>
                            </select>
                        </div>
                        <div class="ral-option">
                            <label>RAL8:</label>
                            <select id="ral8">
                                <option value="">-- –ò–∑–±–µ—Ä–∏ --</option>
                                <option value="RAL 9010">RAL 9010</option>
                                <option value="RAL 9005">RAL 9005</option>
                                <option value="RAL 3020">RAL 3020</option>
                                <option value="Zn">Zn</option>
                            </select>
                        </div>
                        <div class="ral-option">
                            <label>RAL9:</label>
                            <select id="ral9">
                                <option value="">-- –ò–∑–±–µ—Ä–∏ --</option>
                                <option value="RAL 9007">RAL 9007</option>
                                <option value="RAL 7024">RAL 7024</option>
                            </select>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn-color" onclick="saveGlobalRalSettings()">
                            üíæ –ó–∞–ø–∞–∑–∏ –≥–ª–æ–±–∞–ª–Ω–∏—Ç–µ RAL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
