<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèÜ –û–±–µ–¥–∏–Ω–µ–Ω BOM –í–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä</title>
    <style>
        .ral-highlight {
            background: linear-gradient(135deg, #6f42c1, #5a32a3);
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
        }

        .parts-summary-global,
        .parts-summary-by-object {
            margin: 20px 0;
        }

        .object-summary {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }

        .quantity-cell {
            text-align: center;
            font-weight: bold;
            color: #007bff;
        }

        .objects-cell {
            font-style: italic;
            color: #6c757d;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            margin: 0;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .network-status {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .status-online { background: #28a745; }
        .status-offline { background: #dc3545; }

        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }

        /* –ü—Ä–µ–º–∞—Ö–Ω–∞—Ç–æ –º–µ–Ω—é—Ç–æ –∑–∞ —Ä—ä—á–Ω–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ JSON —Ñ–∞–π–ª–∞ */

        .btn {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,123,255,0.3);
        }

        .objects-summary {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .objects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .object-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-left: 4px solid #007bff;
        }

        .object-card h3 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 1.3em;
        }

        .object-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #007bff;
        }

        .stat-label {
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 5px;
        }

        .ral-summary {
            margin-top: 15px;
        }

        .ral-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }

        .ral-tag {
            background: linear-gradient(135deg, #6f42c1, #5a32a3);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8em;
        }

        .content-tabs {
            padding: 0 30px;
        }

        .tab-buttons {
            display: flex;
            border-bottom: 2px solid #dee2e6;
            margin-bottom: 20px;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 15px 25px;
            cursor: pointer;
            font-size: 16px;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-button.active {
            border-bottom-color: #007bff;
            color: #007bff;
            font-weight: bold;
        }

        .tab-content {
            display: none;
            padding-bottom: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .bom-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: visible; /* –ü—Ä–æ–º–µ–Ω–µ–Ω–æ –æ—Ç hidden - –∑–∞ –¥–∞ —Å–µ –≤–∏–∂–¥–∞—Ç tooltip-–æ–≤–µ—Ç–µ */
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .bom-table th {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 15px 20px;
            text-align: left;
            font-weight: bold;
        }

        .bom-table td {
            padding: 12px 20px;
            border-bottom: 1px solid #dee2e6;
        }

        .bom-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .bom-table tr:hover {
            background-color: #e3f2fd;
        }

        .level-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            color: white;
            text-align: center;
            line-height: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
        }

        .level-1 { background: #28a745; }
        .level-2 { background: #007bff; }
        .level-3 { background: #ffc107; color: #000; }
        .level-4 { background: #dc3545; }
        .level-5 { background: #6f42c1; }

        .object-filter {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .filter-select {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 14px;
            margin: 0 10px;
        }

        .ral-highlight {
            background: linear-gradient(135deg, #6f42c1, #5a32a3);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }

        .assembly-indicator {
            color: #28a745;
            font-weight: bold;
        }

        .global-stats {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            text-align: center;
        }

        .expandable-assemblies {
            margin-top: 20px;
        }

        .assembly-table {
            margin-bottom: 10px;
        }

        .assembly-row {
            background-color: #f8f9fa !important;
            font-weight: bold;
        }

        .assembly-row:hover {
            background-color: #e9ecef !important;
        }

        .expand-icon {
            display: inline-block;
            width: 20px;
            text-align: center;
            color: #007bff;
            font-weight: bold;
            margin-right: 10px;
            transition: transform 0.2s ease;
        }

        .part-row {
            background-color: #ffffff;
            font-size: 0.9em;
        }

        .part-row td {
            border-top: 1px solid #e9ecef;
            padding: 8px 15px;
        }

        .parts-table {
            border-top: 1px solid #dee2e6;
            background-color: #f8f9fa;
        }

        .global-stats h3 {
            margin: 0 0 15px 0;
        }

        .global-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .global-stat-item {
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 5px;
        }

        .hidden {
            display: none;
        }

        /* Data Table Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            background: white;
            border-radius: 8px;
            overflow: visible;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .data-table th {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 15px 20px;
            text-align: left;
            font-weight: bold;
        }
        
        .data-table td {
            padding: 12px 20px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .data-table tr:hover {
            background-color: #e3f2fd;
        }

        /* Image Tooltip Styles */
        /* –û—Å–∏–≥—É—Ä—è–≤–∞–Ω–µ —á–µ —Ç–∞–±–ª–∏—Ü–∏—Ç–µ –Ω–µ —Ä–µ–∂–∞—Ç tooltip-–æ–≤–µ—Ç–µ */
        table {
            overflow: visible !important;
        }
        
        td, th {
            overflow: visible !important;
        }
        
        .image-tooltip {
            position: relative;
            cursor: pointer;
            color: #007bff;
            text-decoration: underline;
        }

        .image-tooltip:hover {
            color: #0056b3;
        }

        .tooltip-image {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(calc(-50% + 40px)); /* ÔøΩ?–∑–º–µ—Å—Ç–µ–Ω 40px –Ω–∞–¥—è—Å–Ω–æ */
            margin-bottom: 10px;
            background: white;
            padding: 8px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            border: 2px solid #007bff;
            z-index: 10000;
            display: none;
            width: 500px;
            pointer-events: none;
        }

        /* –ê–ª—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–∞–Ω–µ –∑–∞ tooltip-–∏ –±–ª–∏–∑–æ –¥–æ –∫—Ä–∞–∏—â–∞—Ç–∞ */
        .tooltip-image.left-aligned {
            left: 40px; /* –ó–∞–ø–æ—á–≤–∞ 40px –æ—Ç –ª–µ–≤–∏—è —Ä—ä–± */
            transform: translateX(0);
            margin-left: 10px;
        }

        .tooltip-image.right-aligned {
            left: auto;
            right: 0;
            transform: translateX(0);
            margin-right: 10px;
        }

        .tooltip-image img {
            width: 100%;
            height: 100%;
            border-radius: 6px;
            object-fit: cover;
            border: 2px solid #007bff;
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .tooltip-image::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: #007bff;
        }

        /* Modal Styles */
        .image-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            position: relative;
            background-color: white;
            margin: 2% auto;
            padding: 0;
            border-radius: 8px;
            width: 85%;
            max-width: 1200px;
            max-height: 90vh;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 12px 16px;
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.1em;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
        }

        .modal-body {
            padding: 15px;
            text-align: center;
            overflow: hidden;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-grow: 1;
        }

        .modal-body img {
            width: 100%;
            height: auto;
            max-height: calc(90vh - 80px);
            border-radius: 6px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            object-fit: contain;
            display: block;
        }

        .no-image {
            color: #6c757d;
            font-style: italic;
            padding: 40px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Assembly Classification Styles */
        .classification-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .classification-content {
            margin-top: 15px;
        }

        .empty-classification {
            text-align: center;
            padding: 40px;
            color: #6c757d;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px dashed #dee2e6;
        }

        .empty-classification-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .empty-classification h4 {
            color: #495057;
            margin-bottom: 10px;
        }

        .empty-classification p {
            margin: 5px 0;
            font-size: 14px;
        }

        .classification-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
            transition: all 0.2s;
        }

        .classification-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .assembly-item {
            padding: 12px 15px;
            margin: 8px 0;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #007bff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }

        .assembly-item:hover {
            background: #e9ecef;
            transform: translateX(3px);
        }

        .assembly-item-name {
            font-weight: 500;
            color: #2c3e50;
        }

        .assembly-item-count {
            color: #6c757d;
            font-size: 14px;
        }

        .move-button {
            padding: 5px 12px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .move-button:hover {
            background: #0056b3;
        }

        .workshop-section .assembly-item {
            border-left-color: #28a745;
        }

        .external-section .assembly-item {
            border-left-color: #dc3545;
        }

        /* Admin Mode Toggle Switch */
        .admin-toggle-container {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255,255,255,0.15);
            padding: 10px 15px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
        }

        .admin-toggle-label {
            font-size: 14px;
            font-weight: 500;
            color: white;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            display: inline-block;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255,255,255,0.3);
            transition: 0.4s;
            border-radius: 26px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #28a745;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        .admin-mode-indicator {
            position: absolute;
            right: 180px;
            top: 20px;
            background: #28a745;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            display: none;
            align-items: center;
            gap: 8px;
            animation: fadeIn 0.3s ease;
        }

        .admin-mode-indicator.active {
            display: flex;
        }

        /* Password Modal */
        .password-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            animation: fadeIn 0.3s ease;
        }

        .password-modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .password-modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            max-width: 400px;
            width: 90%;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .password-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .password-modal-header h2 {
            margin: 0;
            color: #2c3e50;
            font-size: 24px;
        }

        .password-modal-close {
            background: none;
            border: none;
            font-size: 28px;
            color: #6c757d;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            line-height: 1;
            transition: color 0.2s;
        }

        .password-modal-close:hover {
            color: #dc3545;
        }

        .password-modal-body {
            margin-bottom: 20px;
        }

        .password-modal-body p {
            color: #6c757d;
            margin-bottom: 15px;
        }

        .password-input-group {
            position: relative;
        }

        .password-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ced4da;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            box-sizing: border-box;
        }

        .password-input:focus {
            outline: none;
            border-color: #007bff;
        }

        .password-input.error {
            border-color: #dc3545;
        }

        .password-error {
            color: #dc3545;
            font-size: 14px;
            margin-top: 8px;
            display: none;
        }

        .password-error.active {
            display: block;
        }

        .password-modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .password-modal-button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .password-modal-button.primary {
            background: #007bff;
            color: white;
        }

        .password-modal-button.primary:hover {
            background: #0056b3;
        }

        .password-modal-button.secondary {
            background: #6c757d;
            color: white;
        }

        .password-modal-button.secondary:hover {
            background: #545b62;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèóÔ∏è –û–±–µ–¥–∏–Ω–µ–Ω BOM –í–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä</h1>
            <p>–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –æ–±–µ–¥–∏–Ω–µ–Ω–∏ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –æ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –æ–±–µ–∫—Ç–∏</p>
            
            <!-- Admin Mode Toggle -->
            <div class="admin-toggle-container">
                <span class="admin-toggle-label">üë§ –ê–¥–º–∏–Ω —Ä–µ–∂–∏–º</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="adminModeToggle" onchange="toggleAdminMode()">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            
            <!-- Admin Mode Indicator -->
            <div class="admin-mode-indicator" id="adminModeIndicator">
                <span>üîì</span>
                <span>–ê–î–úÔøΩ?–ù –†–ï–ñÔøΩ?–ú</span>
            </div>
            
            <div class="network-status">
                <div class="status-indicator" id="statusIndicator"></div>
                <span id="statusText">–ü—Ä–æ–≤–µ—Ä—è–≤–∞...</span>
            </div>
            <!-- –í–µ—Ä—Å–∏—è –Ω–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ –∑–∞ –∫–µ—à –ø—Ä–æ–≤–µ—Ä–∫–∞ -->
            <div style="position:absolute; left:20px; top:10px; font-size:12px; font-weight:bold; opacity:0.6;">v2025-12-12C</div>
            
            <!-- –ë—É—Ç–æ–Ω –∑–∞ —Ä—ä—á–Ω–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ JSON —Ñ–∞–π–ª -->
            <div style="position:absolute; left:20px; bottom:10px;">
                <input type="file" id="jsonFileInput" accept=".json" style="display: none;" onchange="loadJSONFile(event)">
                <button onclick="document.getElementById('jsonFileInput').click()" 
                        style="padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">
                    üìÅ –ó–∞—Ä–µ–¥–∏ JSON —Ñ–∞–π–ª
                </button>
            </div>
        </div>

        <!-- –ü—Ä–µ–º–∞—Ö–Ω–∞—Ç–æ –º–µ–Ω—é—Ç–æ –∑–∞ —Ä—ä—á–Ω–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ JSON —Ñ–∞–π–ª (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–∞–Ω–æ) -->

        <div id="contentTabs" class="content-tabs hidden">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="showTab('overview')">üìã –ü—Ä–µ–≥–ª–µ–¥</button>
                <button class="tab-button" onclick="showTab('byObject')">üå≥ –î—ä—Ä–≤–æ –Ω–∞ –¥–µ—Ç–∞–π–ª–∏—Ç–µ</button>
                <button class="tab-button" onclick="showTab('partsSummary')">üìä –í—Å–∏—á–∫–∏ —á–∞—Å—Ç–∏</button>
                <button class="tab-button" onclick="showTab('detailsParts')">üîß –î–µ—Ç–∞–π–ª–∏</button>
                <button class="tab-button" onclick="showTab('fastenerParts')">‚öôÔ∏è –ö—Ä–µ–ø–µ–∂–∏</button>
                <button class="tab-button" onclick="showTab('assemblyClassification')">üè≠ –°–≥–ª–æ–±—è–≤–∞–Ω–µ</button>
                <button class="tab-button" onclick="showTab('ralItems')">üé® RAL –µ–ª–µ–º–µ–Ω—Ç–∏</button>
            </div>

            <div id="overviewTab" class="tab-content active">
                <h3>üìã –û–±—â –ø—Ä–µ–≥–ª–µ–¥</h3>
                <div id="overviewContent"></div>
            </div>

            <div id="byObjectTab" class="tab-content">
                <h3>üå≥ ÔøΩ?–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –≤—ä–∑–ª–∏</h3>
                <div id="byObjectContent"></div>
            </div>

            <div id="partsSummaryTab" class="tab-content">
                <h3>üìä –í—Å–∏—á–∫–∏ —á–∞—Å—Ç–∏</h3>
                <div class="object-filter">
                    <label>–†–µ–∂–∏–º –Ω–∞ –æ–±–æ–±—â–µ–Ω–∏–µ:</label>
                    <select id="summaryMode" class="filter-select" onchange="generatePartsSummary()">
                        <option value="global">–í—Å–∏—á–∫–∏ —á–∞—Å—Ç–∏</option>
                        <option value="byObject">–ü–æ –≤—ä–∑–ª–∏</option>
                    </select>
                </div>
                <div id="partsSummaryContent"></div>
            </div>

            <div id="detailsPartsTab" class="tab-content">
                <h3>üîß –î–µ—Ç–∞–π–ª–∏</h3>
                <div class="object-filter">
                    <label>–†–µ–∂–∏–º –Ω–∞ –æ–±–æ–±—â–µ–Ω–∏–µ:</label>
                    <select id="detailsMode" class="filter-select" onchange="generateDetailsParts()">
                        <option value="global">–í—Å–∏—á–∫–∏ –¥–µ—Ç–∞–π–ª–∏ (–æ–±—â–æ)</option>
                        <option value="byObject">–ü–æ –≤—ä–∑–ª–∏</option>
                    </select>
                </div>
                <div id="detailsPartsContent"></div>
            </div>

            <div id="fastenerPartsTab" class="tab-content">
                <h3>‚öôÔ∏è –ö—Ä–µ–ø–µ–∂–∏</h3>
                <div class="object-filter">
                    <label>–†–µ–∂–∏–º –Ω–∞ –æ–±–æ–±—â–µ–Ω–∏–µ:</label>
                    <select id="fastenersMode" class="filter-select" onchange="generateFastenerParts()">
                        <option value="global">–í—Å–∏—á–∫–∏ –∫—Ä–µ–ø–µ–∂–∏ (–æ–±—â–æ)</option>
                        <option value="byObject">–ü–æ –≤—ä–∑–ª–∏</option>
                    </select>
                </div>
                <div id="fastenerPartsContent"></div>
            </div>

            <div id="allPartsTab" class="tab-content">
                <h3>üîß –í—Å–∏—á–∫–∏ —á–∞—Å—Ç–∏ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ (—Å—Ç–∞—Ä —Ç–∞–±)</h3>
                <div class="object-filter">
                    <label>ÔøΩ?–∑–±–µ—Ä–∏ –æ–±–µ–∫—Ç:</label>
                    <select id="partsObjectFilter" class="filter-select" onchange="filterPartsByObject()">
                        <option value="">–í—Å–∏—á–∫–∏ –≤—ä–∑–ª–∏</option>
                    </select>
                </div>
                <div id="allPartsContent"></div>
            </div>

            <div id="allItemsTab" class="tab-content">
                <h3>üìÉ –í—Å–∏—á–∫–∏ –µ–ª–µ–º–µ–Ω—Ç–∏</h3>
                <div id="allItemsContent"></div>
            </div>

            <div id="assemblyClassificationTab" class="tab-content">
                <h3>üè≠ –ö–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ —Å–≥–ª–æ–±—è–≤–∞–Ω–µ—Ç–æ</h3>
                
                <!-- –ë—É—Ç–æ–Ω–∏ –∑–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (—Å–∞–º–æ –≤ –∞–¥–º–∏–Ω —Ä–µ–∂–∏–º) -->
                <div class="classification-controls admin-only-control" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; display: none;">
                    <button onclick="startClassificationWizard()" class="classification-btn" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin-right: 10px;">
                        üè≠ –ó–∞–ø–æ—á–Ω–∏ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è
                    </button>
                    <button onclick="exportClassification()" class="classification-btn" style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin-right: 10px;">
                        üì• –ï–∫—Å–ø–æ—Ä—Ç JSON
                    </button>
                    <button onclick="importClassification()" class="classification-btn" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">
                        üì§ ÔøΩ?–º–ø–æ—Ä—Ç JSON
                    </button>
                    <input type="file" id="classificationFileInput" accept=".json" style="display: none;" onchange="handleClassificationImport(event)">
                </div>
                
                <!-- –°—ä–æ–±—â–µ–Ω–∏–µ –∑–∞ user —Ä–µ–∂–∏–º -->
                <div class="user-mode-message" style="display: none; padding: 12px; background: #e7f3ff; border-left: 4px solid #007bff; border-radius: 4px; margin-bottom: 20px;">
                    ‚ÑπÔ∏è –ö–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è—Ç–∞ –Ω–∞ —Å–±–æ—Ä–∫–∏—Ç–µ –µ –¥–æ—Å—Ç—ä–ø–Ω–∞ —Å–∞–º–æ –≤ –∞–¥–º–∏–Ω —Ä–µ–∂–∏–º
                </div>
                
                <!-- –°–µ–∫—Ü–∏—è 1: –°–≥–ª–æ–±—è–≤–∞–Ω–µ –≤ —Ü–µ—Ö–∞ -->
                <div class="classification-section workshop-section" style="margin-bottom: 30px;">
                    <h4 style="color: #28a745; display: flex; align-items: center; gap: 10px;">
                        üè≠ –°–≥–ª–æ–±—è–≤–∞–Ω–µ –≤ —Ü–µ—Ö–∞ 
                        <span id="workshopCount" style="background: #28a745; color: white; padding: 3px 10px; border-radius: 12px; font-size: 14px;">0</span>
                    </h4>
                    <div id="workshopContent" class="classification-content">
                        <!-- –¢—É–∫ —â–µ —Å–µ –≥–µ–Ω–µ—Ä–∏—Ä–∞ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ—Ç–æ -->
                    </div>
                </div>
                
                <!-- –°–µ–∫—Ü–∏—è 2: –°–≥–ª–æ–±—è–≤–∞–Ω–µ –Ω–∞ –æ–±–µ–∫—Ç–∞ -->
                <div class="classification-section external-section">
                    <h4 style="color: #dc3545; display: flex; align-items: center; gap: 10px;">
                        üè≠Ô∏è –°–≥–ª–æ–±—è–≤–∞–Ω–µ –Ω–∞ –æ–±–µ–∫—Ç–∞ 
                        <span id="externalCount" style="background: #dc3545; color: white; padding: 3px 10px; border-radius: 12px; font-size: 14px;">0</span>
                    </h4>
                    <div id="externalContent" class="classification-content">
                        <!-- –¢—É–∫ —â–µ —Å–µ –≥–µ–Ω–µ—Ä–∏—Ä–∞ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ—Ç–æ -->
                    </div>
                </div>
            </div>

            <div id="ralItemsTab" class="tab-content">
                <h3>üé® –ï–ª–µ–º–µ–Ω—Ç–∏ —Å RAL –∫–æ–¥–æ–≤–µ</h3>
                <div id="ralItemsContent"></div>
            </div>
        </div>
    </div>

    <script>
        // –í–µ—Ä—Å–∏—è –∑–∞ –æ—Ç—Å—Ç—Ä–∞–Ω—è–≤–∞–Ω–µ –Ω–∞ –∫–µ—à –ø—Ä–æ–±–ª–µ–º–∏
        console.log('üöÄ SCRIPT STARTED - Unified BOM Viewer version: v2025-12-12C');
        console.log('üîß Fixes applied: Network status updates & JSON file loading with await');
        console.log('‚úÖ Fixed: Syntax error with startClassificationWizard function');
        
        let bomData = null;
        let currentFilter = "";
        
        // üåê –°–ü–û–î–ï–õ–Ø–ù–ï –ù–ê –î–ê–ù–ùÔøΩ? –ú–ï–ñ–î–£ –£–°–¢–†–û–ô–°–¢–í–ê
        let isSharedMode = false;
        let serverURL = '';
        
        // üîê ADMIN MODE VARIABLES
        let isAdminMode = false;
        const ADMIN_PASSWORD = "2006";
        
        console.log('‚úÖ Variables initialized');
        
        // ============================================
        // üîê ADMIN MODE FUNCTIONS
        // ============================================
        
        // –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –∑–∞–ø–∞–∑–µ–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ
        function loadAdminModeState() {
            const savedMode = localStorage.getItem('adminMode');
            if (savedMode === 'true') {
                isAdminMode = true;
                document.getElementById('adminModeToggle').checked = true;
                document.getElementById('adminModeIndicator').classList.add('active');
                console.log('üîì Admin —Ä–µ–∂–∏–º –≤—ä–∑—Å—Ç–∞–Ω–æ–≤–µ–Ω –æ—Ç localStorage');
            }
        }
        
        // Toggle –Ω–∞ admin —Ä–µ–∂–∏–º–∞
        function toggleAdminMode() {
            const toggle = document.getElementById('adminModeToggle');
            
            if (toggle.checked) {
                // –í–∫–ª—é—á–≤–∞–Ω–µ –Ω–∞ admin —Ä–µ–∂–∏–º - –ø–æ–∫–∞–∑–≤–∞–º–µ modal –∑–∞ –ø–∞—Ä–æ–ª–∞
                showPasswordModal();
            } else {
                // ÔøΩ?–∑–∫–ª—é—á–≤–∞–Ω–µ –Ω–∞ admin —Ä–µ–∂–∏–º
                exitAdminMode();
            }
        }
        
        // –ü–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ password modal
        function showPasswordModal() {
            const modal = document.getElementById('passwordModal');
            const input = document.getElementById('passwordInput');
            const error = document.getElementById('passwordError');
            
            modal.classList.add('active');
            input.value = '';
            input.classList.remove('error');
            error.classList.remove('active');
            
            // Focus –Ω–∞ input —Å–ª–µ–¥ –∫—Ä–∞—Ç–∫–∞ –ø–∞—É–∑–∞ (–∑–∞ –¥–∞ —Ä–∞–±–æ—Ç–∏ –ø—Ä–∞–≤–∏–ª–Ω–æ –∞–Ω–∏–º–∞—Ü–∏—è—Ç–∞)
            setTimeout(() => {
                input.focus();
            }, 100);
        }
        
        // –ó–∞—Ç–≤–∞—Ä—è–Ω–µ –Ω–∞ password modal
        function closePasswordModal() {
            const modal = document.getElementById('passwordModal');
            const toggle = document.getElementById('adminModeToggle');
            
            modal.classList.remove('active');
            
            // –ê–∫–æ –Ω–µ –µ –≤ admin —Ä–µ–∂–∏–º, –≤—Ä—ä—â–∞–º–µ toggle-–∞ –≤ –∏–∑–∫–ª—é—á–µ–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ
            if (!isAdminMode) {
                toggle.checked = false;
            }
        }
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –ø–∞—Ä–æ–ª–∞
        function validatePassword() {
            const input = document.getElementById('passwordInput');
            const error = document.getElementById('passwordError');
            const password = input.value;
            
            if (password === ADMIN_PASSWORD) {
                // –£—Å–ø–µ—à–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è
                enterAdminMode();
                closePasswordModal();
            } else {
                // –ì—Ä–µ—à–Ω–∞ –ø–∞—Ä–æ–ª–∞
                input.classList.add('error');
                error.classList.add('active');
                input.value = '';
                input.focus();
                
                // –ü—Ä–µ–º–∞—Ö–≤–∞–º–µ error –∫–ª–∞—Å–∞ —Å–ª–µ–¥ 2 —Å–µ–∫—É–Ω–¥–∏
                setTimeout(() => {
                    input.classList.remove('error');
                }, 2000);
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ Enter –ø—Ä–∏ –≤—ä–≤–µ–∂–¥–∞–Ω–µ –Ω–∞ –ø–∞—Ä–æ–ª–∞
        function handlePasswordKeyPress(event) {
            if (event.key === 'Enter') {
                validatePassword();
            }
        }
        
        // –í–ª–∏–∑–∞–Ω–µ –≤ admin —Ä–µ–∂–∏–º
        function enterAdminMode() {
            isAdminMode = true;
            localStorage.setItem('adminMode', 'true');
            
            // –ü–æ–∫–∞–∑–≤–∞–º–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
            document.getElementById('adminModeIndicator').classList.add('active');
            
            console.log('üîì Admin —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–∏—Ä–∞–Ω');
            
            // TODO: –û–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ UI –∑–∞ –∞–¥–º–∏–Ω —Ñ—É–Ω–∫—Ü–∏–∏ (–§–∞–∑–∞ 2-6)
            updateUIForAdminMode();
        }
        
        // ÔøΩ?–∑–ª–∏–∑–∞–Ω–µ –æ—Ç admin —Ä–µ–∂–∏–º
        function exitAdminMode() {
            isAdminMode = false;
            localStorage.setItem('adminMode', 'false');
            
            // –°–∫—Ä–∏–≤–∞–º–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
            document.getElementById('adminModeIndicator').classList.remove('active');
            
            console.log('üîí Admin —Ä–µ–∂–∏–º –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–∞–Ω');
            
            // TODO: –û–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ UI –∑–∞ user —Ñ—É–Ω–∫—Ü–∏–∏ (–§–∞–∑–∞ 2-6)
            updateUIForAdminMode();
        }
        
        // –û–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ UI —Å–ø–æ—Ä–µ–¥ admin —Ä–µ–∂–∏–º
        function updateUIForAdminMode() {
            console.log('üîÑ –û–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ UI –∑–∞ —Ä–µ–∂–∏–º:', isAdminMode ? 'ADMIN' : 'USER');
            
            // –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–∞–º–µ RAL —Ä–µ–¥–∞–∫—Ü–∏—è—Ç–∞
            const adminControls = document.querySelectorAll('.admin-only-control');
            const userMessages = document.querySelectorAll('.user-mode-message');
            
            adminControls.forEach(control => {
                if (isAdminMode) {
                    control.disabled = false;
                    control.style.opacity = '1';
                    control.style.cursor = 'pointer';
                } else {
                    control.disabled = true;
                    control.style.opacity = '0.5';
                    control.style.cursor = 'not-allowed';
                }
            });
            
            userMessages.forEach(msg => {
                msg.style.display = isAdminMode ? 'none' : 'inline';
            });
            
            // –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–∞–º–µ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –±—É—Ç–æ–Ω–∏—Ç–µ
            const classificationControls = document.querySelectorAll('.classification-controls');
            classificationControls.forEach(control => {
                control.style.display = isAdminMode ? 'block' : 'none';
            });
            
            // –ü—Ä–µ–∑–∞—Ä–µ–∂–¥–∞–º–µ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è—Ç–∞ –∞–∫–æ –µ –æ—Ç–≤–æ—Ä–µ–Ω —Ç–∞–±—ä—Ç
            if (document.getElementById('assemblyClassificationTab').classList.contains('active')) {
                generateAssemblyClassificationTab();
            }
        }
        
        // ============================================
        // üè≠ ASSEMBLY CLASSIFICATION FUNCTIONS (–§–ê–ó–ê 2)
        // ============================================
        
        // –ì–ª–æ–±–∞–ª–Ω–∞ –ø—Ä–æ–º–µ–Ω–ª–∏–≤–∞ –∑–∞ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è
        let assemblyClassification = {
            workshop: [],    // –ü—ä—Ç–∏—â–∞ –Ω–∞ —Å–±–æ—Ä–∫–∏ –≤ —Ü–µ—Ö–∞
            external: [],    // –ü—ä—Ç–∏—â–∞ –Ω–∞ —Å–±–æ—Ä–∫–∏ –Ω–∞ –æ–±–µ–∫—Ç–∞
            timestamp: null
        };
        
        // –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—Ç localStorage/network
        async function loadAssemblyClassification() {
            console.log('üì• –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è...');
            
            try {
                // –û–ø–∏—Ç–≤–∞–º–µ —Å–µ –¥–∞ –∑–∞—Ä–µ–¥–∏–º –æ—Ç —Å–ø–æ–¥–µ–ª–µ–Ω–∏—Ç–µ –¥–∞–Ω–Ω–∏
                const userData = await loadSharedUserData();
                
                // –¢—ä—Ä—Å–∏–º classification_* –∫–ª—é—á–æ–≤–µ
                const workshop = [];
                const external = [];
                
                for (let key in userData) {
                    if (key.startsWith('classification_')) {
                        const path = key.replace('classification_', '');
                        const category = userData[key];
                        
                        if (category === 'workshop') {
                            workshop.push(path);
                        } else if (category === 'external') {
                            external.push(path);
                        }
                    }
                }
                
                if (workshop.length > 0 || external.length > 0) {
                    assemblyClassification = {
                        workshop: workshop,
                        external: external,
                        timestamp: new Date().toISOString()
                    };
                    console.log('‚úÖ –ö–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞—Ä–µ–¥–µ–Ω–∞:', assemblyClassification);
                } else {
                    console.log('‚ÑπÔ∏è –ù—è–º–∞ –∑–∞–ø–∞–∑–µ–Ω–∞ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è');
                }
            } catch (error) {
                console.error('‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è:', error);
            }
            
            return assemblyClassification;
        }
        
        // –ó–∞–ø–∞–∑–≤–∞–Ω–µ –Ω–∞ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è
        async function saveAssemblyClassification(data) {
            console.log('üíæ –ó–∞–ø–∞–∑–≤–∞–Ω–µ –Ω–∞ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è...', data);
            
            // –ó–∞–ø–∞–∑–≤–∞–º–µ –≤—Å—è–∫–∞ —Å–±–æ—Ä–∫–∞ –æ—Ç–¥–µ–ª–Ω–æ –≤ —Å–ø–æ–¥–µ–ª–µ–Ω–∏—Ç–µ –¥–∞–Ω–Ω–∏
            // –ü—ä—Ä–≤–æ –∏–∑—á–∏—Å—Ç–≤–∞–º–µ —Å—Ç–∞—Ä–∏—Ç–µ classification_* –∑–∞–ø–∏—Å–∏
            const userData = await loadSharedUserData();
            for (let key in userData) {
                if (key.startsWith('classification_')) {
                    await saveUserDataChange(key, null);
                }
            }
            
            // –ó–∞–ø–∞–∑–≤–∞–º–µ workshop —Å–±–æ—Ä–∫–∏—Ç–µ
            for (let path of data.workshop) {
                await saveUserDataChange('classification_' + path, 'workshop');
            }
            
            // –ó–∞–ø–∞–∑–≤–∞–º–µ external —Å–±–æ—Ä–∫–∏—Ç–µ
            for (let path of data.external) {
                await saveUserDataChange('classification_' + path, 'external');
            }
            
            assemblyClassification = data;
            console.log('‚úÖ –ö–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞–ø–∞–∑–µ–Ω–∞');
        }
        
        // –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ —Ç–∞–±–∞ —Å –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è
        async function generateAssemblyClassificationTab() {
            console.log('üè≠ –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ —Ç–∞–± –∑–∞ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è...');
            
            // –ó–∞—Ä–µ–∂–¥–∞–º–µ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è—Ç–∞
            await loadAssemblyClassification();
            
            const workshopContent = document.getElementById('workshopContent');
            const externalContent = document.getElementById('externalContent');
            const workshopCount = document.getElementById('workshopCount');
            const externalCount = document.getElementById('externalCount');
            
            // –ê–∫–æ –Ω—è–º–∞ –¥–∞–Ω–Ω–∏ - –ø–æ–∫–∞–∑–≤–∞–º–µ –ø—Ä–∞–∑–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ
            if (assemblyClassification.workshop.length === 0 && assemblyClassification.external.length === 0) {
                const emptyState = `
                    <div class="empty-classification">
                        <div class="empty-classification-icon">üè≠</div>
                        <h4>–ù—è–º–∞ –∫–ª–∞—Å–∏—Ñ–∏—Ü–∏—Ä–∞–Ω–∏ —Å–±–æ—Ä–∫–∏</h4>
                        <p>–ö–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è—Ç–∞ –ø–æ–º–∞–≥–∞ –¥–∞ —Å–µ –æ—Ä–≥–∞–Ω–∏–∑–∏—Ä–∞—Ç —Å–±–æ—Ä–∫–∏—Ç–µ —Å–ø–æ—Ä–µ–¥ –º—è—Å—Ç–æ—Ç–æ –Ω–∞ —Å–≥–ª–æ–±—è–≤–∞–Ω–µ.</p>
                        <p style="margin-top: 15px; font-weight: 500;">
                            ${isAdminMode ? 
                                '–ù–∞—Ç–∏—Å–Ω–µ—Ç–µ –±—É—Ç–æ–Ω–∞ "üè≠ –ó–∞–ø–æ—á–Ω–∏ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è" –∑–∞ –¥–∞ –∑–∞–ø–æ—á–Ω–µ—Ç–µ.' : 
                                '–í–ª–µ–∑—Ç–µ –≤ –∞–¥–º–∏–Ω —Ä–µ–∂–∏–º –∑–∞ –¥–∞ –∑–∞–ø–æ—á–Ω–µ—Ç–µ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è.'}
                        </p>
                    </div>
                `;
                workshopContent.innerHTML = emptyState;
                externalContent.innerHTML = '';
                workshopCount.textContent = '0';
                externalCount.textContent = '0';
                return;
            }
            
            // –ì–µ–Ω–µ—Ä–∏—Ä–∞–º–µ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ –∑–∞ workshop —Å–±–æ—Ä–∫–∏—Ç–µ
            let workshopHTML = '';
            assemblyClassification.workshop.forEach(path => {
                const assembly = findAssemblyByPath(path);
                if (assembly) {
                    workshopHTML += `
                        <div class="assembly-item">
                            <div>
                                <span class="assembly-item-name">${assembly.name}</span>
                                ${assembly.quantity ? `<span class="assembly-item-count"> (${assembly.quantity} –±—Ä)</span>` : ''}
                            </div>
                            ${isAdminMode ? `
                                <button class="move-button admin-only-control" onclick="moveAssemblyToExternal('${path}')">
                                    ‚Üí –ù–∞ –æ–±–µ–∫—Ç–∞
                                </button>
                            ` : ''}
                        </div>
                    `;
                }
            });
            
            // –ì–µ–Ω–µ—Ä–∏—Ä–∞–º–µ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ –∑–∞ external —Å–±–æ—Ä–∫–∏—Ç–µ
            let externalHTML = '';
            assemblyClassification.external.forEach(path => {
                const assembly = findAssemblyByPath(path);
                if (assembly) {
                    externalHTML += `
                        <div class="assembly-item">
                            <div>
                                <span class="assembly-item-name">${assembly.name}</span>
                                ${assembly.quantity ? `<span class="assembly-item-count"> (${assembly.quantity} –±—Ä)</span>` : ''}
                            </div>
                            ${isAdminMode ? `
                                <button class="move-button admin-only-control" onclick="moveAssemblyToWorkshop('${path}')">
                                    ‚Üí –í —Ü–µ—Ö–∞
                                </button>
                            ` : ''}
                        </div>
                    `;
                }
            });
            
            workshopContent.innerHTML = workshopHTML || '<p style="color: #6c757d; padding: 20px; text-align: center;">–ù—è–º–∞ —Å–±–æ—Ä–∫–∏</p>';
            externalContent.innerHTML = externalHTML || '<p style="color: #6c757d; padding: 20px; text-align: center;">–ù—è–º–∞ —Å–±–æ—Ä–∫–∏</p>';
            workshopCount.textContent = assemblyClassification.workshop.length;
            externalCount.textContent = assemblyClassification.external.length;
        }
        
        // –ü–æ–º–æ—â–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –∑–∞ –Ω–∞–º–∏—Ä–∞–Ω–µ –Ω–∞ —Å–±–æ—Ä–∫–∞ –ø–æ –ø—ä—Ç
        function findAssemblyByPath(path) {
            if (!bomData || !bomData.objects) return null;
            
            for (let obj of bomData.objects) {
                if (obj.flatBOM) {
                    for (let item of obj.flatBOM) {
                        if (item.path === path) {
                            return {
                                name: item.name,
                                path: item.path,
                                quantity: item.quantity,
                                level: item.level
                            };
                        }
                    }
                }
            }
            return null;
        }
        
        // Placeholder ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩ 3-6
        function startClassificationWizard() {
            console.log('üìã –°—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ wizard –∑–∞ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è...');
            
            // –ü–æ–ª—É—á–∞–≤–∞–º–µ level 1 —Å–±–æ—Ä–∫–∏
            wizardAssemblies = getLevel1Assemblies();
            
            if (wizardAssemblies.length === 0) {
                alert('‚ùå –ù—è–º–∞ –Ω–∞–ª–∏—á–Ω–∏ —Å–±–æ—Ä–∫–∏ –∑–∞ –∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è');
                return;
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            wizardCurrentIndex = 0;
            wizardClassifications = {};
            
            // –ü–æ–∫–∞–∑–≤–∞–º–µ wizard-–∞
            document.getElementById('classificationWizard').classList.add('active');
            document.getElementById('wizardTotalCount').textContent = wizardAssemblies.length;
            
            // –ü–æ–∫–∞–∑–≤–∞–º–µ –ø—ä—Ä–≤–∞—Ç–∞ —Å–±–æ—Ä–∫–∞
            showWizardAssembly(0);
        }
        
        function exportClassification() {
            alert('?? ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩ 6');
        }
        
        function importClassification() {
            document.getElementById('classificationFileInput').click();
        }
        
        function handleClassificationImport(event) {
            alert('?? ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩ 6');
        }
        
        function moveAssemblyToExternal(path) {
            alert('? ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩ 4');
        }
        
        function moveAssemblyToWorkshop(path) {
            alert('‚ö† –ü—Ä–µ–º–µ—Å—Ç–≤–∞–Ω–µ—Ç–æ —â–µ –±—ä–¥–µ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–∞–Ω–æ –≤—ä–≤ —Ñ–∞–∑–∞ 4');
        }
        
        // ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩ wizard
        function showWizardAssembly(index) {
            if (index < 0 || index >= wizardAssemblies.length) return;
            
            wizardCurrentIndex = index;
            const assembly = wizardAssemblies[index];
            
            // ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ
            document.getElementById('wizardCurrentIndex').textContent = index + 1;
            const progressPercent = ((index) / wizardAssemblies.length) * 100;
            document.getElementById('wizardProgressFill').style.width = progressPercent + '%';
            
            // ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ
            const wizardBody = document.getElementById('wizardBody');
            wizardBody.innerHTML = `
                <div class="wizard-assembly-info">
                    <div class="wizard-assembly-name">
                        ${assembly.cleanName}
                    </div>
                    <div class="wizard-assembly-details">
                         ÔøΩÔøΩÔøΩÔøΩÔøΩ: ${assembly.objectName} | ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ: ${assembly.quantity} ÔøΩÔøΩ
                    </div>
                </div>
                
                <p class="wizard-question">
                    ÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ?
                </p>
                
                <div class="wizard-buttons">
                    <button class="wizard-choice-btn wizard-btn-workshop" onclick="classifyAssembly('workshop')">
                        <div class="wizard-choice-icon"></div>
                        <div class="wizard-choice-text">ÔøΩ ÔøΩÔøΩÔøΩÔøΩ</div>
                    </button>
                    <button class="wizard-choice-btn wizard-btn-external" onclick="classifyAssembly('external')">
                        <div class="wizard-choice-icon"></div>
                        <div class="wizard-choice-text">ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ</div>
                    </button>
                </div>
            `;
            
            // ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ
            document.getElementById('wizardPrevBtn').disabled = (index === 0);
            document.getElementById('wizardNextBtn').disabled = true;
            
            // ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ/ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ skip ÔøΩÔøΩÔøΩÔøΩÔøΩ
            document.getElementById('wizardSkipBtn').style.display = 'block';
        }
        
        // ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ
        function classifyAssembly(category) {
            const assembly = wizardAssemblies[wizardCurrentIndex];
            console.log(` ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ: ${assembly.cleanName}  ${category}`);
            
            // ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ
            wizardClassifications[assembly.path] = category;
            
            // ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩ
            autoClassifyChildren(assembly.path, category);
            
            // ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ "ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ"
            document.getElementById('wizardNextBtn').disabled = false;
            
            // ÔøΩÔøΩÔøΩ ÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ, ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩ
            if (wizardCurrentIndex === wizardAssemblies.length - 1) {
                setTimeout(() => completeWizard(), 300);
            } else {
                // ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ
                setTimeout(() => wizardNext(), 300);
            }
        }
        
        // ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩ
        function autoClassifyChildren(parentPath, category) {
            const objects = bomData.objects || [];
            let childrenCount = 0;
            
            objects.forEach(obj => {
                if (obj.flatBOM) {
                    obj.flatBOM.forEach(item => {
                        // ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩ (level 2+) ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ
                        if (item.path.startsWith(parentPath + '/') && item.level > 1) {
                            wizardClassifications[item.path] = category;
                            childrenCount++;
                        }
                    });
                }
            });
            
            if (childrenCount > 0) {
                console.log(`    ${childrenCount} ÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩ ${category}`);
            }
        }
        
        // ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ - ÔøΩÔøΩÔøΩÔøΩÔøΩ
        function wizardPrevious() {
            if (wizardCurrentIndex > 0) {
                showWizardAssembly(wizardCurrentIndex - 1);
            }
        }
        
        // ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ - ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ
        function wizardNext() {
            if (wizardCurrentIndex < wizardAssemblies.length - 1) {
                showWizardAssembly(wizardCurrentIndex + 1);
            }
        }
        
        // ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ
        function wizardSkip() {
            if (confirm('ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩ ÔøΩÔøΩÔøΩ, ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ? ÔøΩÔøΩ ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ.')) {
                wizardNext();
            }
        }
        
        // ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩ wizard
        async function completeWizard() {
            console.log(' Wizard ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ! ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ:', wizardClassifications);
            
            // ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ
            const wizardBody = document.getElementById('wizardBody');
            const workshopCount = Object.values(wizardClassifications).filter(c => c === 'workshop').length;
            const externalCount = Object.values(wizardClassifications).filter(c => c === 'external').length;
            
            wizardBody.innerHTML = `
                <div class="wizard-complete">
                    <div class="wizard-complete-icon"></div>
                    <h3 class="wizard-complete-title">ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ!</h3>
                    <div class="wizard-complete-summary">
                        <p> ÔøΩ ÔøΩÔøΩÔøΩÔøΩ: <strong>${workshopCount}</strong> ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ</p>
                        <p> ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ: <strong>${externalCount}</strong> ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ</p>
                    </div>
                    <button class="wizard-complete-btn" onclick="saveAndCloseWizard()">
                         ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ
                    </button>
                </div>
            `;
            
            // ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ footer ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ
            document.querySelector('.wizard-footer').style.display = 'none';
        }
        
        // ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ
        async function saveAndCloseWizard() {
            console.log(' ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ...');
            
            // ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ
            const classificationData = {
                workshop: [],
                external: []
            };
            
            // ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ
            Object.keys(wizardClassifications).forEach(path => {
                const category = wizardClassifications[path];
                if (category === 'workshop') {
                    classificationData.workshop.push(path);
                } else if (category === 'external') {
                    classificationData.external.push(path);
                }
            });
            
            // ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ
            for (const path of classificationData.workshop) {
                await saveUserDataChange('classification_' + path, 'workshop');
            }
            for (const path of classificationData.external) {
                await saveUserDataChange('classification_' + path, 'external');
            }
            
            console.log(' ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ');
            
            // ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ wizard-ÔøΩ
            closeClassificationWizard();
            
            // ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩ
            await loadAssemblyClassification();
            generateAssemblyClassificationTab();
            
            // ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ notification
            alert(' ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ!');
        }
        
        // ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩ wizard
        function closeClassificationWizard() {
            document.getElementById('classificationWizard').classList.remove('active');
            document.querySelector('.wizard-footer').style.display = 'flex';
            wizardAssemblies = [];
            wizardCurrentIndex = 0;
            wizardClassifications = {};
        }
        
        // Placeholder ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩ 4-6
        function exportClassification() {
            alert('?? ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩ 6');
        }
        
        // ============================================
        // üåê NETWORK & SHARED MODE FUNCTIONS
        // ============================================
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—Ç–∫—Ä–∏–≤–∞–Ω–µ –¥–∞–ª–∏ —Ä–∞–±–æ—Ç–∏–º –≤ —Å–ø–æ–¥–µ–ª–µ–Ω —Ä–µ–∂–∏–º
        async function detectSharedMode() {
            console.log('üîç detectSharedMode: Starting...');
            updateNetworkStatus(false, "–ü—Ä–æ–≤–µ—Ä—è–≤–∞ —Ä–µ–∂–∏–º...");
            try {
                const response = await fetch('/get_user_data');
                console.log('üîç detectSharedMode: Response status:', response.status);
                if (response.ok || response.status === 404) { // 404 –µ –û–ö - –æ–∑–Ω–∞—á–∞–≤–∞ —á–µ –Ω—è–º–∞ –¥–∞–Ω–Ω–∏, –Ω–æ —Å—ä—Ä–≤—ä—Ä—ä—Ç —Ä–∞–±–æ—Ç–∏
                    isSharedMode = true;
                    serverURL = window.location.origin;
                    updateNetworkStatus(true, "–ú—Ä–µ–∂–æ–≤ —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–µ–Ω");
                    console.log('üåê –°–ø–æ–¥–µ–ª–µ–Ω —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–∏—Ä–∞–Ω:', serverURL);
                } else {
                    throw new Error('Server not found');
                }
            } catch (error) {
                isSharedMode = false;
                updateNetworkStatus(false, "–õ–æ–∫–∞–ª–µ–Ω —Ä–µ–∂–∏–º");
                console.log('üì± –õ–æ–∫–∞–ª–µ–Ω —Ä–µ–∂–∏–º - –ø—Ä–æ–º–µ–Ω–∏—Ç–µ —Å–µ –∑–∞–ø–∞–∑–≤–∞—Ç —Å–∞–º–æ –Ω–∞ —Ç–æ–≤–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ');
            }
        }

        function updateNetworkStatus(online, text) {
            const indicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            
            if (indicator && statusText) {
                indicator.className = online ? 'status-indicator status-online' : 'status-indicator status-offline';
                statusText.textContent = text;
            }
        }
        
        // –ü–æ–∫–∞–∑–≤–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞ —Å–ø–æ–¥–µ–ª–µ–Ω —Ä–µ–∂–∏–º
        function showSharedModeIndicator() {
            const indicator = document.createElement('div');
            indicator.innerHTML = 'üåê –°–ø–æ–¥–µ–ª–µ–Ω —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–µ–Ω - –ø—Ä–æ–º–µ–Ω–∏—Ç–µ —Å–µ –≤–∏–∂–¥–∞—Ç –æ—Ç –≤—Å–∏—á–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞';
            indicator.style.cssText = `
                position: fixed; top: 10px; right: 10px; z-index: 9999;
                background: #28a745; color: white; padding: 8px 12px;
                border-radius: 5px; font-size: 12px; font-weight: bold;
                box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            `;
            document.body.appendChild(indicator);
            
            // –°–∫—Ä–∏–≤–∞ —Å–ª–µ–¥ 5 —Å–µ–∫—É–Ω–¥–∏
            setTimeout(() => {
                indicator.style.opacity = '0.7';
            }, 5000);
        }
        
        // –ó–∞–ø–∞–∑–≤–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–∏ –¥–∞–Ω–Ω–∏ (checkbox-–∏, –±–µ–ª–µ–∂–∫–∏, RAL)
        async function saveSharedUserData(data) {
            console.log('üåê saveSharedUserData - isSharedMode:', isSharedMode);
            console.log('üåê –î–∞–Ω–Ω–∏ –∑–∞ –∑–∞–ø–∞–∑–≤–∞–Ω–µ:', data);
            
            if (isSharedMode) {
                try {
                    console.log('üåê ÔøΩ?–∑–ø—Ä–∞—â–∞–Ω–µ –∫—ä–º –º—Ä–µ–∂–∞—Ç–∞...');
                    const response = await fetch('/save_user_data', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            timestamp: new Date().toISOString(),
                            user: `${navigator.userAgent.substring(0,20)}...`,
                            data: data
                        })
                    });
                    
                    if (response.ok) {
                        console.log('‚úÖ –°–ø–æ–¥–µ–ª–µ–Ω–∏—Ç–µ –¥–∞–Ω–Ω–∏ —Å–∞ –∑–∞–ø–∞–∑–µ–Ω–∏ –≤ –º—Ä–µ–∂–∞—Ç–∞');
                    } else {
                        console.warn('‚ö†Ô∏è –ì—Ä–µ—à–∫–∞ –≤ –æ—Ç–≥–æ–≤–æ—Ä–∞ –æ—Ç —Å—ä—Ä–≤—ä—Ä–∞:', response.status);
                    }
                } catch (error) {
                    console.warn('‚ö†Ô∏è –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ —Å–ø–æ–¥–µ–ª—è–Ω–µ:', error);
                }
            } else {
                // –õ–æ–∫–∞–ª–Ω–æ –∑–∞–ø–∞–∑–≤–∞–Ω–µ
                console.log('üíæ –õ–æ–∫–∞–ª–Ω–æ –∑–∞–ø–∞–∑–≤–∞–Ω–µ –≤ localStorage...');
                localStorage.setItem('bomUserData', JSON.stringify(data));
                console.log('‚úÖ –î–∞–Ω–Ω–∏—Ç–µ —Å–∞ –∑–∞–ø–∞–∑–µ–Ω–∏ –ª–æ–∫–∞–ª–Ω–æ');
            }
        }

        // –ó–∞—Ä–µ–∂–¥–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–∏ –¥–∞–Ω–Ω–∏
        async function loadSharedUserData() {
            console.log('üì• loadSharedUserData - isSharedMode:', isSharedMode);
            
            if (isSharedMode) {
                try {
                    console.log('üåê –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –æ—Ç –º—Ä–µ–∂–∞—Ç–∞...');
                    const response = await fetch('/get_user_data');
                    if (response.ok) {
                        const data = await response.json();
                        console.log('üì• RAW –¥–∞–Ω–Ω–∏ –æ—Ç —Å—ä—Ä–≤—ä—Ä–∞:', data);
                        
                        // –°—ä—Ä–≤—ä—Ä—ä—Ç –≤—Ä—ä—â–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞: {timestamp: "...", user: "...", data: {...}}
                        // ÔøΩ?–ª–∏ –¥–∏—Ä–µ–∫—Ç–Ω–æ –¥–∞–Ω–Ω–∏—Ç–µ –∞–∫–æ –µ —Å—Ç–∞—Ä —Ñ–æ—Ä–º–∞—Ç
                        let userData = {};
                        if (data.data) {
                            userData = data.data;
                            console.log('üì• ÔøΩ?–∑–≤–ª–µ—á–µ–Ω–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–∏ –¥–∞–Ω–Ω–∏ (–Ω–æ–≤ —Ñ–æ—Ä–º–∞—Ç):', userData);
                        } else if (data.timestamp || data.user) {
                            // –ê–∫–æ –∏–º–∞ timestamp/user –≤ root-–∞, –Ω–æ –Ω—è–º–∞ data –ø–æ–ª–µ
                            userData = {};
                            console.log('üì• –ü—Ä–∞–∑–Ω–∏ –¥–∞–Ω–Ω–∏ (—Å–∞–º–æ –º–µ—Ç–∞–¥–∞–Ω–Ω–∏)');
                        } else {
                            // –î–∏—Ä–µ–∫—Ç–Ω–∏ –¥–∞–Ω–Ω–∏ (—Å—Ç–∞—Ä —Ñ–æ—Ä–º–∞—Ç)
                            userData = data;
                            console.log('üì• ÔøΩ?–∑–≤–ª–µ—á–µ–Ω–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–∏ –¥–∞–Ω–Ω–∏ (—Å—Ç–∞—Ä —Ñ–æ—Ä–º–∞—Ç):', userData);
                        }
                        
                        return userData;
                    } else if (response.status === 404) {
                        console.log('üì• –ù—è–º–∞ –∑–∞–ø–∞–∑–µ–Ω–∏ –¥–∞–Ω–Ω–∏ –≤ –º—Ä–µ–∂–∞—Ç–∞ (–ø—Ä–∞–∑–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ)');
                        return {};
                    } else {
                        console.warn('‚ö†Ô∏è –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –æ—Ç –º—Ä–µ–∂–∞—Ç–∞:', response.status);
                    }
                } catch (error) {
                    console.warn('‚ö†Ô∏è –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —Å–ø–æ–¥–µ–ª–µ–Ω–∏ –¥–∞–Ω–Ω–∏:', error);
                }
            } else {
                // –õ–æ–∫–∞–ª–Ω–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ
                console.log('üíæ –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –æ—Ç localStorage...');
                const stored = localStorage.getItem('bomUserData');
                const data = stored ? JSON.parse(stored) : {};
                console.log('üì• –ó–∞—Ä–µ–¥–µ–Ω–∏ –ª–æ–∫–∞–ª–Ω–∏ –¥–∞–Ω–Ω–∏:', data);
                return data;
            }
            return {};
        }        // –ü–æ–∫–∞–∑–≤–∞ notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.innerHTML = message;
            notification.style.cssText = `
                position: fixed; top: 50px; right: 10px; z-index: 9999;
                background: ${type === 'success' ? '#28a745' : '#17a2b8'}; 
                color: white; padding: 10px 15px; border-radius: 5px;
                font-size: 13px; max-width: 300px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.2);
                animation: slideIn 0.3s ease-out;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        // CSS –∑–∞ –∞–Ω–∏–º–∞—Ü–∏—è
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
        `;
        document.head.appendChild(style);
        
        // ÔøΩ?–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–∞–Ω–µ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ
        window.addEventListener('load', async function() {
            console.log('üöÄ Window load event triggered!');
            
            // –ó–∞—Ä–µ–∂–¥–∞–º–µ admin mode —Å—ä—Å—Ç–æ—è–Ω–∏–µ
            loadAdminModeState();
            
            console.log('üîç Starting detectSharedMode...');
            await detectSharedMode();
            console.log('‚úÖ detectSharedMode completed, isSharedMode:', isSharedMode);
            
            // ÔøΩ?–∑—á–∞–∫–≤–∞–º–µ detectSharedMode –¥–∞ –∑–∞–≤—ä—Ä—à–∏ –∏ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä—è–≤–∞–º–µ –∑–∞ –¥–∞–Ω–Ω–∏
            setTimeout(async () => {
                console.log('‚è∞ Timeout fired, isSharedMode:', isSharedMode);
                if (isSharedMode) {
                    console.log('üåê –ú—Ä–µ–∂–æ–≤ —Ä–µ–∂–∏–º - –ø—Ä–æ–≤–µ—Ä—è–≤–∞–º –∑–∞ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–∏ –¥–∞–Ω–Ω–∏...');
                    // –í –º—Ä–µ–∂–æ–≤ —Ä–µ–∂–∏–º –ø—Ä–æ–≤–µ—Ä—è–≤–∞–º–µ –¥–∞–ª–∏ –∏–º–∞ –∑–∞–ø–∞–∑–µ–Ω–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–∏ –¥–∞–Ω–Ω–∏
                    const networkUserData = await loadSharedUserData();
                    if (Object.keys(networkUserData).length > 0) {
                        console.log('üì• –ù–∞–º–µ—Ä–µ–Ω–∏ –∑–∞–ø–∞–∑–µ–Ω–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–∏ –¥–∞–Ω–Ω–∏ –≤ –º—Ä–µ–∂–∞—Ç–∞:', networkUserData);
                        userDataCache = networkUserData;
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–≤–∞–º–µ –¥–∞–ª–∏ –∏–º–∞ –∑–∞–ø–∞–∑–µ–Ω–∏ BOM –¥–∞–Ω–Ω–∏ –≤ localStorage –∑–∞ –º—Ä–µ–∂–æ–≤–∏—è —Ä–µ–∂–∏–º
                        const savedBOMData = localStorage.getItem('lastLoadedBOMData');
                        if (savedBOMData) {
                            console.log('üîÑ –í—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ BOM –¥–∞–Ω–Ω–∏ –∑–∞ –¥–∞ –ø—Ä–∏–ª–æ–∂–∏–º –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–∏—Ç–µ –¥–∞–Ω–Ω–∏...');
                            bomData = JSON.parse(savedBOMData);
                            displayBOMData();
                        } else {
                            console.log('‚ö†Ô∏è –ù—è–º–∞ –ª–æ–∫–∞–ª–Ω–æ –∫–µ—à–∏—Ä–∞–Ω–∏ BOM –¥–∞–Ω–Ω–∏ - –æ–ø–∏—Ç–≤–∞–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∏–∑–≤–ª–∏—á–∞–Ω–µ –æ—Ç /get_bom');
                            try {
                                showNotification('–ó–∞—Ä–µ–∂–¥–∞–º BOM –æ—Ç —Å—ä—Ä–≤—ä—Ä–∞...', 'info');
                                const resp = await fetch('/get_bom');
                                if (resp.ok) {
                                    const bomJson = await resp.json();
                                    bomData = bomJson;
                                    console.log('‚úÖ –£—Å–ø–µ—à–Ω–æ –∞–≤—Ç–æ-–∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ BOM –æ—Ç —Å—ä—Ä–≤—ä—Ä–∞');
                                    displayBOMData();
                                    updateNetworkStatus(true, "–ú—Ä–µ–∂–æ–≤ —Ä–µ–∂–∏–º - BOM –∑–∞—Ä–µ–¥–µ–Ω");
                                    showNotification('BOM –¥–∞–Ω–Ω–∏—Ç–µ —Å–∞ –∑–∞—Ä–µ–¥–µ–Ω–∏', 'success');
                                } else {
                                    console.warn('‚ùå /get_bom –≤—ä—Ä–Ω–∞ —Å—Ç–∞—Ç—É—Å:', resp.status);
                                    showNotification('–ù–µ—É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ BOM (—Å—Ç–∞—Ç—É—Å ' + resp.status + ')', 'info');
                                }
                            } catch (e) {
                                console.error('‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∞–≤—Ç–æ-–∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ BOM:', e);
                                showNotification('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ BOM. –û–ø–∏—Ç–∞–π—Ç–µ refresh.', 'info');
                            }
                        }
                    } else {
                        console.log('üì≠ –ù—è–º–∞ –∑–∞–ø–∞–∑–µ–Ω–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–∏ –¥–∞–Ω–Ω–∏ –≤ –º—Ä–µ–∂–∞—Ç–∞');
                        // –í—Å–µ –ø–∞–∫ –æ–ø–∏—Ç–≤–∞–º–µ –¥–∞ –∑–∞—Ä–µ–¥–∏–º BOM –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∞–∫–æ –Ω—è–º–∞ user data
                        try {
                            console.log('üåê –û–ø–∏—Ç –∑–∞ –∞–≤—Ç–æ-–∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ BOM –±–µ–∑ user data...');
                            const resp = await fetch('/get_bom');
                            if (resp.ok) {
                                const bomJson = await resp.json();
                                bomData = bomJson;
                                displayBOMData();
                                showNotification('BOM –∑–∞—Ä–µ–¥–µ–Ω (–±–µ–∑ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–∏ –¥–∞–Ω–Ω–∏)', 'success');
                            } else {
                                console.warn('‚ùå /get_bom —Å—Ç–∞—Ç—É—Å:', resp.status);
                            }
                        } catch (e) {
                            console.error('‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ /get_bom –±–µ–∑ user data:', e);
                        }
                    }
                } else {
                    console.log('üíæ –õ–æ–∫–∞–ª–µ–Ω —Ä–µ–∂–∏–º - –ø—Ä–æ–≤–µ—Ä—è–≤–∞–º localStorage...');
                    // –í –ª–æ–∫–∞–ª–µ–Ω —Ä–µ–∂–∏–º –≤—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞–º–µ –ø–æ—Å–ª–µ–¥–Ω–∏—è —Ñ–∞–π–ª –∞–∫–æ –∏–º–∞ —Ç–∞–∫—ä–≤
                    const savedBOMData = localStorage.getItem('lastLoadedBOMData');
                    if (savedBOMData) {
                        try {
                            console.log('üîÑ –í—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ BOM –¥–∞–Ω–Ω–∏ –æ—Ç localStorage...');
                            bomData = JSON.parse(savedBOMData);
                            displayBOMData();
                            updateNetworkStatus(false, "–õ–æ–∫–∞–ª–µ–Ω —Ä–µ–∂–∏–º - BOM –∑–∞—Ä–µ–¥–µ–Ω");
                            console.log('‚úÖ BOM –¥–∞–Ω–Ω–∏—Ç–µ —Å–∞ –≤—ä–∑—Å—Ç–∞–Ω–æ–≤–µ–Ω–∏ —É—Å–ø–µ—à–Ω–æ');
                        } catch (error) {
                            console.error('‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –≤—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ BOM –¥–∞–Ω–Ω–∏:', error);
                            localStorage.removeItem('lastLoadedBOMData');
                        }
                    } else {
                        console.warn('‚ö†Ô∏è –ù—è–º–∞ –∑–∞–ø–∞–∑–µ–Ω–∏ BOM –¥–∞–Ω–Ω–∏ –≤ localStorage');
                        console.log('üìÅ –û–ø–∏—Ç–≤–∞–º –¥–∞ –∑–∞—Ä–µ–¥—è bom_data.json –æ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ç–∞...');
                        
                        // –û–ø–∏—Ç–≤–∞–º–µ —Å–µ –¥–∞ –∑–∞—Ä–µ–¥–∏–º bom_data.json –æ—Ç —Å—ä—â–∞—Ç–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
                        try {
                            const response = await fetch('./bom_data.json');
                            if (response.ok) {
                                const jsonData = await response.json();
                                console.log('‚úÖ bom_data.json —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–¥–µ–Ω –æ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ç–∞');
                                bomData = jsonData;
                                displayBOMData();
                            } else {
                                throw new Error(`–°—Ç–∞—Ç—É—Å: ${response.status}`);
                            }
                        } catch (error) {
                            console.warn('‚ö†Ô∏è –ù–µ –º–æ–≥–∞ –¥–∞ –∑–∞—Ä–µ–¥—è bom_data.json:', error.message);
                            console.log('üí° –ú–æ–ª—è, –∑–∞—Ä–µ–¥–µ—Ç–µ BOM —Ñ–∞–π–ª —á—Ä–µ–∑ Python —Å—ä—Ä–≤—ä—Ä–∞ –Ω–∞ –∞–¥—Ä–µ—Å http://localhost:5000');
                            // –ü–æ–∫–∞–∑–≤–∞–º–µ —Å—ä–æ–±—â–µ–Ω–∏–µ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è
                            document.getElementById('contentTabs').classList.remove('hidden');
                            document.getElementById('overviewContent').innerHTML = `
                                <div style="padding: 40px; text-align: center;">
                                    <h3 style="color: #dc3545;">‚ö†Ô∏è –ù—è–º–∞ –∑–∞—Ä–µ–¥–µ–Ω–∏ BOM –¥–∞–Ω–Ω–∏</h3>
                                    <p style="margin: 20px 0;">–ó–∞ –¥–∞ –∑–∞—Ä–µ–¥–∏—Ç–µ BOM –¥–∞–Ω–Ω–∏, –º–æ–∂–µ—Ç–µ –¥–∞:</p>
                                    <ol style="text-align: left; display: inline-block; margin: 20px auto;">
                                        <li style="margin: 10px 0;">–ü–æ—Å—Ç–∞–≤–µ—Ç–µ —Ñ–∞–π–ª <strong>bom_data.json</strong> –≤ —Å—ä—â–∞—Ç–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –∫–∞—Ç–æ —Ç–æ–∑–∏ HTML —Ñ–∞–π–ª</li>
                                        <li style="margin: 10px 0;">ÔøΩ?–ª–∏ —Å—Ç–∞—Ä—Ç–∏—Ä–∞–π—Ç–µ Python —Å—ä—Ä–≤—ä—Ä–∞ –∏ –æ—Ç–≤–æ—Ä–µ—Ç–µ: <br><strong style="color: #007bff;">http://localhost:5000</strong></li>
                                    </ol>
                                    <p style="margin-top: 20px; color: #6c757d; font-size: 0.9em;">–û–ø—Ä–µ—Å–Ω–µ—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞ —Å–ª–µ–¥ –∫–∞—Ç–æ –¥–æ–±–∞–≤–∏—Ç–µ —Ñ–∞–π–ª–∞.</p>
                                </div>
                            `;
                        }
                    }
                }
            }, 1000); // ÔøΩ?–∑—á–∞–∫–≤–∞–º–µ 1 —Å–µ–∫—É–Ω–¥–∞ –∑–∞ detectSharedMode
        });

        // –†–µ—á–Ω–∏–∫ –∑–∞ –ø—Ä–µ–≤–æ–¥ –Ω–∞ –∑–∞–≥–ª–∞–≤–∏—è—Ç–∞ –Ω–∞ –≤—ä–∑–ª–∏—Ç–µ
        const nodeTranslations = {
            'Bufer Service Shaft': '–°–µ—Ä–≤–∏–∑–µ–Ω –±—É—Ñ–µ—Ä',
            'FR Vrati': '–†–æ–ª–µ—Ç–Ω–∏ –≤—Ä–∞—Ç–∏',
            'Kabina': '–ö–∞–±–∏–Ω–∞',
            'Kula': '–ö—É–ª–∞', 
            'Pod': '–ü–æ–¥',
            'Rampa etaj 1': '–†–∞–º–ø–∞ –µ—Ç–∞–∂ 1',
            'Rampa etaj 5': '–†–∞–º–ø–∞ –µ—Ç–∞–∂ 5',
            'Relsov Pyt Double': '–†–µ–ª—Å–æ–≤ –ø—ä—Ç',
            'Shasi Double': '–®–∞—Å–∏'
        };

        // –§—É–Ω–∫—Ü–∏—è –∑–∞ –ø—Ä–µ–≤–æ–¥ –Ω–∞ –∑–∞–≥–ª–∞–≤–∏—è—Ç–∞ –Ω–∞ –≤—ä–∑–ª–∏—Ç–µ
        function translateNodeTitle(originalTitle) {
            return nodeTranslations[originalTitle] || originalTitle;
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞ —Ä—ä—á–Ω–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ JSON —Ñ–∞–π–ª
        function loadJSONFile(event) {
            const file = event.target.files[0];
            if (!file) {
                console.warn('–ù–µ –µ –∏–∑–±—Ä–∞–Ω —Ñ–∞–π–ª');
                return;
            }
            
            console.log('üìÅ –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —Ñ–∞–π–ª:', file.name);
            updateNetworkStatus(false, "–ó–∞—Ä–µ–∂–¥–∞–º —Ñ–∞–π–ª...");
            
            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    const jsonData = JSON.parse(e.target.result);
                    console.log('‚úÖ JSON —Ñ–∞–π–ª—ä—Ç –µ –ø–∞—Ä—Å–∏—Ä–∞–Ω —É—Å–ø–µ—à–Ω–æ');
                    console.log('üì¶ –î–∞–Ω–Ω–∏ –æ—Ç —Ñ–∞–π–ª–∞:', jsonData);
                    bomData = jsonData;
                    await displayBOMData();
                    
                    // –ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–º–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–ø–æ—Ä–µ–¥ —Ç–µ–∫—É—â–∏—è —Ä–µ–∂–∏–º
                    if (isSharedMode) {
                        updateNetworkStatus(true, "–ú—Ä–µ–∂–æ–≤ —Ä–µ–∂–∏–º - BOM –∑–∞—Ä–µ–¥–µ–Ω");
                    } else {
                        updateNetworkStatus(false, "–õ–æ–∫–∞–ª–µ–Ω —Ä–µ–∂–∏–º - BOM –∑–∞—Ä–µ–¥–µ–Ω");
                    }
                    
                    showNotification('‚úÖ BOM –¥–∞–Ω–Ω–∏—Ç–µ —Å–∞ –∑–∞—Ä–µ–¥–µ–Ω–∏ —É—Å–ø–µ—à–Ω–æ!', 'success');
                } catch (error) {
                    console.error('‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–≤–∞–Ω–µ –Ω–∞ JSON:', error);
                    updateNetworkStatus(false, "–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ");
                    alert('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ —á–µ—Ç–µ–Ω–µ –Ω–∞ JSON —Ñ–∞–π–ª–∞: ' + error.message);
                }
            };
            
            reader.onerror = function() {
                console.error('‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ —á–µ—Ç–µ–Ω–µ –Ω–∞ —Ñ–∞–π–ª–∞');
                updateNetworkStatus(false, "–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ");
                alert('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ —á–µ—Ç–µ–Ω–µ –Ω–∞ —Ñ–∞–π–ª–∞');
            };
            
            reader.readAsText(file);
        }

        /* –ü—Ä–µ–º–∞—Ö–Ω–∞—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è loadBOM() - –≤–µ—á–µ –Ω–µ –µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –ø—Ä–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ */

        async function displayBOMData() {
            console.log('–ó–∞—Ä–µ–¥–µ–Ω–∏ BOM –¥–∞–Ω–Ω–∏:', bomData);
            
            // –ó–∞–ø–∞–∑–≤–∞–º–µ BOM –¥–∞–Ω–Ω–∏—Ç–µ –∑–∞ –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç –∑–∞ –≤—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞–Ω–µ –ø—Ä–∏ refresh
            localStorage.setItem('lastLoadedBOMData', JSON.stringify(bomData));
            console.log('üíæ BOM –¥–∞–Ω–Ω–∏—Ç–µ —Å–∞ –∑–∞–ø–∞–∑–µ–Ω–∏ –≤ localStorage');
            
            // –ó–∞—Ä–µ–∂–¥–∞–º–µ —Å–ø–æ–¥–µ–ª–µ–Ω–∏—Ç–µ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–∏ –¥–∞–Ω–Ω–∏
            await loadAllUserData();
            
            // –ü—Ä–æ–≤–µ—Ä—è–≤–∞–º–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ç–∞ –Ω–∞ –¥–∞–Ω–Ω–∏—Ç–µ –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–∞–º–µ –∞–∫–æ –µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
            if (bomData.objects) {
                // –ù–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ - –ø—Ä–µ–æ–±—Ä–∞–∑—É–≤–∞–º–µ –∫—ä–º –æ—á–∞–∫–≤–∞–Ω–∞—Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
                window.bomData = bomData.objects.map(obj => {
                    // –ê–∫–æ –Ω—è–º–∞ allParts, –≥–µ–Ω–µ—Ä–∏—Ä–∞–º–µ –æ—Ç assemblies
                    let allParts = obj.allParts || [];
                    if (!obj.allParts && obj.assemblies) {
                        allParts = obj.assemblies.map(assembly => ({
                            name: assembly.cleanName || assembly.name,
                            cleanName: assembly.cleanName || assembly.name,
                            path: assembly.path,
                            level: assembly.level,
                            quantity: assembly.quantity,
                            objectSource: assembly.objectSource,
                            hasRAL: assembly.hasRAL,
                            ralType: assembly.ralType,
                            materialSpec: assembly.materialSpec || '',
                            unitPrice: assembly.unitPrice || '',
                            totalPrice: assembly.totalPrice || ''
                        }));
                    }
                    
                    return {
                        objectName: obj.objectName,
                        sourceFile: obj.sourceFile,
                        assemblies: obj.assemblies || [],
                        flatBOM: obj.flatBOM || [],
                        allParts: allParts
                    };
                });
            } else {
                // –°—Ç–∞—Ä–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ - –∏–∑–ø–æ–ª–∑–≤–∞–º–µ –¥–∏—Ä–µ–∫—Ç–Ω–æ
                window.bomData = bomData;
            }
            
            console.log('–û–±—Ä–∞–±–æ—Ç–µ–Ω–∏ BOM –¥–∞–Ω–Ω–∏:', window.bomData);
            
            // –ü–æ–∫–∞–∑–≤–∞–º–µ –æ—Å–Ω–æ–≤–Ω–∏—Ç–µ —Å–µ–∫—Ü–∏–∏
            const contentTabs = document.getElementById('contentTabs');
            if (contentTabs) {
                console.log('‚úÖ –ü–æ–∫–∞–∑–≤–∞–º contentTabs (–ø—Ä–µ–º–∞—Ö–≤–∞–º hidden –∫–ª–∞—Å–∞)');
                contentTabs.classList.remove('hidden');
            } else {
                console.error('‚ùå contentTabs –µ–ª–µ–º–µ–Ω—Ç—ä—Ç –Ω–µ –µ –Ω–∞–º–µ—Ä–µ–Ω!');
            }
            
            // –ì–µ–Ω–µ—Ä–∏—Ä–∞–º–µ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ—Ç–æ
            generateObjectFilter();
            generateOverviewContent();
            generateAllPartsContent();
            generateAllItemsContent();
            generateRalItemsContent();
            
            // –ü—ä—Ä–≤–æ–Ω–∞—á–∞–ª–Ω–æ –ø–æ–∫–∞–∑–≤–∞–º–µ –≤—Å–∏—á–∫–∏ –æ–±–µ–∫—Ç–∏
            filterByObject();
            filterPartsByObject();
        }

        function generateObjectFilter() {
            // –ù–µ –¥–æ–±–∞–≤—è–º–µ –¥–∏–Ω–∞–º–∏—á–Ω–æ –æ–±–µ–∫—Ç–∏—Ç–µ –≤ dropdown-–∞
            // –î–≤–∞—Ç–∞ dropdown-–∞ ('objectFilter' –∏ 'partsObjectFilter') –≤–µ—á–µ –∏–º–∞—Ç –Ω—É–∂–Ω–∏—Ç–µ –æ–ø—Ü–∏–∏ –≤ HTML
        }

        function generateOverviewContent() {
            const objects = bomData.objects || [];
            
            let overviewHTML = '<div class="objects-grid">';
            
            objects.forEach(obj => {
                // –ë—Ä–æ–∏–º –¥–µ—Ç–∞–π–ª–∏—Ç–µ –∏ –∫—Ä–µ–ø–µ–∂–∏—Ç–µ –∑–∞ —Ç–æ–∑–∏ –≤—ä–∑–µ–ª (–∏–∑–ø–æ–ª–∑–≤–∞–º–µ —Å—ä—â–∞—Ç–∞ –ª–æ–≥–∏–∫–∞ –∫–∞—Ç–æ –≤ —Ç–∞–±–∞ "–î–µ—Ç–∞–π–ª–∏")
                let detailsCount = 0;
                let fastenersCount = 0;
                
                // ÔøΩ?–∑–ø–æ–ª–∑–≤–∞–º–µ flatBOM —Å –∏–Ω—Ç–µ–ª–∏–≥–µ–Ω—Ç–Ω–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è
                if (obj.flatBOM) {
                    const processedItems = new Set(); // –ó–∞ –ø—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–µ–Ω–∏—Ç–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
                    
                    obj.flatBOM.forEach(item => {
                        // –°—ä–∑–¥–∞–≤–∞–º–µ —É–Ω–∏–∫–∞–ª–µ–Ω –∫–ª—é—á: –∏–º–µ + –ø—ä—Ç + –Ω–∏–≤–æ
                        const itemKey = `${item.name}|${item.path || ''}|${item.level || 0}`;
                        
                        // –ê–∫–æ –≤–µ—á–µ —Å–º–µ –æ–±—Ä–∞–±–æ—Ç–∏–ª–∏ —Ç–∞–∑–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏—è, –ø—Ä–æ–ø—É—Å–∫–∞–º–µ —è
                        if (processedItems.has(itemKey)) {
                            if (obj.objectName === 'Bufer Service Shaft' || obj.objectName === 'Pod') {
                                console.log(`[DEBUG] –ü–†–û–ü–£–°–ù–ê–¢ –î–£–ë–õÔøΩ?–ö–ê–¢: "${item.name}" (path: ${item.path}, level: ${item.level})`);
                            }
                            return;
                        }
                        
                        processedItems.add(itemKey);
                        
                        if (!item.isAssembly) {
                            if (isFastener(item.name)) {
                                fastenersCount += item.quantity || 1;
                            } else {
                                detailsCount += item.quantity || 1;
                            }
                        }
                    });
                    
                    // Debug –∑–∞ –ø—Ä–æ–±–ª–µ–º–Ω–∏ –≤—ä–∑–ª–∏
                    if (obj.objectName === 'Bufer Service Shaft' || obj.objectName === 'Pod') {
                        console.log(`[DEBUG] ${obj.objectName} (flatBOM —Å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è):`);
                        console.log(`[DEBUG] flatBOM –æ–±—â–æ –µ–ª–µ–º–µ–Ω—Ç–∏: ${obj.flatBOM.length}, —É–Ω–∏–∫–∞–ª–Ω–∏: ${processedItems.size}`);
                        console.log(`[DEBUG] –î–µ—Ç–∞–π–ª–∏: ${detailsCount}, –ö—Ä–µ–ø–µ–∂–∏: ${fastenersCount}`);
                    }
                }
                
                // Debug –∑–∞ HTML –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ—Ç–æ
                if (obj.objectName === 'Bufer Service Shaft' || obj.objectName === 'Pod') {
                    console.log(`[DEBUG] ${obj.objectName} - –ì–ï–ù–ï–†ÔøΩ?–†–ê–ù–ï –ù–ê HTML:`);
                    console.log(`[DEBUG] detailsCount –∑–∞ HTML: ${detailsCount}`);
                    console.log(`[DEBUG] fastenersCount –∑–∞ HTML: ${fastenersCount}`);
                }
                
                overviewHTML += `
                    <div class="object-card">
                        <h3>üè¢ ${translateNodeTitle(obj.objectName)}</h3>
                        <p><strong>ÔøΩ?–∑—Ç–æ—á–Ω–∏–∫:</strong> ${obj.sourceFile}</p>
                        <div style="display: flex; justify-content: space-between; margin-top: 15px;">
                            <div style="text-align: center; flex: 1;">
                                <p style="margin: 0; font-size: 24px; font-weight: bold; color: #007bff;">üîß</p>
                                <p style="margin: 5px 0 0 0; font-weight: bold; color: #007bff;">${detailsCount}</p>
                                <p style="margin: 0; font-size: 12px; color: #6c757d;">–î–µ—Ç–∞–π–ª–∏</p>
                            </div>
                            <div style="text-align: center; flex: 1;">
                                <p style="margin: 0; font-size: 24px; font-weight: bold; color: #28a745;">‚öôÔ∏è</p>
                                <p style="margin: 5px 0 0 0; font-weight: bold; color: #28a745;">${fastenersCount}</p>
                                <p style="margin: 0; font-size: 12px; color: #6c757d;">–ö—Ä–µ–ø–µ–∂–∏</p>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            overviewHTML += '</div>';
            const overviewElement = document.getElementById('overviewContent');
            
            // –ê–ì–†–ï–°ÔøΩ?–í–ù–û –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª–Ω–æ –æ–±–Ω–æ–≤—è–≤–∞–Ω–µ
            if (overviewElement) {
                // –ü—ä—Ä–≤–æ –∏–∑—á–∏—Å—Ç–≤–∞–º–µ –Ω–∞–ø—ä–ª–Ω–æ
                overviewElement.innerHTML = '';
                overviewElement.style.display = 'none';
                
                // –ü—Ä–∏–Ω—É–∂–¥–∞–≤–∞–º–µ –±—Ä–∞—É–∑—ä—Ä–∞ –¥–∞ –æ–±–Ω–æ–≤–∏
                overviewElement.offsetHeight; // trigger reflow
                
                // –î–æ–±–∞–≤—è–º–µ —É–Ω–∏–∫–∞–ª–µ–Ω –∫–ª—é—á –∑–∞ –¥–∞ –∏–∑–±–µ–≥–Ω–µ–º –∫–µ—à–∏—Ä–∞–Ω–µ
                const timestamp = new Date().getTime();
                console.log(`[DEBUG] –û–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ overview –≤ ${timestamp}`);
                
                // –°–ª–µ–¥ —Ç–æ–≤–∞ –∑–∞–¥–∞–≤–∞–º–µ –Ω–æ–≤–æ—Ç–æ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ
                setTimeout(() => {
                    overviewElement.innerHTML = overviewHTML;
                    overviewElement.style.display = 'block';
                    console.log(`[DEBUG] HTML –æ–±–Ω–æ–≤–µ–Ω —É—Å–ø–µ—à–Ω–æ –≤ ${timestamp}`);
                }, 100); // –£–≤–µ–ª–∏—á–∞–≤–∞–º –∑–∞–±–∞–≤—è–Ω–µ—Ç–æ
            } else {
                console.error('[DEBUG] overviewElement –Ω–µ –µ –Ω–∞–º–µ—Ä–µ–Ω!');
            }
        }

        function generateAllPartsContent() {
            let allParts = [];
            
            // –°—ä–±–∏—Ä–∞–º–µ –≤—Å–∏—á–∫–∏ —á–∞—Å—Ç–∏ –æ—Ç –≤—Å–∏—á–∫–∏ –æ–±–µ–∫—Ç–∏
            bomData.objects.forEach(obj => {
                if (obj.allParts) {
                    obj.allParts.forEach(part => {
                        allParts.push({
                            ...part,
                            objectSource: obj.objectName
                        });
                    });
                }
            });
            
            const tableHTML = generatePartsTable(allParts, '–í—Å–∏—á–∫–∏ —á–∞—Å—Ç–∏ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏');
            document.getElementById('allPartsContent').innerHTML = tableHTML;
        }

        function filterPartsByObject() {
            const selectedObject = document.getElementById('partsObjectFilter').value;
            
            let filteredParts = [];
            
            if (selectedObject === "") {
                // –ü–æ–∫–∞–∑–≤–∞–º–µ –≤—Å–∏—á–∫–∏ –æ–±–µ–∫—Ç–∏
                bomData.objects.forEach(obj => {
                    if (obj.allParts) {
                        obj.allParts.forEach(part => {
                            filteredParts.push({
                                ...part,
                                objectSource: obj.objectName
                            });
                        });
                    }
                });
            } else {
                // –ü–æ–∫–∞–∑–≤–∞–º–µ —Å–∞–º–æ –∏–∑–±—Ä–∞–Ω–∏—è –æ–±–µ–∫—Ç
                const selectedObj = bomData.objects.find(obj => obj.objectName === selectedObject);
                if (selectedObj && selectedObj.allParts) {
                    selectedObj.allParts.forEach(part => {
                        filteredParts.push({
                            ...part,
                            objectSource: selectedObj.objectName
                        });
                    });
                }
            }
            
            const tableHTML = generatePartsTable(filteredParts, 
                selectedObject ? `–ß–∞—Å—Ç–∏ –æ—Ç ${selectedObject}` : '–í—Å–∏—á–∫–∏ —á–∞—Å—Ç–∏ –ø–æ –æ–±–µ–∫—Ç–∏');
            document.getElementById('allPartsContent').innerHTML = tableHTML;
        }

        function generatePartsTable(parts, title) {
            if (parts.length === 0) {
                return `<p>–ù—è–º–∞ –¥–∞–Ω–Ω–∏ –∑–∞ –ø–æ–∫–∞–∑–≤–∞–Ω–µ.</p>`;
            }
            
            // –†–∞–∑–¥–µ–ª—è–º–µ —á–∞—Å—Ç–∏—Ç–µ –Ω–∞ –¥–µ—Ç–∞–π–ª–∏ –∏ —Å–±–æ—Ä–∫–∏
            const singleParts = parts.filter(part => part.partType !== '–ü–æ–¥–∞—Å–µ–º–±–ª–∏');
            const assemblies = parts.filter(part => part.partType === '–ü–æ–¥–∞—Å–µ–º–±–ª–∏');
            
            let tableHTML = `<h3>${title} (${parts.length} –æ–±—â–æ: ${singleParts.length} –¥–µ—Ç–∞–π–ª–∞ + ${assemblies.length} —Å–±–æ—Ä–∫–∏)</h3>`;
            
            // –°–µ–∫—Ü–∏—è –∑–∞ –¥–µ—Ç–∞–π–ª–∏ (–µ–¥–∏–Ω–∏—á–Ω–∏ —á–∞—Å—Ç–∏)
            if (singleParts.length > 0) {
                tableHTML += `
                    <div style="margin-bottom: 30px;">
                        <h4 style="color: #007bff; margin: 20px 0 10px 0;">üì¶ –î–µ—Ç–∞–π–ª–∏ (–µ–¥–∏–Ω–∏—á–Ω–∏ —á–∞—Å—Ç–∏) - ${singleParts.length} –±—Ä.</h4>
                        <table class="bom-table">
                            <thead>
                                <tr>
                                    <th style="width: 50px;">‚úì</th>
                                    <th>–ù–∏–≤–æ</th>
                                    <th>–û–±–µ–∫—Ç</th>
                                    <th>ÔøΩ?–º–µ –Ω–∞ —á–∞—Å—Ç—Ç–∞</th>
                                    <th>–¢–∏–ø</th>
                                    <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                    <th>RAL</th>
                                    <th>–ü—ä—Ç</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                singleParts.forEach(part => {
                    const levelClass = `level-${Math.min(part.level, 5)}`;
                    
                    tableHTML += `
                        <tr>
                            <td style="text-align: center;">
                                <input type="checkbox" id="check_${part.name.replace(/[^a-zA-Z0-9]/g, '_')}_${part.objectSource.replace(/[^a-zA-Z0-9]/g, '_')}" 
                                       onchange="updatePartStatus(this)" 
                                       style="transform: scale(1.2);">
                            </td>
                            <td>
                                <span class="level-indicator ${levelClass}">${part.level}</span>
                            </td>
                            <td><strong>${part.objectSource}</strong></td>
                            <td>${part.name}</td>
                            <td><span>${part.partType}</span></td>
                            <td><strong>${part.quantity}</strong></td>
                            <td>
                                ${part.hasRAL ? 
                                    `<span class="ral-highlight">${part.ralType}</span>` : 
                                    '<span style="color: #6c757d;">‚Äî</span>'
                                }
                            </td>
                            <td><small>${part.path}</small></td>
                        </tr>
                    `;
                });
                
                tableHTML += '</tbody></table></div>';
            }
            
            // –°–µ–∫—Ü–∏—è –∑–∞ —Å–±–æ—Ä–∫–∏
            if (assemblies.length > 0) {
                tableHTML += `
                    <div style="margin-bottom: 30px;">
                        <h4 style="color: #28a745; margin: 20px 0 10px 0;">üîß –°–±–æ—Ä–∫–∏ (–≥—Ä—É–ø–∏ –æ—Ç –¥–µ—Ç–∞–π–ª–∏) - ${assemblies.length} –±—Ä.</h4>
                        <table class="bom-table">
                            <thead>
                                <tr>
                                    <th style="width: 50px;">‚úì</th>
                                    <th>–ù–∏–≤–æ</th>
                                    <th>–û–±–µ–∫—Ç</th>
                                    <th>ÔøΩ?–º–µ –Ω–∞ —á–∞—Å—Ç—Ç–∞</th>
                                    <th>–¢–∏–ø</th>
                                    <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                    <th>RAL</th>
                                    <th>–ü—ä—Ç</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                assemblies.forEach(part => {
                    const levelClass = `level-${Math.min(part.level, 5)}`;
                    const typeClass = 'assembly-indicator';
                    
                    tableHTML += `
                        <tr>
                            <td style="text-align: center;">
                                <input type="checkbox" id="check_${part.name.replace(/[^a-zA-Z0-9]/g, '_')}_${part.objectSource.replace(/[^a-zA-Z0-9]/g, '_')}" 
                                       onchange="updatePartStatus(this)" 
                                       style="transform: scale(1.2);">
                            </td>
                            <td>
                                <span class="level-indicator ${levelClass}">${part.level}</span>
                            </td>
                            <td><strong>${part.objectSource}</strong></td>
                            <td class="${typeClass}">${part.name}</td>
                            <td><span class="${typeClass}">${part.partType}</span></td>
                            <td><strong>${part.quantity}</strong></td>
                            <td>
                                ${part.hasRAL ? 
                                    `<span class="ral-highlight">${part.ralType}</span>` : 
                                    '<span style="color: #6c757d;">‚Äî</span>'
                                }
                            </td>
                            <td><small>${part.path}</small></td>
                        </tr>
                    `;
                });
                
                tableHTML += '</tbody></table></div>';
            }
            
            return tableHTML;
        }

        function generateAllItemsContent() {
            let allAssemblies = [];
            
            // –°—ä–±–∏—Ä–∞–º–µ –í–°ÔøΩ?–ß–öÔøΩ? –µ–ª–µ–º–µ–Ω—Ç–∏ (–≤–∫–ª—é—á–∏—Ç–µ–ª–Ω–æ –æ—Ç–¥–µ–ª–Ω–∏—Ç–µ —á–∞—Å—Ç–∏) –æ—Ç flatBOM
            bomData.objects.forEach(obj => {
                // ÔøΩ?–∑–ø–æ–ª–∑–≤–∞–º–µ flatBOM –≤–º–µ—Å—Ç–æ assemblies –∑–∞ –¥–∞ –≤–∫–ª—é—á–∏–º –≤—Å–∏—á–∫–∏ —á–∞—Å—Ç–∏
                if (obj.flatBOM) {
                    obj.flatBOM.forEach(item => {
                        allAssemblies.push({
                            path: item.path,
                            name: item.name,
                            level: item.level,
                            quantity: item.quantity,
                            objectSource: item.objectSource,
                            hasRAL: item.name.includes('RAL'),
                            ralType: item.name.includes('RAL') ? item.name.match(/RAL\d*/)?.[0] : null,
                            isSubAssembly: item.isAssembly,
                            cleanName: item.name
                        });
                    });
                } else {
                    // Fallback –∫—ä–º assemblies –∞–∫–æ –Ω—è–º–∞ flatBOM
                    obj.assemblies.forEach(assembly => {
                        allAssemblies.push({
                            ...assembly,
                            objectSource: obj.objectName
                        });
                    });
                }
            });
            
            const tableHTML = generateAssemblyTable(allAssemblies, '–í—Å–∏—á–∫–∏ –µ–ª–µ–º–µ–Ω—Ç–∏');
            document.getElementById('allItemsContent').innerHTML = tableHTML;
        }

        function generateRalItemsContent() {
            // –ì–µ–Ω–µ—Ä–∏—Ä–∞–º–µ —Ç–∞–±–ª–∏—Ü–∞ –∑–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ RAL —Ü–≤–µ—Ç–æ–≤–µ
            let ralManagementHTML = `
                <div style="margin-bottom: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px; border: 2px solid #007bff;">
                    <h4 style="color: #007bff; margin-bottom: 15px;">üé® –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ RAL —Ü–≤–µ—Ç–æ–≤–µ</h4>
                    <div style="margin-bottom: 15px;">
                        <button onclick="addNewRalEntry()" class="admin-only-control" style="padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">
                            ‚ûï –î–æ–±–∞–≤–∏ –Ω–æ–≤ RAL
                        </button>
                        <button onclick="saveRalData()" class="admin-only-control" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px;">
                            üíæ –ó–∞–ø–∞–∑–∏ –≤—Å–∏—á–∫–∏
                        </button>
                        <span class="user-mode-message" style="display: none; color: #6c757d; font-style: italic; padding: 8px;">
                            ‚ÑπÔ∏è –†–µ–¥–∞–∫—Ü–∏—è—Ç–∞ –Ω–∞ RAL –¥–∞–Ω–Ω–∏ –µ –¥–æ—Å—Ç—ä–ø–Ω–∞ —Å–∞–º–æ –≤ –∞–¥–º–∏–Ω —Ä–µ–∂–∏–º
                        </span>
                        <!-- –ü—Ä–µ–º–∞—Ö–Ω–∞—Ç –±—É—Ç–æ–Ω "–í—ä–∑—Å—Ç–∞–Ω–æ–≤–∏ –ª–∏–ø—Å–≤–∞—â–∏" –∑–∞ RAL -->
                    </div>
                    <table class="data-table" style="width: 100%;">
                        <thead>
                            <tr>
                                <th style="font-weight: bold; color: #007bff; font-size: 14px; text-align: center;">RAL –∫–æ–¥</th>
                                <th style="font-weight: bold; color: #007bff; font-size: 14px; text-align: center;">–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                <th style="font-weight: bold; color: #007bff; font-size: 14px; text-align: center;">ÔøΩ?–∑–±—Ä–∞–Ω–∞ –æ–ø—Ü–∏—è</th>
                                <th style="font-weight: bold; color: #007bff; font-size: 14px; text-align: center;">–¶–≤—è—Ç</th>
                                <th style="font-weight: bold; color: #007bff; font-size: 14px; text-align: center;">–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="ralManagementTableBody">
                        </tbody>
                    </table>
                </div>
            `;
            
            let ralAssemblies = [];
            
            // –°—ä–±–∏—Ä–∞–º–µ –≤—Å–∏—á–∫–∏ RAL –µ–ª–µ–º–µ–Ω—Ç–∏ –æ—Ç flatBOM
            bomData.objects.forEach(obj => {
                if (obj.flatBOM) {
                    obj.flatBOM.forEach(item => {
                        if (item.name.includes('RAL')) {
                            ralAssemblies.push({
                                path: item.path,
                                name: item.name,
                                level: item.level,
                                quantity: item.quantity,
                                objectSource: item.objectSource,
                                hasRAL: true,
                                ralType: item.name.match(/RAL\d*/)?.[0],
                                isSubAssembly: item.isAssembly,
                                cleanName: item.name
                            });
                        }
                    });
                } else {
                    // Fallback –∫—ä–º assemblies
                    obj.assemblies.forEach(assembly => {
                        if (assembly.hasRAL) {
                            ralAssemblies.push({
                                ...assembly,
                                objectSource: obj.objectName
                            });
                        }
                    });
                }
            });
            
            const tableHTML = generateAssemblyTable(ralAssemblies, 'RAL –µ–ª–µ–º–µ–Ω—Ç–∏');
            document.getElementById('ralItemsContent').innerHTML = ralManagementHTML + tableHTML;
            
            // –ó–∞—Ä–µ–∂–¥–∞–º–µ RAL –¥–∞–Ω–Ω–∏—Ç–µ –∏ –ø–æ–ø—ä–ª–≤–∞–º–µ —Ç–∞–±–ª–∏—Ü–∞—Ç–∞
            loadRalManagementTable();
        }

        function filterByObject() {
            // –í–∏–Ω–∞–≥–∏ –ø–æ–∫–∞–∑–≤–∞–º–µ –≤—Å–∏—á–∫–∏ –µ–ª–µ–º–µ–Ω—Ç–∏ (–Ω—è–º–∞ dropdown)
            let filteredAssemblies = [];
            
            // –ü–æ–∫–∞–∑–≤–∞–º–µ –≤—Å–∏—á–∫–∏ –æ–±–µ–∫—Ç–∏ - –∏–∑–ø–æ–ª–∑–≤–∞–º–µ flatBOM
            bomData.objects.forEach(obj => {
                if (obj.flatBOM) {
                    obj.flatBOM.forEach(item => {
                        filteredAssemblies.push({
                            path: item.path,
                            name: item.name,
                            level: item.level,
                            quantity: item.quantity,
                            objectSource: item.objectSource,
                            hasRAL: item.name.includes('RAL'),
                            ralType: item.name.includes('RAL') ? item.name.match(/RAL\d*/)?.[0] : null,
                            isSubAssembly: item.isAssembly,
                            cleanName: item.name,
                            imagePath: item.imagePath || ''
                        });
                    });
                } else {
                    obj.assemblies.forEach(assembly => {
                        filteredAssemblies.push({
                            ...assembly,
                            objectSource: obj.objectName
                        });
                    });
                }
            });
            
            const tableHTML = generateAssemblyTable(filteredAssemblies);
            document.getElementById('byObjectContent').innerHTML = tableHTML;
        }

        function extractMainAssembly(path) {
            // ÔøΩ?–∑–≤–ª–∏—á–∞ –≥–ª–∞–≤–Ω–∏—è –∞—Å–µ–º–±–ª–∏ –æ—Ç –ø—ä—Ç –∫–∞—Ç–æ: "Alibre_BOM_Hierarchical/ALL Bufer Service Komplekt/..."
            // –í—Ä—ä—â–∞ –≤—Ç–æ—Ä–∏—è—Ç –µ–ª–µ–º–µ–Ω—Ç (–≥–ª–∞–≤–Ω–∏—è—Ç –∞—Å–µ–º–±–ª–∏)
            if (!path) return '';
            
            const parts = path.split('/');
            if (parts.length >= 2) {
                return parts[1]; // –í—Ç–æ—Ä–∏—è—Ç –µ–ª–µ–º–µ–Ω—Ç –µ –≥–ª–∞–≤–Ω–∏—è—Ç –∞—Å–µ–º–±–ª–∏
            }
            return parts[0]; // Fallback –∞–∫–æ –Ω—è–º–∞ "/" –≤ –ø—ä—Ç—è
        }

        function generateAssemblyTable(assemblies) {
            if (assemblies.length === 0) {
                return `<p>–ù—è–º–∞ –¥–∞–Ω–Ω–∏ –∑–∞ –ø–æ–∫–∞–∑–≤–∞–Ω–µ.</p>`;
            }
            
            let tableHTML = `
                <table class="bom-table">
                    <thead>
                        <tr>
                            <th>–ù–∏–≤–æ</th>
                            <th>–í—ä–∑–µ–ª</th>
                            <th>ÔøΩ?–º–µ</th>
                            <th>–ü—ä—Ç</th>
                            <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                            <th>RAL</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            assemblies.forEach(assembly => {
                const levelClass = `level-${Math.min(assembly.level, 5)}`;
                // ÔøΩ?–∑–ø–æ–ª–∑–≤–∞–º–µ createImageTooltip –∑–∞ –≤—Å–∏—á–∫–∏ –∏–º–µ–Ω–∞, –ø–æ–¥–∞–≤–∞–π–∫–∏ –¥–∞–ª–∏ –µ –∞—Å–µ–º–±–ª–∏
                const displayName = createImageTooltip(assembly.name, assembly.imagePath || '', assembly.isSubAssembly || false);
                
                // ÔøΩ?–∑–≤–ª–∏—á–∞–º–µ –≥–ª–∞–≤–Ω–∏—è –∞—Å–µ–º–±–ª–∏ –æ—Ç –ø—ä—Ç—è
                const mainAssembly = extractMainAssembly(assembly.path);
                
                tableHTML += `
                    <tr>
                        <td>
                            <span class="level-indicator ${levelClass}">${assembly.level}</span>
                        </td>
                        <td><strong>${mainAssembly}</strong></td>
                        <td>${displayName}</td>
                        <td><small>${assembly.path}</small></td>
                        <td>${assembly.quantity}</td>
                        <td>
                            ${assembly.hasRAL ? 
                                `<span class="ral-highlight">${assembly.ralType}</span>` : 
                                '<span style="color: #6c757d;">‚Äî</span>'
                            }
                        </td>
                    </tr>
                `;
            });
            
            tableHTML += '</tbody></table>';
            return tableHTML;
        }

        function normalizePartName(name) {
            // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –∏–º–µ–Ω–∞—Ç–∞ –Ω–∞ —á–∞—Å—Ç–∏ –∑–∞ –ø—Ä–∞–≤–∏–ª–Ω–æ –≥—Ä—É–ø–∏—Ä–∞–Ω–µ
            if (!name) return '';
            
            let normalized = name.toString().trim();
            
            // –ó–∞–º–µ–Ω—è–º–µ —á–µ—Å—Ç–æ —Å—Ä–µ—â–∞–Ω–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∏ –Ω–∞ –Ω–∞–ø–∏—Å–∞–Ω–∏–µ
            const replacements = {
                'Komplett': 'Komplekt',
                'komplett': 'komplekt',
                'KOMPLETT': 'KOMPLEKT'
            };
            
            // –ó–∞–º–µ–Ω—è–º–µ –∫–∏—Ä–∏–ª—Å–∫–∏ —Å–∏–º–≤–æ–ª–∏ —Å –ª–∞—Ç–∏–Ω—Å–∫–∏ –µ–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–∏
            const cyrillicToLatin = {
                '–ê': 'A', '–ë': 'B', '–í': 'V', '–ì': 'G', '–î': 'D', '–ï': 'E', '–ñ': 'Zh', '–ó': 'Z',
                'ÔøΩ?': 'I', '–ô': 'Y', '–ö': 'K', '–õ': 'L', '–ú': 'M', '–ù': 'N', '–û': 'O', '–ü': 'P',
                '–†': 'R', '–°': 'S', '–¢': 'T', '–£': 'U', '–§': 'F', '–•': 'H', '–¶': 'C', '–ß': 'Ch',
                '–®': 'Sh', '–©': 'Sht', '–™': 'A', '–´': 'Y', '–¨': '', '–≠': 'E', '–Æ': 'Yu', '–Ø': 'Ya',
                '–∞': 'a', '–±': 'b', '–≤': 'v', '–≥': 'g', '–¥': 'd', '–µ': 'e', '–∂': 'zh', '–∑': 'z',
                '–∏': 'i', '–π': 'y', '–∫': 'k', '–ª': 'l', '–º': 'm', '–Ω': 'n', '–æ': 'o', '–ø': 'p',
                '—Ä': 'r', '—Å': 's', '—Ç': 't', '—É': 'u', '—Ñ': 'f', '—Ö': 'h', '—Ü': 'c', '—á': 'ch',
                '—à': 'sh', '—â': 'sht', '—ä': 'a', '—ã': 'y', '—å': '', '—ç': 'e', '—é': 'yu', '—è': 'ya'
            };
            
            // –ü—Ä–∏–ª–∞–≥–∞–º–µ –∑–∞–º–µ–Ω–µ–Ω–∏—Ç–µ
            for (const [from, to] of Object.entries(replacements)) {
                normalized = normalized.replace(new RegExp(from, 'g'), to);
            }
            
            // –ó–∞–º–µ–Ω—è–º–µ –∫–∏—Ä–∏–ª—Å–∫–∏ —Å–∏–º–≤–æ–ª–∏
            for (const [cyrillic, latin] of Object.entries(cyrillicToLatin)) {
                normalized = normalized.replace(new RegExp(cyrillic, 'g'), latin);
            }
            
            return normalized;
        }

        function isFastener(partName) {
            // ÔøΩ?–∑–ø–æ–ª–∑–≤–∞–º–µ –Ω–æ–≤–∞—Ç–∞ –ª–æ–≥–∏–∫–∞ –∑–∞ –∫—Ä–µ–ø–µ–∂–Ω–∏ —á–∞—Å—Ç–∏
            return isFastenerPart(partName);
        }

        function generateDetailsParts() {
            if (!bomData) return;
            
            try {
                const mode = document.getElementById('detailsMode').value;
                const objects = bomData.objects || [];
            
            if (mode === 'global') {
                // –û–±—â–æ –æ–±–æ–±—â–µ–Ω–∏–µ - —Å–∞–º–æ –¥–µ—Ç–∞–π–ª–∏
                const partsSummary = {};
                
                objects.forEach(obj => {
                    obj.flatBOM.forEach(item => {
                        if (!item.isAssembly && !isFastener(item.name)) {
                            if (!partsSummary[item.name]) {
                                partsSummary[item.name] = {
                                    name: item.name,
                                    totalQuantity: 0,
                                    objects: new Set(),
                                    materialSpec: '',
                                    unitPrice: '',
                                    totalPrice: '',
                                    imagePath: item.imagePath || item.path || ''
                                };
                                // Debug - –≤–∏–∂ –∫–∞–∫–≤–æ —Å—ä–¥—ä—Ä–∂–∞ item
                                if (item.name === '04_02_R_RAL5') {
                                    console.log('[DEBUG] item –∑–∞ 04_02_R_RAL5:', item);
                                }
                            }
                            partsSummary[item.name].totalQuantity += item.quantity;
                            partsSummary[item.name].objects.add(item.objectSource);
                            // –ó–∞–ø–∞–∑–≤–∞–º–µ imagePath –∞–∫–æ –≤—Å–µ –æ—â–µ –Ω—è–º–∞
                            if (!partsSummary[item.name].imagePath && item.imagePath) {
                                partsSummary[item.name].imagePath = item.imagePath;
                            }
                        }
                    });
                });
                
                const sortedParts = Object.values(partsSummary).sort((a, b) => {
                    // ÔøΩ?–∑–≤–ª–∏—á–∞–º–µ —á–∏—Å–ª–æ–≤–∞—Ç–∞ —á–∞—Å—Ç –æ—Ç –Ω–∞—á–∞–ª–æ—Ç–æ –Ω–∞ –∏–º–µ—Ç–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä 04_09 -> 04.09)
                    const getNumericValue = (name) => {
                        const match = name.match(/^(\d+)_(\d+)/);
                        if (match) {
                            return parseFloat(match[1] + '.' + match[2]);
                        }
                        // –ê–∫–æ –Ω—è–º–∞ —á–∏—Å–ª–∞ –≤ –Ω–∞—á–∞–ª–æ—Ç–æ, –∏–∑–ø–æ–ª–∑–≤–∞–º–µ –∏–º–µ—Ç–æ –∑–∞ –∞–∑–±—É—á–Ω–æ —Å–æ—Ä—Ç–∏—Ä–∞–Ω–µ
                        return parseFloat('999.' + name.charCodeAt(0));
                    };
                    
                    return getNumericValue(a.name) - getNumericValue(b.name);
                });
                
                let summaryHtml = `
                    <h4>üîß –í—Å–∏—á–∫–∏ –¥–µ—Ç–∞–π–ª–∏</h4>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th style="text-align: left; padding-left: 40px !important; margin-left: 20px; font-weight: bold; color: #007bff; font-size: 14px;">ÔøΩ?–º–µ</th>
                                <th style="font-weight: bold; color: #007bff; font-size: 14px; text-align: center;">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                <th style="text-align: center; font-weight: bold; color: #007bff; font-size: 14px;">–û–±–µ–∫—Ç–∏</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${sortedParts.map(part => `
                                <tr>
                                    <td style="padding-left: 40px;"><strong>${createImageTooltip(part.name, '', false)}</strong></td>
                                    <td style="text-align: center; font-weight: bold; color: #333;">${part.totalQuantity}</td>
                                    <td style="text-align: center;">${Array.from(part.objects).join(', ')}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
                
                document.getElementById('detailsPartsContent').innerHTML = summaryHtml;
            } else {
                // –ü–æ –æ–±–µ–∫—Ç–∏ –ø–æ–æ—Ç–¥–µ–ª–Ω–æ - —Å–∞–º–æ –¥–µ—Ç–∞–π–ª–∏
                let summaryHtml = '';
                
                objects.forEach(obj => {
                    const partsSummary = {};
                    
                    obj.flatBOM.forEach(item => {
                        if (!item.isAssembly && !isFastener(item.name)) {
                            if (!partsSummary[item.name]) {
                                partsSummary[item.name] = {
                                    name: item.name,
                                    totalQuantity: 0,
                                    imagePath: item.imagePath || ''
                                };
                            }
                            partsSummary[item.name].totalQuantity += item.quantity;
                            // –ó–∞–ø–∞–∑–≤–∞–º–µ imagePath –∞–∫–æ –≤—Å–µ –æ—â–µ –Ω—è–º–∞
                            if (!partsSummary[item.name].imagePath && item.imagePath) {
                                partsSummary[item.name].imagePath = item.imagePath;
                            }
                        }
                    });
                    
                    const sortedParts = Object.values(partsSummary).sort((a, b) => {
                        // ÔøΩ?–∑–≤–ª–∏—á–∞–º–µ —á–∏—Å–ª–æ–≤–∞—Ç–∞ —á–∞—Å—Ç –æ—Ç –Ω–∞—á–∞–ª–æ—Ç–æ –Ω–∞ –∏–º–µ—Ç–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä 04_09 -> 04.09)
                        const getNumericValue = (name) => {
                            const match = name.match(/^(\d+)_(\d+)/);
                            if (match) {
                                return parseFloat(match[1] + '.' + match[2]);
                            }
                            // –ê–∫–æ –Ω—è–º–∞ —á–∏—Å–ª–∞ –≤ –Ω–∞—á–∞–ª–æ—Ç–æ, –∏–∑–ø–æ–ª–∑–≤–∞–º–µ –∏–º–µ—Ç–æ –∑–∞ –∞–∑–±—É—á–Ω–æ —Å–æ—Ä—Ç–∏—Ä–∞–Ω–µ
                            return parseFloat('999.' + name.charCodeAt(0));
                        };
                        
                        return getNumericValue(a.name) - getNumericValue(b.name);
                    });
                    
                    if (sortedParts.length > 0) {
                        summaryHtml += `
                            <div class="object-summary">
                                <h4>üîß ${translateNodeTitle(obj.objectName)} (${sortedParts.length} —É–Ω–∏–∫–∞–ª–Ω–∏ –¥–µ—Ç–∞–π–ª–∞)</h4>
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th style="font-weight: bold; color: #007bff; font-size: 14px;">ÔøΩ?–º–µ</th>
                                            <th style="font-weight: bold; color: #007bff; font-size: 14px; text-align: center;">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${sortedParts.map(part => `
                                            <tr>
                                                <td><strong>${createImageTooltip(part.name, part.imagePath, false)}</strong></td>
                                                <td style="text-align: center; font-weight: bold; color: #333;">${part.totalQuantity}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                            <br>
                        `;
                    }
                });
                
                document.getElementById('detailsPartsContent').innerHTML = summaryHtml;
            }
            
            // –í—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞–º–µ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–∏—Ç–µ —Å—ä—Å—Ç–æ—è–Ω–∏—è
            setTimeout(() => restoreUserInterfaceStates(), 100);
            } catch (error) {
                console.error('–ì—Ä–µ—à–∫–∞ –≤ generateDetailsParts:', error);
                document.getElementById('detailsPartsContent').innerHTML = '<p style="color: red;">–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –¥–µ—Ç–∞–π–ª–∏: ' + error.message + '</p>';
            }
        }

        function extractThreadSize(assemblyName) {
            // ÔøΩ?–∑–≤–ª–∏—á–∞ —Ä–∞–∑–º–µ—Ä–∞ –Ω–∞ —Ä–µ–∑–±–∞—Ç–∞ –æ—Ç –∏–º–µ—Ç–æ (M4, M5, M6, M8, M10, M12, –∏ —Ç.–Ω.)
            // –ü–æ–¥–¥—ä—Ä–∂–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ç–µ: M8x20, M10 x 40, Anker M10x80
            const match = assemblyName.match(/M\s*(\d+)(?:\s*x\s*\d+)?/i);
            return match ? parseInt(match[1]) : 999; // 999 –∑–∞ –Ω–µ—Ä–∞–∑–ø–æ–∑–Ω–∞—Ç–∏ —Ä–∞–∑–º–µ—Ä–∏ (—â–µ –±—ä–¥–∞—Ç –Ω–∞–∫—Ä–∞—è)
        }

        function generateFastenerParts() {
            if (!bomData) return;
            
            const mode = document.getElementById('fastenersMode').value;
            const objects = bomData.objects || [];
            
            if (mode === 'global') {
                // –ì–ª–æ–±–∞–ª–µ–Ω —Ä–µ–∂–∏–º - –∏–∑–≤–ª–∏—á–∞–º–µ –°–ê–ú–û –∫—Ä–µ–ø–µ–∂–Ω–∏ —á–∞—Å—Ç–∏ –æ—Ç –≤—Å–∏—á–∫–∏ –≤—ä–∑–ª–∏
                const fastenerParts = {};
                
                objects.forEach(obj => {
                    obj.flatBOM.forEach(item => {
                        // –í–∑–µ–º–∞–º–µ —Å–∞–º–æ –∫—Ä–µ–ø–µ–∂–Ω–∏ —á–∞—Å—Ç–∏ (–Ω–µ –∞—Å–µ–º–±–ª–∏—Ç–∞, –Ω–µ –¥–µ—Ç–∞–π–ª–∏)
                        if (!item.isAssembly && isFastenerPart(item.name)) {
                            const partName = item.name.trim();
                            
                            if (!fastenerParts[partName]) {
                                fastenerParts[partName] = {
                                    name: partName,
                                    totalQuantity: 0,
                                    objects: new Set()
                                };
                            }
                            
                            fastenerParts[partName].totalQuantity += item.quantity;
                            fastenerParts[partName].objects.add(item.objectSource);
                        }
                    });
                });

                // –°–æ—Ä—Ç–∏—Ä–∞–º–µ –∫—Ä–µ–ø–µ–∂–Ω–∏—Ç–µ —á–∞—Å—Ç–∏
                const sortedFasteners = Object.values(fastenerParts).sort((a, b) => {
                    // ÔøΩ?–∑–≤–ª–∏—á–∞–º–µ —Ç–∏–ø–∞ –Ω–∞ —á–∞—Å—Ç—Ç–∞ (–ø—ä—Ä–≤–∞—Ç–∞ –¥—É–º–∞)
                    const typeA = a.name.split(' ')[0]; // "Bolt", "Nut", "Washer", etc.
                    const typeB = b.name.split(' ')[0];
                    
                    // –ü—ä—Ä–≤–æ —Å–æ—Ä—Ç–∏—Ä–∞–º–µ –ø–æ —Ç–∏–ø (–∞–∑–±—É—á–µ–Ω —Ä–µ–¥)
                    if (typeA !== typeB) {
                        return typeA.localeCompare(typeB);
                    }
                    
                    // –í —Ä–∞–º–∫–∏—Ç–µ –Ω–∞ —Å—ä—â–∏—è —Ç–∏–ø, —Å–æ—Ä—Ç–∏—Ä–∞–º–µ –ø–æ —Ä–∞–∑–º–µ—Ä –Ω–∞ —Ä–µ–∑–±–∞—Ç–∞
                    const sizeA = extractThreadSize(a.name);
                    const sizeB = extractThreadSize(b.name);
                    
                    // –ê–∫–æ –∏ –¥–≤–µ—Ç–µ –∏–º–∞—Ç —Ä–∞–∑–º–µ—Ä –Ω–∞ —Ä–µ–∑–±–∞, —Å–æ—Ä—Ç–∏—Ä–∞–º–µ –ø–æ —Ä–∞–∑–º–µ—Ä
                    if (sizeA !== 999 && sizeB !== 999) {
                        if (sizeA !== sizeB) {
                            return sizeA - sizeB; // M4 ‚Üí M6 ‚Üí M8 ‚Üí M10 ‚Üí M12
                        }
                    }
                    
                    // –ü—Ä–∏ –µ–¥–Ω–∞–∫—ä–≤ —Ä–∞–∑–º–µ—Ä –∏–ª–∏ –ª–∏–ø—Å–∞ –Ω–∞ —Ä–∞–∑–º–µ—Ä, —Å–æ—Ä—Ç–∏—Ä–∞–º–µ –ø–æ –∞–∑–±—É—á–µ–Ω —Ä–µ–¥ –Ω–∞ —Ü—è–ª–æ—Ç–æ –∏–º–µ
                    return a.name.localeCompare(b.name);
                });
                
                let summaryHtml = `<h4>‚öôÔ∏è –í—Å–∏—á–∫–∏ –∫—Ä–µ–ø–µ–∂–∏</h4>`;
                
                sortedFasteners.forEach((part, index) => {
                    const partId = part.name.replace(/[^a-zA-Z0-9]/g, '_');
                    summaryHtml += `
                        <div class="fastener-part-item" style="margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px; display: flex; align-items: center; justify-content: space-between;">
                            <div style="display: flex; align-items: center;">
                                <input type="checkbox" id="fastener_check_${partId}" 
                                       onchange="updatePartStatus(this)" 
                                       style="transform: scale(1.3); margin-right: 12px;">
                                <div>
                                    <strong>${part.name}</strong> 
                                    <span style="color: #666; margin-left: 10px;">
                                        (–æ–±—â–æ: ${part.totalQuantity}, –æ–±–µ–∫—Ç–∏: ${Array.from(part.objects).join(', ')})
                                    </span>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center;">
                                <label style="font-size: 12px; color: #666; margin-right: 8px;">–ó–∞–±–µ–ª–µ–∂–∫–∞:</label>
                                <input type="text" id="notes_${partId}" 
                                       onchange="saveNote(this)"
                                       style="width: 300px; padding: 4px 8px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px;">
                            </div>
                        </div>
                    `;
                });
                
                document.getElementById('fastenerPartsContent').innerHTML = summaryHtml;
                
                // –í—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞–º–µ —Å—ä—Å—Ç–æ—è–Ω–∏–µ—Ç–æ –Ω–∞ checkbox-–æ–≤–µ—Ç–µ
                setTimeout(restoreCheckboxStates, 100);
            } else {
                // –ü–æ –æ–±–µ–∫—Ç–∏ –ø–æ–æ—Ç–¥–µ–ª–Ω–æ - –∏–∑–≤–ª–∏—á–∞–º–µ –°–ê–ú–û –∫—Ä–µ–ø–µ–∂–Ω–∏ —á–∞—Å—Ç–∏ –∑–∞ –≤—Å–µ–∫–∏ –≤—ä–∑–µ–ª
                console.log('[–†–ï–ñÔøΩ?–ú] –ü–æ –æ–±–µ–∫—Ç–∏ –ø–æ–æ—Ç–¥–µ–ª–Ω–æ - –∑–∞–ø–æ—á–≤–∞–º –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ—Ç–æ');
                let summaryHtml = '';
                
                objects.forEach(obj => {
                    const fastenerParts = {};
                    
                    // ÔøΩ?–∑–≤–ª–∏—á–∞–º–µ –≤—Å–∏—á–∫–∏ –∫—Ä–µ–ø–µ–∂–Ω–∏ —á–∞—Å—Ç–∏ –æ—Ç —Ç–æ–∑–∏ –æ–±–µ–∫—Ç
                    obj.flatBOM.forEach(item => {
                        if (!item.isAssembly && isFastenerPart(item.name)) {
                            const partName = item.name.trim();
                            
                            if (!fastenerParts[partName]) {
                                fastenerParts[partName] = {
                                    name: partName,
                                    totalQuantity: 0
                                };
                            }
                            
                            fastenerParts[partName].totalQuantity += item.quantity;
                        }
                    });
                    
                    // –°–æ—Ä—Ç–∏—Ä–∞–º–µ –∫—Ä–µ–ø–µ–∂–Ω–∏—Ç–µ —á–∞—Å—Ç–∏ –∑–∞ —Ç–æ–∑–∏ –æ–±–µ–∫—Ç
                    const sortedFasteners = Object.values(fastenerParts).sort((a, b) => {
                        // ÔøΩ?–∑–≤–ª–∏—á–∞–º–µ —Ç–∏–ø–∞ –Ω–∞ —á–∞—Å—Ç—Ç–∞ (–ø—ä—Ä–≤–∞—Ç–∞ –¥—É–º–∞)
                        const typeA = a.name.split(' ')[0]; // "Bolt", "Nut", "Washer", etc.
                        const typeB = b.name.split(' ')[0];
                        
                        // –ü—ä—Ä–≤–æ —Å–æ—Ä—Ç–∏—Ä–∞–º–µ –ø–æ —Ç–∏–ø (–∞–∑–±—É—á–µ–Ω —Ä–µ–¥)
                        if (typeA !== typeB) {
                            return typeA.localeCompare(typeB);
                        }
                        
                        // –í —Ä–∞–º–∫–∏—Ç–µ –Ω–∞ —Å—ä—â–∏—è —Ç–∏–ø, —Å–æ—Ä—Ç–∏—Ä–∞–º–µ –ø–æ —Ä–∞–∑–º–µ—Ä –Ω–∞ —Ä–µ–∑–±–∞—Ç–∞
                        const sizeA = extractThreadSize(a.name);
                        const sizeB = extractThreadSize(b.name);
                        
                        // –ê–∫–æ –∏ –¥–≤–µ—Ç–µ –∏–º–∞—Ç —Ä–∞–∑–º–µ—Ä –Ω–∞ —Ä–µ–∑–±–∞, —Å–æ—Ä—Ç–∏—Ä–∞–º–µ –ø–æ —Ä–∞–∑–º–µ—Ä
                        if (sizeA !== 999 && sizeB !== 999) {
                            if (sizeA !== sizeB) {
                                return sizeA - sizeB; // M4 ‚Üí M6 ‚Üí M8 ‚Üí M10 ‚Üí M12
                            }
                        }
                        
                        // –ü—Ä–∏ –µ–¥–Ω–∞–∫—ä–≤ —Ä–∞–∑–º–µ—Ä –∏–ª–∏ –ª–∏–ø—Å–∞ –Ω–∞ —Ä–∞–∑–º–µ—Ä, —Å–æ—Ä—Ç–∏—Ä–∞–º–µ –ø–æ –∞–∑–±—É—á–µ–Ω —Ä–µ–¥ –Ω–∞ —Ü—è–ª–æ—Ç–æ –∏–º–µ
                        return a.name.localeCompare(b.name);
                    });
                    
                    if (sortedFasteners.length > 0) {
                        summaryHtml += `
                            <div class="object-summary">
                                <h4>‚öôÔ∏è ${translateNodeTitle(obj.objectName)} (${sortedFasteners.length} –∫—Ä–µ–ø–µ–∂–Ω–∏ —á–∞—Å—Ç–∏)</h4>
                                <div class="expandable-fasteners">
                        `;
                        
                        sortedFasteners.forEach((part, index) => {
                            const partId = `${obj.objectName.replace(/[^a-zA-Z0-9]/g, '_')}_${part.name.replace(/[^a-zA-Z0-9]/g, '_')}`;
                            summaryHtml += `
                                <div class="fastener-part-item" style="margin: 5px 0; padding: 8px; border: 1px solid #ddd; border-radius: 4px; display: flex; align-items: center; justify-content: space-between;">
                                    <div style="display: flex; align-items: center;">
                                        <input type="checkbox" id="node_check_${partId}" 
                                               onchange="updatePartStatus(this)" 
                                               style="transform: scale(1.2); margin-right: 10px;">
                                        <div>
                                            <strong>${part.name}</strong> 
                                            <span style="color: #666; margin-left: 10px;">(${part.totalQuantity} –±—Ä.)</span>
                                        </div>
                                    </div>
                                    <div style="display: flex; align-items: center;">
                                        <label style="font-size: 11px; color: #666; margin-right: 6px;">–ó–∞–±–µ–ª–µ–∂–∫–∞:</label>
                                        <input type="text" id="notes_node_${partId}" 
                                               onchange="saveNote(this)"
                                               style="width: 250px; padding: 3px 6px; border: 1px solid #ccc; border-radius: 3px; font-size: 11px;">
                                    </div>
                                </div>
                            `;
                        });
                        
                        summaryHtml += `
                                </div>
                            </div>
                            <br>
                        `;
                    }
                });
                
                console.log('[–†–ï–ñÔøΩ?–ú] –ü–æ –æ–±–µ–∫—Ç–∏ –ø–æ–æ—Ç–¥–µ–ª–Ω–æ - –∑–∞–≤—ä—Ä—à–∏—Ö –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ—Ç–æ, HTML –¥—ä–ª–∂–∏–Ω–∞:', summaryHtml.length);
                document.getElementById('fastenerPartsContent').innerHTML = summaryHtml;
                
                // –í—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞–º–µ —Å—ä—Å—Ç–æ—è–Ω–∏–µ—Ç–æ –Ω–∞ checkbox-–æ–≤–µ—Ç–µ
                setTimeout(restoreCheckboxStates, 100);
            }
        }

        function isFastenerAssembly(assemblyName) {
            // –û–ø—Ä–µ–¥–µ–ª—è–º–µ –¥–∞–ª–∏ –∞—Å–µ–º–±–ª–∏—Ç–æ –µ –∫—Ä–µ–ø–µ–∂–Ω–æ - –°–ê–ú–û —Ä–µ–∞–ª–Ω–∏ –∫—Ä–µ–ø–µ–∂–Ω–∏ –∞—Å–µ–º–±–ª–∏—Ç–∞
            const fastenerAssemblies = [
                'M8x20 Komplekt', 'M10x80 Komplekt', 'M12x30 Komplekt', 
                'M6x10 Komplekt', 'M6x16 Komplekt', 'M6x20 Komplekt',
                'M8x16 Komplekt', 'M8x25 Komplekt', 'M8x30 Komplekt',
                'M10x25 Komplekt', 'M10x30 Komplekt', 'M10x40 Komplekt',
                'M12x25 Komplekt', 'M12x35 Komplekt', 'M12x40 Komplekt',
                'M4x10 Komplekt', 'M4x12 Komplekt', 'M4x16 Komplekt',
                'M5x10 Komplekt', 'M5x12 Komplekt', 'M5x16 Komplekt',
                'Anker M10x80 Komplekt', 'Anker M12x100 Komplekt',
                'M8x20 Konus Komplekt', 'M12x30 Komplekt',
                'M10 x 40 Komplekt Kolarski'  // –°—ä—Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–∏
            ];
            
            // –¢–æ—á–Ω–æ —Å—ä–≤–ø–∞–¥–µ–Ω–∏–µ –∏–ª–∏ —Å—ä–¥—ä—Ä–∂–∞ —Ä–∞–∑–º–µ—Ä–∏ –Ω–∞ –±–æ–ª—Ç–æ–≤–µ
            return fastenerAssemblies.includes(assemblyName) || 
                   /M\d+x\d+.*Komplekt/i.test(assemblyName) ||
                   /M\d+\s+x\s+\d+.*Komplekt/i.test(assemblyName) ||  // –° –∏–Ω—Ç–µ—Ä–≤–∞–ª–∏ M10 x 40
                   /Anker.*M\d+x\d+.*Komplekt/i.test(assemblyName) ||
                   /Anker.*M\d+.*Komplekt/i.test(assemblyName) ||
                   // –ù–æ–≤–∏ —à–∞–±–ª–æ–Ω–∏ –∑–∞ –∞—Å–µ–º–±–ª–∏—Ç–∞ –±–µ–∑ "Komplekt"
                   /^Anker\s+M\d+x\d+$/i ||  // Anker M12x110
                   /^Anker\s+M\d+x\d+\s+\w+$/i;  // Anker M12x110 kula
        }

        function isFastenerPart(partName) {
            // –ó–∞ flatBOM/allParts –ª–æ–≥–∏–∫–∞: –†–∞–∑–ø–æ–∑–Ω–∞–≤–∞–º–µ –∫—Ä–µ–ø–µ–∂–∏ –ø–æ –∏–º–µ–Ω–∞ –∏ —à–∞–±–ª–æ–Ω–∏
            
            // ÔøΩ?–∑–∫–ª—é—á–≤–∞–º–µ —Å–ø–µ—Ü–∏–∞–ª–Ω–∏ –∑–∞–ø–∏—Å–∏
            if (partName.startsWith('ALL ') || 
                partName.includes('<–ø–æ–¥–∞—Å–µ–º–±–ª–∏>')) {
                return false;
            }
            
            // –ö—Ä–µ–ø–µ–∂–∏: —á–∞—Å—Ç–∏ —Å —à–∞–±–ª–æ–Ω–∏ –∑–∞ –±–æ–ª—Ç–æ–≤–µ –∏ –∫—Ä–µ–ø–µ–∂–Ω–∏ –µ–ª–µ–º–µ–Ω—Ç–∏
            const fastenerPatterns = [
                /M\d+x\d+/i,                     // M8x20, M12x30
                /M\d+\sx\s\d+/i,                 // M8 x 20
                /Anker/i,                        // Anker —á–∞—Å—Ç–∏
                /Komplekt/i,                     // Komplekt –∞—Å–µ–º–±–ª–∏—Ç–∞
                /Bufer.*Komplekt/i,              // Planka Bufer Komplekt
                /–í–∏–Ω—Ç|–≤–∏–Ω—Ç|–ë–æ–ª—Ç|–±–æ–ª—Ç|–ì–∞–π–∫–∞|–≥–∞–π–∫–∞|–®–∞–π–±–∞|—à–∞–π–±–∞/i,
                /^DIN\d+/i,                      // DIN —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏
                /^ISO\d+/i,                      // ISO —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏
                /^hex|^socket|^cap.*screw/i,     // Hex –±–æ–ª—Ç–æ–≤–µ, socket screws
                /^Nut|^nut/i,                    // –ì–∞–π–∫–∏ (Nut M8, nut M12)
                /^Washer|^washer/i,              // –®–∞–π–±–∏ (Washer M8, washer M12)
                /gaika|flanshova/i,              // –ë—ä–ª–≥–∞—Ä—Å–∫–∏ —Ç–µ—Ä–º–∏–Ω–∏ –∑–∞ –≥–∞–π–∫–∏
                /Bolt|bolt/i,                    // –ë–æ–ª—Ç–æ–≤–µ (Bolt M8x20, bolt M12x30)
                /^Bufer$/i,                      // Bufer —á–∞—Å—Ç–∏ (—Ç–æ—á–Ω–æ —Å—ä–≤–ø–∞–¥–µ–Ω–∏–µ)
                /Screw|screw/i,                  // –í–∏–Ω—Ç–æ–≤–µ (Screw, screw)
                /Rivet|rivet/i,                  // –ù–∏—Ç–æ–≤–µ (Rivet, rivet)
                /Pin|pin/i,                      // –©–∏—Ñ—Ç–æ–≤–µ (Pin, pin)
                /Spring|spring/i,                // –ü—Ä—É–∂–∏–Ω–∏ (Spring, spring)
                /Bearing|bearing/i,              // –õ–∞–≥–µ—Ä–∏ (Bearing, bearing)
                /O-ring|o-ring/i,                // –û-–ø—Ä—ä—Å—Ç–µ–Ω–∏ (O-ring)
                /Gasket|gasket/i,                // –ì–∞—Ä–Ω–∏—Ç—É—Ä–∏ (Gasket)
                /Seal|seal/i,                    // –£–ø–ª—ä—Ç–Ω–µ–Ω–∏—è (Seal)
                /Lock|lock.*washer/i,            // –°—Ç–æ–ø–æ—Ä–Ω–∏ —à–∞–π–±–∏ (Lock washer)
                /Flat|flat.*washer/i,            // –ü–ª–æ—Å–∫–∏ —à–∞–π–±–∏ (Flat washer)
                /Cap|cap.*screw/i,               // –ö–∞–ø–∞—á–Ω–∏ –≤–∏–Ω—Ç–æ–≤–µ (Cap screw)
                /Socket|socket.*head/i,          // ÔøΩ?–º–±—É—Å–Ω–∏ –≤–∏–Ω—Ç–æ–≤–µ (Socket head)
                /Thread|thread/i,                // –†–µ–∑–±–æ–≤–∏ —á–∞—Å—Ç–∏ (Thread)
                /Stud|stud/i                     // –®–ø–∏–ª–∫–∏ (Stud)
            ];
            
            // –ü—Ä–æ–≤–µ—Ä—è–≤–∞–º–µ –¥–∞–ª–∏ –µ –∫—Ä–µ–ø–µ–∂ –ø–æ —à–∞–±–ª–æ–Ω
            if (fastenerPatterns.some(pattern => pattern.test(partName))) {
                return true;
            }
            
            // –î–µ—Ç–∞–π–ª–∏: —á–∞—Å—Ç–∏ –∫–æ–∏—Ç–æ –∑–∞–ø–æ—á–≤–∞—Ç —Å —Ü–∏—Ñ—Ä–∞ (80_98_S, 30_01_S1, –∏ —Ç.–Ω.)
            const firstChar = partName.trim().charAt(0);
            const startsWithDigit = !isNaN(firstChar) && firstChar !== '';
            
            if (startsWithDigit) {
                return false; // –î–µ—Ç–∞–π–ª
            }
            
            // –°–ø–µ—Ü–∏–∞–ª–Ω–∏ —Å–ª—É—á–∞–∏ –∑–∞ —á–∞—Å—Ç–∏ –∫–æ–∏—Ç–æ –Ω–µ –∑–∞–ø–æ—á–≤–∞—Ç —Å —Ü–∏—Ñ—Ä–∞, –Ω–æ –Ω–µ —Å–∞ –∫—Ä–µ–ø–µ–∂–∏
            const detailPatterns = [
                /^Planka(?!.*Komplekt)/i,        // Planka (–Ω–æ –Ω–µ Planka...Komplekt)
                /^Cover|^Panel|^Plate/i,         // –ü–æ–∫—Ä–∏–≤–∫–∏, –ø–∞–Ω–µ–ª–∏, –ø–ª–æ—á–∏
                /^Frame|^Base|^Support/i         // –†–∞–º–∫–∏, –æ—Å–Ω–æ–≤–∏, –æ–ø–æ—Ä–∏
            ];
            
            if (detailPatterns.some(pattern => pattern.test(partName))) {
                return false; // –î–µ—Ç–∞–π–ª
            }
            
            // –ü–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ –Ω–µ—Ä–∞–∑–ø–æ–∑–Ω–∞—Ç–∏ —á–∞—Å—Ç–∏ –≥–∏ —Ç—Ä–µ—Ç–∏—Ä–∞–º–µ –∫–∞—Ç–æ –¥–µ—Ç–∞–π–ª–∏
            return false;
        }

        function toggleAssembly(assemblyId) {
            const assemblyRow = document.getElementById(assemblyId);
            const icon = document.getElementById('icon-' + assemblyId);
            
            if (assemblyRow.style.display === 'none') {
                assemblyRow.style.display = 'table-row';
                icon.textContent = '‚ñº';
            } else {
                assemblyRow.style.display = 'none';
                icon.textContent = '‚ñ∂';
            }
        }

        function toggleAssemblyDetailsGlobal(assemblyIndex, assemblyName, objectsStr, totalQuantity) {
            const detailsRow = document.getElementById(`details-row-${assemblyIndex}`);
            const detailsContent = document.getElementById(`details-content-${assemblyIndex}`);
            const button = document.getElementById(`expand-btn-${assemblyIndex}`);
            
            if (detailsRow.style.display === 'none') {
                // –ü–æ–∫–∞–∑–≤–∞–º–µ –¥–µ—Ç–∞–π–ª–∏—Ç–µ
                detailsRow.style.display = 'table-row';
                button.innerHTML = '‚àí';
                button.style.background = '#dc3545';
                
                // –ó–∞—Ä–µ–∂–¥–∞–º–µ –¥–µ—Ç–∞–π–ª–∏—Ç–µ
                loadAssemblyDetailsGlobal(assemblyName, objectsStr.split(','), detailsContent, totalQuantity);
            } else {
                // –°–∫—Ä–∏–≤–∞–º–µ –¥–µ—Ç–∞–π–ª–∏—Ç–µ
                detailsRow.style.display = 'none';
                button.innerHTML = '+';
                button.style.background = '#28a745';
            }
        }

        function loadAssemblyDetailsGlobal(assemblyName, objectsList, container, totalQuantity) {
            // –ù–∞–º–∏—Ä–∞–º–µ –≤—Å–∏—á–∫–∏ —á–∞—Å—Ç–∏ –æ—Ç —Ç–∞–∑–∏ —Å–±–æ—Ä–∫–∞ –≤—ä–≤ –≤—Å–∏—á–∫–∏ –æ–±–µ–∫—Ç–∏
            const allParts = new Map();
            const allSubAssemblies = new Map();
            
            console.log('üîç –¢—ä—Ä—Å–∏–º –¥–µ—Ç–∞–π–ª–∏ –∑–∞ —Å–±–æ—Ä–∫–∞:', assemblyName, '–≤ –æ–±–µ–∫—Ç–∏:', objectsList);
            
            window.bomData.forEach(bom => {
                if (objectsList.includes(bom.objectName)) {
                    // –¢—ä—Ä—Å–∏–º –≤ flatBOM –∑–∞ –¥–∏—Ä–µ–∫—Ç–Ω–∏—Ç–µ –¥–µ—Ü–∞ –Ω–∞ —Ç–∞–∑–∏ —Å–±–æ—Ä–∫–∞
                    bom.flatBOM.forEach(item => {
                        const pathParts = item.path.split('/');
                        
                        // –ù–∞–º–∏—Ä–∞–º–µ –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞ –Ω–∞—à–∞—Ç–∞ —Å–±–æ—Ä–∫–∞ –≤ path-–∞
                        let assemblyIndex = -1;
                        for (let i = 0; i < pathParts.length; i++) {
                            const pathPart = pathParts[i].replace(/<\d+>/g, '').trim();
                            if (pathPart === assemblyName) {
                                assemblyIndex = i;
                                break;
                            }
                        }
                        
                        if (assemblyIndex >= 0) {
                            // –°–ª—É—á–∞–π 1: Path –∑–∞–≤—ä—Ä—à–≤–∞ —Ç–æ—á–Ω–æ –Ω–∞ –Ω–∞—à–∞—Ç–∞ —Å–±–æ—Ä–∫–∞ (level 2 –¥–µ—Ç–∞–π–ª–∏)
                            // –ü—Ä–∏–º–µ—Ä: "...Planka Bufer Komplekt<1>" -> Bufer, 30_04_S1
                            const lastPart = pathParts[pathParts.length - 1];
                            const lastPartClean = lastPart.replace(/<\d+>/g, '').trim();
                            
                            if (lastPartClean === assemblyName && item.name !== '<–ø–æ–¥–∞—Å–µ–º–±–ª–∏>') {
                                const cleanName = item.name.replace(/<\d+>/g, '').trim();
                                
                                console.log(`  ‚úÖ –î–µ—Ç–∞–π–ª (–Ω–∏–≤–æ ${item.level}): ${cleanName}, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${item.quantity}`);
                                
                                if (allParts.has(cleanName)) {
                                    const existing = allParts.get(cleanName);
                                    allParts.set(cleanName, {
                                        name: cleanName,
                                        quantity: existing.quantity + item.quantity
                                    });
                                } else {
                                    allParts.set(cleanName, {
                                        name: cleanName,
                                        quantity: item.quantity
                                    });
                                }
                            }
                            
                            // –°–ª—É—á–∞–π 2: Path –∏–º–∞ –æ—â–µ –µ–¥–∏–Ω –µ–ª–µ–º–µ–Ω—Ç —Å–ª–µ–¥ –Ω–∞—à–∞—Ç–∞ —Å–±–æ—Ä–∫–∞ (–ø–æ–¥–∞—Å–µ–º–±–ª–∏—Ç–∞)
                            // –ü—Ä–∏–º–µ—Ä: "...Planka Bufer Komplekt<1>/M8x20 Komplekt<1>" -> M8x20 Komplekt
                            if (pathParts.length === assemblyIndex + 2 && item.name === '<–ø–æ–¥–∞—Å–µ–º–±–ª–∏>') {
                                const subAssemblyPart = pathParts[assemblyIndex + 1];
                                const subAssemblyName = subAssemblyPart.replace(/<\d+>/g, '').trim();
                                
                                console.log(`  ‚úÖ –ü–æ–¥–∞—Å–µ–º–±–ª–∏ (–Ω–∏–≤–æ ${item.level}): ${subAssemblyName}, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${item.quantity}`);
                                
                                if (allSubAssemblies.has(subAssemblyName)) {
                                    const existing = allSubAssemblies.get(subAssemblyName);
                                    allSubAssemblies.set(subAssemblyName, {
                                        name: subAssemblyName,
                                        quantity: existing.quantity + item.quantity
                                    });
                                } else {
                                    allSubAssemblies.set(subAssemblyName, {
                                        name: subAssemblyName,
                                        quantity: item.quantity
                                    });
                                }
                            }
                        }
                    });
                }
            });
            
            console.log('üì¶ –ù–∞–º–µ—Ä–µ–Ω–∏ –¥–µ—Ç–∞–π–ª–∏:', allParts.size);
            console.log('üèóÔ∏è –ù–∞–º–µ—Ä–µ–Ω–∏ –ø–æ–¥–∞—Å–µ–º–±–ª–∏—Ç–∞:', allSubAssemblies.size);
            
            // –û–±–µ–¥–∏–Ω—è–≤–∞–º–µ –¥–µ—Ç–∞–π–ª–∏—Ç–µ –∏ –ø–æ–¥–∞—Å–µ–º–±–ª–∏—Ç–∞—Ç–∞ –≤ –µ–¥–∏–Ω —Å–ø–∏—Å—ä–∫
            const allItems = [];
            
            // –î–æ–±–∞–≤—è–º–µ –¥–µ—Ç–∞–π–ª–∏—Ç–µ
            allParts.forEach(part => {
                allItems.push({
                    name: part.name,
                    quantity: part.quantity,
                    isAssembly: false
                });
            });
            
            // –î–æ–±–∞–≤—è–º–µ –ø–æ–¥–∞—Å–µ–º–±–ª–∏—Ç–∞—Ç–∞
            allSubAssemblies.forEach(subAssembly => {
                allItems.push({
                    name: subAssembly.name,
                    quantity: subAssembly.quantity,
                    isAssembly: true
                });
            });
            
            // –°–æ—Ä—Ç–∏—Ä–∞–º–µ –≤—Å–∏—á–∫–∏ –∑–∞–µ–¥–Ω–æ
            allItems.sort((a, b) => a.name.localeCompare(b.name));
            
            let html = '<div style="padding: 10px;">';
            
            if (allItems.length > 0) {
                html += '<h4 style="color: #2c5aa0; margin-bottom: 10px;">üîß –î–µ—Ç–∞–π–ª–∏:</h4>';
                
                allItems.forEach((item, idx) => {
                    const subItemId = `sub-${Date.now()}-${idx}`;
                    
                    if (item.isAssembly) {
                        // –ü–æ–¥–∞—Å–µ–º–±–ª–∏ —Å + –±—É—Ç–æ–Ω
                        html += `
                            <div style="padding: 8px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <button onclick="toggleSubAssembly('${subItemId}', '${item.name.replace(/'/g, "\\'")}', '${objectsList.join(',')}', this)" 
                                            style="background: #28a745; color: white; border: none; width: 20px; height: 20px; border-radius: 50%; cursor: pointer; font-weight: bold; font-size: 12px; flex-shrink: 0;">+</button>
                                    <span style="font-style: italic;">üèóÔ∏è ${translateName(item.name)}</span>
                                </div>
                                <span style="font-weight: bold; color: #17a2b8;">${item.quantity} –±—Ä.</span>
                            </div>
                            <div id="${subItemId}" style="display: none; margin-left: 30px; background: #f0f0f0; padding: 10px; border-radius: 5px;">
                                <!-- –í–ª–æ–∂–µ–Ω–∏—Ç–µ –¥–µ—Ç–∞–π–ª–∏ —â–µ —Å–µ –∑–∞—Ä–µ–∂–¥–∞—Ç –¥–∏–Ω–∞–º–∏—á–Ω–æ -->
                            </div>
                        `;
                    } else {
                        // –û–±–∏–∫–Ω–æ–≤–µ–Ω –¥–µ—Ç–∞–π–ª –±–µ–∑ –±—É—Ç–æ–Ω
                        html += `<div style="padding: 8px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between;">
                            <span style="margin-left: 30px;">${createImageTooltip(translateName(item.name), '', false)}</span>
                            <span style="font-weight: bold; color: #28a745;">${item.quantity} –±—Ä.</span>
                        </div>`;
                    }
                });
            } else {
                html += '<p style="text-align: center; color: #6c757d; font-style: italic;">–ù—è–º–∞ –¥–µ—Ç–∞–π–ª–∏ –∑–∞ –ø–æ–∫–∞–∑–≤–∞–Ω–µ</p>';
            }
            
            html += '</div>';
            
            container.innerHTML = html;
        }

        function toggleSubAssembly(containerId, assemblyName, objectsStr, button) {
            const container = document.getElementById(containerId);
            
            if (container.style.display === 'none') {
                // –ü–æ–∫–∞–∑–≤–∞–º–µ –¥–µ—Ç–∞–π–ª–∏—Ç–µ
                container.style.display = 'block';
                button.innerHTML = '‚àí';
                button.style.background = '#dc3545';
                
                // –ó–∞—Ä–µ–∂–¥–∞–º–µ –¥–µ—Ç–∞–π–ª–∏—Ç–µ –∑–∞ —Ç–æ–≤–∞ –ø–æ–¥–∞—Å–µ–º–±–ª–∏
                loadAssemblyDetailsGlobal(assemblyName, objectsStr.split(','), container, 0);
            } else {
                // –°–∫—Ä–∏–≤–∞–º–µ –¥–µ—Ç–∞–π–ª–∏—Ç–µ
                container.style.display = 'none';
                button.innerHTML = '+';
                button.style.background = '#28a745';
            }
        }

        function generatePartsSummary() {
            const mode = document.getElementById('summaryMode').value;
            let summaryHtml = '';

            if (mode === 'global') {
                // Global summary - aggregate all parts across all objects
                const partsSummary = {};
                
                // Process all parts from all objects - —Å–∞–º–æ –ø—ä—Ä–≤–æ –Ω–∏–≤–æ
                window.bomData.forEach(bom => {
                    if (bom.flatBOM && bom.flatBOM.length > 0) {
                        // ÔøΩ?–∑–ø–æ–ª–∑–≤–∞–º–µ flatBOM –∏ –≤–∑–∏–º–∞–º–µ —Å–∞–º–æ level 1 –µ–ª–µ–º–µ–Ω—Ç–∏
                        bom.flatBOM.forEach(item => {
                            // –°–∞–º–æ level 1 –µ–ª–µ–º–µ–Ω—Ç–∏
                            if (item.level === 1) {
                                // –ó–∞ <–ø–æ–¥–∞—Å–µ–º–±–ª–∏> –∑–∞–ø–∏—Å–∏ –∏–∑–ø–æ–ª–∑–≤–∞–º–µ cleanName –æ—Ç path-–∞
                                let partName;
                                if (item.name === '<–ø–æ–¥–∞—Å–µ–º–±–ª–∏>') {
                                    // –í–∑–µ–º–∞–º–µ –∏–º–µ—Ç–æ –æ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏—è –µ–ª–µ–º–µ–Ω—Ç –Ω–∞ path-–∞
                                    const pathParts = item.path.split('/');
                                    const lastPart = pathParts[pathParts.length - 1];
                                    partName = lastPart.replace(/<\d+>/g, '').trim();
                                } else {
                                    partName = item.name.replace(/<\d+>/g, '').trim();
                                }
                                
                                const quantity = parseFloat(item.quantity) || 0;
                                
                                if (partsSummary[partName]) {
                                    partsSummary[partName].totalQuantity += quantity;
                                    partsSummary[partName].objects.add(bom.objectName);
                                } else {
                                    partsSummary[partName] = {
                                        name: partName,
                                        totalQuantity: quantity,
                                        objects: new Set([bom.objectName]),
                                        materialSpec: '',
                                        isAssembly: item.isAssembly
                                    };
                                }
                            }
                        });
                    } else {
                        // Fallback –∫—ä–º allParts –∞–∫–æ –Ω—è–º–∞ flatBOM
                        bom.allParts.forEach(part => {
                            const partName = normalizePartName(part.cleanName || part.name);
                            const quantity = parseFloat(part.quantity) || 0;
                            
                            if (partsSummary[partName]) {
                                partsSummary[partName].totalQuantity += quantity;
                                partsSummary[partName].objects.add(bom.objectName);
                            } else {
                                partsSummary[partName] = {
                                    name: partName,
                                    totalQuantity: quantity,
                                    objects: new Set([bom.objectName]),
                                    materialSpec: part.materialSpec || '',
                                    unitPrice: part.unitPrice || '',
                                    totalPrice: part.totalPrice || ''
                                };
                            }
                        });
                    }
                });

                // Sort by total quantity descending
                const sortedParts = Object.values(partsSummary).sort((a, b) => b.totalQuantity - a.totalQuantity);

                // –†–∞–∑–¥–µ–ª—è–º–µ –Ω–∞ –¥–µ—Ç–∞–π–ª–∏ –∏ —Å–±–æ—Ä–∫–∏
                const singleParts = sortedParts.filter(part => !part.name.includes('Komplekt') && !part.name.includes('–∫–æ–º–ø–ª–µ–∫—Ç'));
                const assemblies = sortedParts.filter(part => part.name.includes('Komplekt') || part.name.includes('–∫–æ–º–ø–ª–µ–∫—Ç'));

                summaryHtml = `
                    <div class="parts-summary-global">
                        <h3>–û–±—â–æ –æ–±–æ–±—â–µ–Ω–∏–µ –Ω–∞ –≤—Å–∏—á–∫–∏ —á–∞—Å—Ç–∏ (${sortedParts.length} –æ–±—â–æ: ${singleParts.length} –¥–µ—Ç–∞–π–ª–∞ + ${assemblies.length} —Å–±–æ—Ä–∫–∏)</h3>
                `;
                
                // –°–µ–∫—Ü–∏—è –∑–∞ –¥–µ—Ç–∞–π–ª–∏ (–µ–¥–∏–Ω–∏—á–Ω–∏ —á–∞—Å—Ç–∏)
                if (singleParts.length > 0) {
                    summaryHtml += `
                        <div style="margin-bottom: 30px;">
                            <h4 style="color: #007bff; margin: 20px 0 10px 0;">üì¶ –î–µ—Ç–∞–π–ª–∏ (–µ–¥–∏–Ω–∏—á–Ω–∏ —á–∞—Å—Ç–∏) - ${singleParts.length} –±—Ä.</h4>
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>ÔøΩ?–º–µ –Ω–∞ —á–∞—Å—Ç</th>
                                        <th style="text-align: center;">–û–±—â–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                        <th style="text-align: center;">–ë—Ä–æ–π –æ–±–µ–∫—Ç–∏</th>
                                        <th>–û–±–µ–∫—Ç–∏</th>
                                        <th>–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${singleParts.map(part => `
                                        <tr>
                                            <td>${createImageTooltip(translateName(part.name), '', false)}</td>
                                            <td class="quantity-cell" style="text-align: center;">${part.totalQuantity}</td>
                                            <td style="text-align: center;">${part.objects.size}</td>
                                            <td class="objects-cell">${Array.from(part.objects).join(', ')}</td>
                                            <td>${part.materialSpec}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                }
                
                // –°–µ–∫—Ü–∏—è –∑–∞ —Å–±–æ—Ä–∫–∏
                if (assemblies.length > 0) {
                    summaryHtml += `
                        <div style="margin-bottom: 30px;">
                            <h4 style="color: #28a745; margin: 20px 0 10px 0;">üîß –°–±–æ—Ä–∫–∏ (–≥—Ä—É–ø–∏ –æ—Ç –¥–µ—Ç–∞–π–ª–∏) - ${assemblies.length} –±—Ä.</h4>
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th style="width: 40px;"></th>
                                        <th>ÔøΩ?–º–µ –Ω–∞ —á–∞—Å—Ç</th>
                                        <th style="text-align: center;">–û–±—â–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                        <th style="text-align: center;">–ë—Ä–æ–π –æ–±–µ–∫—Ç–∏</th>
                                        <th>–û–±–µ–∫—Ç–∏</th>
                                        <th>–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;
                
                assemblies.forEach((part, index) => {
                    summaryHtml += `
                        <tr>
                            <td style="text-align: center;">
                                <button onclick="toggleAssemblyDetailsGlobal(${index}, '${part.name.replace(/'/g, "\\'")}', '${Array.from(part.objects).join(',')}', ${part.totalQuantity})" 
                                        id="expand-btn-${index}"
                                        style="background: #28a745; color: white; border: none; width: 25px; height: 25px; border-radius: 50%; cursor: pointer; font-weight: bold;">+</button>
                            </td>
                            <td><strong>${translateName(part.name)}</strong></td>
                            <td class="quantity-cell" style="text-align: center;">${part.totalQuantity}</td>
                            <td style="text-align: center;">${part.objects.size}</td>
                            <td class="objects-cell">${Array.from(part.objects).join(', ')}</td>
                            <td>${part.materialSpec}</td>
                        </tr>
                        <tr id="details-row-${index}" style="display: none;">
                            <td colspan="6" style="padding: 0; border: 1px solid #ddd;">
                                <div id="details-content-${index}" style="padding: 15px; background: #f8f9fa;">
                                    <!-- –î–µ—Ç–∞–π–ª–∏—Ç–µ —â–µ —Å–µ –∑–∞—Ä–µ–∂–¥–∞—Ç –¥–∏–Ω–∞–º–∏—á–Ω–æ -->
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                summaryHtml += `
                                </tbody>
                            </table>
                        </div>
                    `;
                }
                
                summaryHtml += `</div>`;
            } else {
                // By object summary - show aggregated parts for each object separately
                summaryHtml = '<div class="parts-summary-by-object">';
                
                window.bomData.forEach(bom => {
                    const partsSummary = {};
                    
                    // Aggregate parts for this object
                    bom.allParts.forEach(part => {
                        const partName = normalizePartName(part.cleanName || part.name);
                        const quantity = parseFloat(part.quantity) || 0;
                        
                        if (partsSummary[partName]) {
                            partsSummary[partName].totalQuantity += quantity;
                        } else {
                            partsSummary[partName] = {
                                name: partName,
                                totalQuantity: quantity,
                                materialSpec: part.materialSpec || '',
                                unitPrice: part.unitPrice || '',
                                totalPrice: part.totalPrice || ''
                            };
                        }
                    });

                    const sortedParts = Object.values(partsSummary).sort((a, b) => b.totalQuantity - a.totalQuantity);

                    summaryHtml += `
                        <div class="object-summary">
                            <h4>üè¢ ${translateNodeTitle(bom.objectName)} (${sortedParts.length} —É–Ω–∏–∫–∞–ª–Ω–∏ —á–∞—Å—Ç–∏)</h4>
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>ÔøΩ?–º–µ –Ω–∞ —á–∞—Å—Ç</th>
                                        <th>–û–±—â–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                        <th>–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª</th>
                                        <th>–ï–¥–∏–Ω–∏—á–Ω–∞ —Ü–µ–Ω–∞</th>
                                        <th>–û–±—â–∞ —Ü–µ–Ω–∞</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${sortedParts.map(part => `
                                        <tr>
                                            <td><strong>${part.name}</strong></td>
                                            <td class="quantity-cell">${part.totalQuantity}</td>
                                            <td>${part.materialSpec}</td>
                                            <td>${part.unitPrice}</td>
                                            <td>${part.totalPrice}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        <br>
                    `;
                });
                
                summaryHtml += '</div>';
            }

            document.getElementById('partsSummaryContent').innerHTML = summaryHtml;
            
            // –í—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞–º–µ —Å—ä—Å—Ç–æ—è–Ω–∏–µ—Ç–æ –Ω–∞ checkbox-–æ–≤–µ—Ç–µ
            setTimeout(restoreCheckboxStates, 100);
        }

        function showTab(tabName) {
            // –°–∫—Ä–∏–≤–∞–º–µ –≤—Å–∏—á–∫–∏ —Ç–∞–±–æ–≤–µ
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ü—Ä–µ–º–∞—Ö–≤–∞–º–µ active –∫–ª–∞—Å–∞ –æ—Ç –≤—Å–∏—á–∫–∏ –±—É—Ç–æ–Ω–∏
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑–≤–∞–º–µ –∏–∑–±—Ä–∞–Ω–∏—è —Ç–∞–±
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // –î–æ–±–∞–≤—è–º–µ active –∫–ª–∞—Å –Ω–∞ –±—É—Ç–æ–Ω–∞
            event.target.classList.add('active');
            
            // –ì–µ–Ω–µ—Ä–∏—Ä–∞–º–µ —Å—ä–æ—Ç–≤–µ—Ç–Ω–æ—Ç–æ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ —Å–ø–æ—Ä–µ–¥ —Ç–∞–±–∞
            if (tabName === 'overview') {
                generateOverviewContent();
            } else if (tabName === 'partsSummary') {
                generatePartsSummary();
            } else if (tabName === 'detailsParts') {
                generateDetailsParts();
            } else if (tabName === 'fastenerParts') {
                generateFastenerParts();
            } else if (tabName === 'assemblyClassification') {
                generateAssemblyClassificationTab();
            }
        }

        // üîÑ –£–ùÔøΩ?–§ÔøΩ?–¶ÔøΩ?–†–ê–ù–û –£–ü–†–ê–í–õ–ï–ùÔøΩ?–ï –ù–ê –ü–û–¢–†–ï–ëÔøΩ?–¢–ï–õ–°–öÔøΩ? –î–ê–ù–ùÔøΩ?
        let userDataCache = {};
        
        // –ó–∞—Ä–µ–∂–¥–∞ –≤—Å–∏—á–∫–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–∏ –¥–∞–Ω–Ω–∏
        async function loadAllUserData() {
            console.log('üîÑ loadAllUserData - –∑–∞–ø–æ—á–≤–∞ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ...');
            userDataCache = await loadSharedUserData();
            // –ê–∫–æ –ù–ï —Å–º–µ –≤ —Å–ø–æ–¥–µ–ª–µ–Ω —Ä–µ–∂–∏–º –∏ BOM —Ñ–∞–π–ª—ä—Ç –≤–µ—á–µ —Å—ä–¥—ä—Ä–∂–∞ userStates (–∏–Ω—Ç–µ–≥—Ä–∏—Ä–∞–Ω —Ñ–æ—Ä–º–∞—Ç), –≥–∏ –∑–∞—Ä–µ–∂–¥–∞–º–µ
            if (!isSharedMode && bomData && bomData.userStates && bomData.userStates.checkboxes) {
                console.log('üíæ –õ–æ–∫–∞–ª–µ–Ω —Ä–µ–∂–∏–º —Å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–∞–Ω–∏ userStates –≤ BOM —Ñ–∞–π–ª–∞ ‚Äì –∑–∞—Ä–µ–∂–¥–∞–º –≥–∏.');
                // –û–±–µ–¥–∏–Ω—è–≤–∞–º–µ –ª–æ–∫–∞–ª–Ω–æ –∑–∞—Ä–µ–¥–µ–Ω–∏—Ç–µ (–æ—Ç —Ñ–∞–π–ª–∞) —Å—ä—Å —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∏—Ç–µ (–æ—Ç localStorage), –∫–∞—Ç–æ —Ñ–∞–π–ª—ä—Ç –∏–º–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
                userDataCache = {
                    ...userDataCache,
                    ...bomData.userStates.checkboxes
                };
            }
            console.log('üì• –ó–∞—Ä–µ–¥–µ–Ω–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–∏ –¥–∞–Ω–Ω–∏:', userDataCache);
            console.log('üîÑ –ó–∞–ø–æ—á–≤–∞ –≤—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ UI —Å—ä—Å—Ç–æ—è–Ω–∏—è...');
            restoreUserInterfaceStates();
            return userDataCache;
        }
        
        // –ó–∞–ø–∞–∑–≤–∞ –ø—Ä–æ–º—è–Ω–∞ –≤ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–∏—Ç–µ –¥–∞–Ω–Ω–∏
        async function saveUserDataChange(key, value) {
            console.log('üíæ –ó–∞–ø–∞–∑–≤–∞–Ω–µ –Ω–∞ –ø—Ä–æ–º—è–Ω–∞:', key, '=', value);
            if (value === null || value === undefined || value === '') {
                delete userDataCache[key];
            } else {
                userDataCache[key] = value;
            }
            console.log('üì¶ userDataCache —Å–ª–µ–¥ –ø—Ä–æ–º—è–Ω–∞:', userDataCache);
            await saveSharedUserData(userDataCache);
            console.log('‚úÖ –î–∞–Ω–Ω–∏—Ç–µ —Å–∞ –∏–∑–ø—Ä–∞—Ç–µ–Ω–∏ –∑–∞ –∑–∞–ø–∞–∑–≤–∞–Ω–µ');
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –ø—Ä–æ–º–µ–Ω–∏ –≤ checkbox-–æ–≤–µ—Ç–µ
        async function updatePartStatus(checkbox) {
            const partRow = checkbox.closest('tr, .fastener-part-item');
            
            if (checkbox.checked) {
                // –î–æ–±–∞–≤—è–º–µ –∑–µ–ª–µ–Ω —Ñ–æ–Ω –Ω–∞ —Ü–µ–ª–∏—è —Ä–µ–¥
                partRow.style.backgroundColor = '#d4edda';
                partRow.style.opacity = '0.7';
                
                // –ó–∞—á–µ—Ä—Ç–∞–≤–∞–º–µ –°–ê–ú–û –∏–º–µ—Ç–æ –Ω–∞ —á–∞—Å—Ç—Ç–∞ (–ø—ä—Ä–≤–∏—è <strong> –µ–ª–µ–º–µ–Ω—Ç)
                const partNameElement = partRow.querySelector('strong');
                if (partNameElement) {
                    partNameElement.style.textDecoration = 'line-through';
                }
                
                // –ó–∞–ø–∞–∑–≤–∞–º–µ —Å—ä—Å—Ç–æ—è–Ω–∏–µ—Ç–æ —Å–ø–æ–¥–µ–ª–µ–Ω–æ
                await saveUserDataChange(checkbox.id, 'checked');
                
                console.log('–û—Ç–º–µ—Ç–Ω–∞—Ç–∞ —á–∞—Å—Ç:', checkbox.id);
            } else {
                // –ü—Ä–µ–º–∞—Ö–≤–∞–º–µ —Å—Ç–∏–ª–æ–≤–µ—Ç–µ –∫–æ–≥–∞—Ç–æ –Ω–µ –µ –æ—Ç–º–µ—Ç–Ω–∞—Ç–æ
                partRow.style.backgroundColor = '';
                partRow.style.opacity = '';
                
                // –ü—Ä–µ–º–∞—Ö–≤–∞–º–µ –∑–∞—á–µ—Ä—Ç–∞–≤–∞–Ω–µ—Ç–æ –æ—Ç –∏–º–µ—Ç–æ –Ω–∞ —á–∞—Å—Ç—Ç–∞
                const partNameElement = partRow.querySelector('strong');
                if (partNameElement) {
                    partNameElement.style.textDecoration = '';
                }
                
                // –ü—Ä–µ–º–∞—Ö–≤–∞–º–µ –æ—Ç —Å–ø–æ–¥–µ–ª–µ–Ω–∏—Ç–µ –¥–∞–Ω–Ω–∏
                await saveUserDataChange(checkbox.id, null);
                
                console.log('–ú–∞—Ö–Ω–∞—Ç–∞ –æ—Ç–º–µ—Ç–∫–∞ –æ—Ç —á–∞—Å—Ç:', checkbox.id);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞ –∑–∞–ø–∞–∑–≤–∞–Ω–µ –Ω–∞ –±–µ–ª–µ–∂–∫–∏—Ç–µ
        async function saveNote(noteInput) {
            const noteText = noteInput.value.trim();
            const noteId = noteInput.id;
            
            if (noteText) {
                await saveUserDataChange(noteId, noteText);
                console.log('–ó–∞–ø–∞–∑–µ–Ω–∞ –±–µ–ª–µ–∂–∫–∞:', noteId, '=', noteText);
                
                // –î–æ–±–∞–≤—è–º–µ –≤–∏–∑—É–∞–ª–µ–Ω –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —á–µ –∏–º–∞ –±–µ–ª–µ–∂–∫–∞
                noteInput.style.backgroundColor = '#f8f9fa';
                noteInput.style.borderColor = '#007bff';
            } else {
                await saveUserDataChange(noteId, null);
                noteInput.style.backgroundColor = '';
                noteInput.style.borderColor = '#ccc';
                console.log('–ü—Ä–µ–º–∞—Ö–Ω–∞—Ç–∞ –±–µ–ª–µ–∂–∫–∞:', noteId);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞ –≤—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ —Å—ä—Å—Ç–æ—è–Ω–∏–µ—Ç–æ –Ω–∞ checkbox-–æ–≤–µ—Ç–µ –∏ –±–µ–ª–µ–∂–∫–∏—Ç–µ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ
        function restoreCheckboxStates() {
            console.log('üìã restoreCheckboxStates - –∑–∞–ø–æ—á–≤–∞ —Å userDataCache:', userDataCache);
            console.log('üìã –û–±—â–æ –∫–ª—é—á–æ–≤–µ –≤ –∫–µ—à–∞:', Object.keys(userDataCache).length);
            
            const CHECKBOX_PREFIXES = ['check_', 'fastener_check_', 'node_check_', 'checkbox_'];
            const NOTE_PREFIXES = ['note_', 'notes_', 'notes_node_'];
            
            Object.keys(userDataCache).forEach(key => {
                // Checkbox-–∏
                if (CHECKBOX_PREFIXES.some(p => key.startsWith(p))) {
                    if (userDataCache[key] === 'checked') {
                        const cb = document.getElementById(key);
                        if (cb) {
                            cb.checked = true;
                            // –ü—Ä–∏–ª–∞–≥–∞–º–µ –≤–∏–∑—É–∞–ª–Ω–∏—Ç–µ –µ—Ñ–µ–∫—Ç–∏ –±–µ–∑ –¥–∞ –ø—Ä–µ–¥–∏–∑–≤–∏–∫–≤–∞–º–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–ø–∏—Å–≤–∞–Ω–µ
                            const row = cb.closest('tr, .fastener-part-item');
                            if (row) {
                                row.style.backgroundColor = '#d4edda';
                                row.style.opacity = '0.7';
                                const strongEl = row.querySelector('strong');
                                if (strongEl) strongEl.style.textDecoration = 'line-through';
                            }
                        } else {
                            console.log('‚ùå –õ–∏–ø—Å–≤–∞ checkbox –µ–ª–µ–º–µ–Ω—Ç –∑–∞ –∫–ª—é—á:', key);
                        }
                    }
                }
                // –ë–µ–ª–µ–∂–∫–∏ / notes
                if (NOTE_PREFIXES.some(p => key.startsWith(p))) {
                    const noteEl = document.getElementById(key);
                    if (noteEl && userDataCache[key]) {
                        noteEl.value = userDataCache[key];
                        noteEl.style.backgroundColor = '#f8f9fa';
                        noteEl.style.borderColor = '#007bff';
                    }
                }
            });
            console.log('üìã restoreCheckboxStates –∑–∞–≤—ä—Ä—à–µ–Ω');
        }

        // ===== RAL –£–ü–†–ê–í–õ–ï–ùÔøΩ?–ï –§–£–ù–ö–¶ÔøΩ?ÔøΩ? =====
        // –í–µ—á–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–∞–º–µ RAL –ø—Ä–µ–∑ shared userDataCache.
        // –§–æ—Ä–º–∞—Ç –Ω–∞ –∑–∞–ø–∏—Å –≤ userDataCache: –∫–ª—é—á 'ral_<CODE>' => JSON.stringify({nodeDescription, selectedOption, colorDescription})
        
        // –î–µ—Ñ–∏–Ω–∏—Ä–∞–Ω–µ –Ω–∞ –æ–ø—Ü–∏–∏—Ç–µ –∑–∞ –≤—Å–µ–∫–∏ RAL
        function getRalOptions(ralCode) {
            const ralOptionsMap = {
                'RAL': ['-', 'RAL 9005', 'RAL 5009', 'RAL 3020'],
                'RAL1': ['-', 'RAL 3020', 'Zn'],
                'RAL2': ['-', 'RAL 9010', 'Zn'],
                'RAL3': ['-', 'RAL 9006', 'Zn'],
                'RAL4': ['-', 'RAL 9006', 'Zn'],
                'RAL5': ['-', 'RAL 9006', 'Zn'],
                'RAL6': ['-', 'RAL 1003', 'Zn'],
                'RAL7': ['-', 'RAL 9010', 'Zn'],
                'RAL8': ['-', 'RAL 9010', 'RAL 9005', 'RAL 3020', 'Zn'],
                'RAL9': ['-', 'RAL 9007', 'RAL 7024', 'Zn']
            };
            
            return ralOptionsMap[ralCode] || ['-', 'RAL 9010', 'Zn']; // –ü–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ
        }

        // üîÑ –í—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞ —Å—ä—Å—Ç–æ—è–Ω–∏—è—Ç–∞ –Ω–∞ checkbox-–∏ –∏ –±–µ–ª–µ–∂–∫–∏ –æ—Ç —Å–ø–æ–¥–µ–ª–µ–Ω–∏—Ç–µ –¥–∞–Ω–Ω–∏
        function restoreUserInterfaceStates() {
            console.log('üé® restoreUserInterfaceStates - userDataCache:', userDataCache);
            console.log('üé® –ë—Ä–æ–π –∫–ª—é—á–æ–≤–µ –≤ –∫–µ—à–∞:', Object.keys(userDataCache).length);
            
            // ÔøΩ?–∑—á–∞–∫–≤–∞–º–µ –º–∞–ª–∫–æ –¥–∞ —Å–µ –≥–µ–Ω–µ—Ä–∏—Ä–∞—Ç HTML –µ–ª–µ–º–µ–Ω—Ç–∏—Ç–µ
            setTimeout(() => {
                console.log('üé® –í—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ —Å—ä—Å—Ç–æ—è–Ω–∏—è (—Å–ª–µ–¥ timeout)...');
                
                // –í—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞ checkbox —Å—ä—Å—Ç–æ—è–Ω–∏—è
                Object.keys(userDataCache).forEach(key => {
                    if (key.startsWith('checkbox_') && userDataCache[key] === 'checked') {
                        console.log('üîç –¢—ä—Ä—Å—è checkbox:', key);
                        const checkbox = document.getElementById(key);
                        if (checkbox) {
                            console.log('‚úÖ –ù–∞–º–µ—Ä–µ–Ω checkbox, –≤—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞–º —Å—ä—Å—Ç–æ—è–Ω–∏–µ—Ç–æ');
                            checkbox.checked = true;
                            // –ü—Ä–∏–ª–∞–≥–∞–º–µ –≤–∏–∑—É–∞–ª–Ω–∏—Ç–µ –µ—Ñ–µ–∫—Ç–∏
                            const partRow = checkbox.closest('tr, .fastener-part-item');
                            if (partRow) {
                                partRow.style.backgroundColor = '#d4edda';
                                partRow.style.opacity = '0.7';
                                const partNameElement = partRow.querySelector('strong');
                                if (partNameElement) {
                                    partNameElement.style.textDecoration = 'line-through';
                                }
                            }
                        } else {
                            console.log('‚ùå –ù–µ –µ –Ω–∞–º–µ—Ä–µ–Ω checkbox —Å ID:', key);
                        }
                    }
                    
                    // –í—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞ –±–µ–ª–µ–∂–∫–∏
                    if (key.startsWith('note_')) {
                        const noteInput = document.getElementById(key);
                        if (noteInput && userDataCache[key]) {
                            noteInput.value = userDataCache[key];
                            noteInput.style.backgroundColor = '#f8f9fa';
                            noteInput.style.borderColor = '#007bff';
                        }
                    }
                });
                
                console.log('üîÑ –í—ä–∑—Å—Ç–∞–Ω–æ–≤–µ–Ω–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–∏ —Å—ä—Å—Ç–æ—è–Ω–∏—è');
            }, 1000); // ÔøΩ?–∑—á–∞–∫–≤–∞–º–µ 1 —Å–µ–∫—É–Ω–¥–∞ –∑–∞ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ HTML
        }

        // –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ RAL —Ç–∞–±–ª–∏—Ü–∞—Ç–∞ (–ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–º–µ —Å–ø–æ–¥–µ–ª–µ–Ω–∏ –¥–∞–Ω–Ω–∏, fallback –∫—ä–º localStorage)
        function loadRalManagementTable() {
            let ralData = {};
            const sharedRalKeys = Object.keys(userDataCache).filter(k => k.startsWith('ral_'));
            if (sharedRalKeys.length > 0) {
                console.log('üé® –ó–∞—Ä–µ–∂–¥–∞–º RAL –æ—Ç —Å–ø–æ–¥–µ–ª–µ–Ω–∏ –¥–∞–Ω–Ω–∏:', sharedRalKeys);
                sharedRalKeys.forEach(k => {
                    try {
                        const code = k.replace('ral_', '');
                        ralData[code] = JSON.parse(userDataCache[k]);
                    } catch (e) {
                        console.warn('‚ö†Ô∏è –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–≤–∞–Ω–µ –Ω–∞ RAL –∑–∞–ø–∏—Å', k, e);
                    }
                });
            } else {
                // Fallback –∫—ä–º localStorage (—Å—Ç–∞—Ä —Ä–µ–∂–∏–º –∏–ª–∏ –ø—ä—Ä–≤–æ —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ)
                const savedRalData = localStorage.getItem('ralColorData');
                ralData = savedRalData ? JSON.parse(savedRalData) : {};
            }
            // –ê–∫–æ –ø—Ä–∞–∑–Ω–æ ‚Äì –∑–∞—Ä–µ–∂–¥–∞–º–µ default
            if (Object.keys(ralData).length === 0) {
                ralData = {
                    'RAL': { nodeDescription: '–ü–∞–Ω–µ–ª –∑–∞ –±—É—Ç–æ–Ω–∏–µ—Ä–∞', selectedOption: 'RAL 9005', colorDescription: '–ß–µ—Ä–Ω–æ' },
                    'RAL1': { nodeDescription: '–†–∏—Ñ–µ–ª', selectedOption: 'RAL 3020', colorDescription: '–ß–µ—Ä–≤–µ–Ω–æ' },
                    'RAL2': { nodeDescription: '–õ–µ–∑–µ–Ω–∏, –¢–∞–≤–∞–Ω, –ü–æ–¥', selectedOption: 'RAL 9010', colorDescription: '–ë—è–ª–æ' },
                    'RAL3': { nodeDescription: '–ü–ª–∞—Ç–Ω–∞ (–õ–∏—Ü–µ–≤–∞ —á–∞—Å—Ç)', selectedOption: 'RAL 9006', colorDescription: '–ë—è–ª–æ –∞–ª—É–º–∏–Ω–∏–π' },
                    'RAL4': { nodeDescription: '–ü–ª–∞—Ç–Ω–∞ (–ì—Ä—ä–±)', selectedOption: 'RAL 9006', colorDescription: '–ë—è–ª–æ –∞–ª—É–º–∏–Ω–∏–π' },
                    'RAL5': { nodeDescription: '–í—Ä–∞—Ç–∏ (–ü–ª–∞—Ç–Ω–∞)', selectedOption: 'RAL 9006', colorDescription: '–ë—è–ª–æ –∞–ª—É–º–∏–Ω–∏–π' },
                    'RAL6': { nodeDescription: '–§–æ—Ç–æ–±–∞—Ä–∏–µ—Ä–∏', selectedOption: 'RAL 1003', colorDescription: '–°–∏–≥–Ω–∞–ª–Ω–æ –∂—ä–ª—Ç–æ' },
                    'RAL7': { nodeDescription: '–í—Ä–∞—Ç–∏ (–ö–∞—Å–∏, –ø—Ä–∞–≥)', selectedOption: 'RAL 9010', colorDescription: '–ë—è–ª–æ' },
                    'RAL8': { nodeDescription: '–í—Ä–∞—Ç–∏ (–û—Ä–Ω–∞–º–µ–Ω—Ç–∏)', selectedOption: 'RAL 9010', colorDescription: '–ë—è–ª–æ (–º–Ω–æ–≥–æ—Ü–≤–µ—Ç–µ–Ω)' },
                    'RAL9': { nodeDescription: '–ü–æ–∫—Ä–∏–≤', selectedOption: 'RAL 9007', colorDescription: '–°–∏–≤–æ –∞–ª—É–º–∏–Ω–∏–π' }
                };
            }
            // –ö–µ—à–∏—Ä–∞–º–µ RAL –≤ –ø–∞–º–µ—Ç—Ç–∞ –∑–∞ –ø–æ-–±—ä—Ä–∑ –¥–æ—Å—Ç—ä–ø
            window.currentRalData = ralData;
            updateRalTable(ralData);
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è: –∞–∫–æ —Å–º–µ –≤ —Å–ø–æ–¥–µ–ª–µ–Ω —Ä–µ–∂–∏–º –∏ –Ω—è–º–∞ —Å–ø–æ–¥–µ–ª–µ–Ω–∏ –∫–ª—é—á–æ–≤–µ, –Ω–æ –∏–º–∞ –ª–æ–∫–∞–ª–Ω–∏ ‚Äì –º–∏–≥—Ä–∏—Ä–∞–º–µ.
            if (isSharedMode && sharedRalKeys.length === 0) {
                const savedRalData = localStorage.getItem('ralColorData');
                if (savedRalData) {
                    try {
                        const localRal = JSON.parse(savedRalData);
                        console.log('üöö –ú–∏–≥—Ä–∏—Ä–∞–º –ª–æ–∫–∞–ª–Ω–∏ RAL –∫—ä–º —Å–ø–æ–¥–µ–ª–µ–Ω–∏...', Object.keys(localRal));
                        Object.keys(localRal).forEach(code => {
                            saveUserDataChange('ral_' + code, JSON.stringify(localRal[code]));
                        });
                        showNotification('–õ–æ–∫–∞–ª–Ω–∏—Ç–µ RAL –∑–∞–ø–∏—Å–∏ —Å–∞ –º–∏–≥—Ä–∏—Ä–∞–Ω–∏ –∫—ä–º —Å–ø–æ–¥–µ–ª–µ–Ω–∏—è —Ñ–∞–π–ª.', 'success');
                    } catch (e) {
                        console.warn('‚ö†Ô∏è –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –ª–æ–∫–∞–ª–Ω–∏—Ç–µ RAL –¥–∞–Ω–Ω–∏', e);
                    }
                }
            }
        }
        
        // –û–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ —Ç–∞–±–ª–∏—Ü–∞—Ç–∞ —Å RAL –¥–∞–Ω–Ω–∏
        function updateRalTable(ralData) {
            const tbody = document.getElementById('ralManagementTableBody');
            tbody.innerHTML = '';
            
            // –°–æ—Ä—Ç–∏—Ä–∞–º–µ –∫–ª—é—á–æ–≤–µ—Ç–µ —Ç–∞–∫–∞ —á–µ "RAL" –¥–∞ –µ –ø—ä—Ä–≤–∏, —Å–ª–µ–¥ —Ç–æ–≤–∞ RAL1, RAL2, –∏ —Ç.–Ω.
            const sortedKeys = Object.keys(ralData).sort((a, b) => {
                if (a === 'RAL') return -1;  // "RAL" –≤–∏–Ω–∞–≥–∏ –ø—ä—Ä–≤–∏
                if (b === 'RAL') return 1;   // "RAL" –≤–∏–Ω–∞–≥–∏ –ø—ä—Ä–≤–∏
                return a.localeCompare(b, undefined, { numeric: true }); // Numeric sort –∑–∞ RAL1, RAL2, –∏ —Ç.–Ω.
            });
            
            sortedKeys.forEach(ralCode => {
                const options = getRalOptions(ralCode);
                const selectedValue = ralData[ralCode].selectedOption || options[0];
                
                // –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ dropdown –æ–ø—Ü–∏–∏
                const optionsHTML = options.map(option => 
                    `<option value="${option}" ${option === selectedValue ? 'selected' : ''}>${option}</option>`
                ).join('');
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="padding: 8px; text-align: center;"><strong>${ralCode}</strong></td>
                    <td style="padding: 8px; text-align: center;">
                        <input type="text" 
                               class="admin-only-control"
                               value="${ralData[ralCode].nodeDescription || ''}" 
                               placeholder="–ó–∞ –∫–æ–π –≤—ä–∑–µ–ª –µ"
                               onchange="updateRalEntry('${ralCode}', 'nodeDescription', this.value)"
                               style="width: 180px; padding: 4px; border: 1px solid #ccc; border-radius: 3px; text-align: center;">
                    </td>
                    <td style="padding: 8px; text-align: center; padding-left: 20px;">
                        <select onchange="updateRalEntry('${ralCode}', 'selectedOption', this.value)"
                                class="admin-only-control"
                                style="width: 120px; padding: 4px; border: 1px solid #ccc; border-radius: 3px;">
                            ${optionsHTML}
                        </select>
                    </td>
                    <td style="padding: 8px; text-align: center;">
                        <input type="text" 
                               class="admin-only-control"
                               value="${ralData[ralCode].colorDescription || ''}" 
                               placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ü–≤–µ—Ç–∞"
                               onchange="updateRalEntry('${ralCode}', 'colorDescription', this.value)"
                               style="width: 150px; padding: 4px; border: 1px solid #ccc; border-radius: 3px; text-align: center;">
                    </td>
                    <td style="padding: 8px; text-align: center;">
                        <button onclick="deleteRalEntry('${ralCode}')" 
                                class="admin-only-control"
                                style="padding: 4px 8px; background: #dc3545; color: white; border: none; border-radius: 3px; cursor: pointer;">
                            üóëÔ∏è ÔøΩ?–∑—Ç—Ä–∏–π
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // –û–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ RAL –∑–∞–ø–∏—Å
        function updateRalEntry(ralCode, field, value) {
            if (!isAdminMode) {
                alert('‚ùå –†–µ–¥–∞–∫—Ü–∏—è—Ç–∞ –µ –¥–æ—Å—Ç—ä–ø–Ω–∞ —Å–∞–º–æ –≤ –∞–¥–º–∏–Ω —Ä–µ–∂–∏–º!');
                // –ü—Ä–µ–∑–∞—Ä–µ–∂–¥–∞–º–µ —Ç–∞–±–ª–∏—Ü–∞—Ç–∞ –∑–∞ –¥–∞ —Å–µ –≤—ä—Ä–Ω–µ —Å—Ç–∞—Ä–∞—Ç–∞ —Å—Ç–æ–π–Ω–æ—Å—Ç
                updateRalTable(window.currentRalData);
                return;
            }
            console.log(`[DEBUG] –û–±–Ω–æ–≤—è–≤–∞–º ${ralCode}.${field} = ${value}`);
            if (!window.currentRalData) window.currentRalData = {};
            if (!window.currentRalData[ralCode]) {
                window.currentRalData[ralCode] = { nodeDescription: '', selectedOption: '', colorDescription: '' };
            }
            window.currentRalData[ralCode][field] = value;
            // –ó–∞–ø–∏—Å –≤ shared cache
            saveUserDataChange('ral_' + ralCode, JSON.stringify(window.currentRalData[ralCode]));
            // –õ–æ–∫–∞–ª–µ–Ω fallback
            if (!isSharedMode) {
                localStorage.setItem('ralColorData', JSON.stringify(window.currentRalData));
            }
        }
        
        // –î–æ–±–∞–≤—è–Ω–µ –Ω–∞ –Ω–æ–≤ RAL –∑–∞–ø–∏—Å
        function addNewRalEntry() {
            if (!isAdminMode) {
                alert('‚ùå –¢–∞–∑–∏ —Ñ—É–Ω–∫—Ü–∏—è –µ –¥–æ—Å—Ç—ä–ø–Ω–∞ —Å–∞–º–æ –≤ –∞–¥–º–∏–Ω —Ä–µ–∂–∏–º!');
                return;
            }
            const ralCode = prompt('–í—ä–≤–µ–¥–µ—Ç–µ RAL –∫–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä RAL11):');
            if (ralCode && ralCode.trim()) {
                const code = ralCode.trim();
                if (!window.currentRalData) window.currentRalData = {};
                window.currentRalData[code] = { nodeDescription: '', selectedOption: 'RAL 9010', colorDescription: '' };
                saveUserDataChange('ral_' + code, JSON.stringify(window.currentRalData[code]));
                if (!isSharedMode) {
                    localStorage.setItem('ralColorData', JSON.stringify(window.currentRalData));
                }
                updateRalTable(window.currentRalData);
                console.log(`–î–æ–±–∞–≤–µ–Ω –Ω–æ–≤ RAL –∑–∞–ø–∏—Å (shared): ${code}`);
            }
        }
        
        // ÔøΩ?–∑—Ç—Ä–∏–≤–∞–Ω–µ –Ω–∞ RAL –∑–∞–ø–∏—Å
        function deleteRalEntry(ralCode) {
            if (!isAdminMode) {
                alert('‚ùå –¢–∞–∑–∏ —Ñ—É–Ω–∫—Ü–∏—è –µ –¥–æ—Å—Ç—ä–ø–Ω–∞ —Å–∞–º–æ –≤ –∞–¥–º–∏–Ω —Ä–µ–∂–∏–º!');
                return;
            }
            if (confirm(`–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –∏–∑—Ç—Ä–∏–µ—Ç–µ ${ralCode}?`)) {
                if (window.currentRalData && window.currentRalData[ralCode]) {
                    delete window.currentRalData[ralCode];
                }
                // –ü—Ä–µ–º–∞—Ö–≤–∞–º–µ –æ—Ç shared –¥–∞–Ω–Ω–∏—Ç–µ
                saveUserDataChange('ral_' + ralCode, null);
                if (!isSharedMode) {
                    localStorage.setItem('ralColorData', JSON.stringify(window.currentRalData));
                }
                updateRalTable(window.currentRalData);
                console.log(`ÔøΩ?–∑—Ç—Ä–∏—Ç RAL –∑–∞–ø–∏—Å (shared): ${ralCode}`);
            }
        }
        
        // –ó–∞–ø–∞–∑–≤–∞–Ω–µ –Ω–∞ –≤—Å–∏—á–∫–∏ RAL –¥–∞–Ω–Ω–∏
        function saveRalData() {
            if (!isAdminMode) {
                alert('‚ùå –¢–∞–∑–∏ —Ñ—É–Ω–∫—Ü–∏—è –µ –¥–æ—Å—Ç—ä–ø–Ω–∞ —Å–∞–º–æ –≤ –∞–¥–º–∏–Ω —Ä–µ–∂–∏–º!');
                return;
            }
            if (!window.currentRalData) {
                alert('–ù—è–º–∞ RAL –¥–∞–Ω–Ω–∏.');
                return;
            }
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª–Ω–æ –∏–∑–ø—Ä–∞—â–∞–º–µ –≤—Å–∏—á–∫–∏ RAL –∑–∞–ø–∏—Å–∏ –∫—ä–º shared (–∞–∫–æ —Å–º–µ –≤ –º—Ä–µ–∂–æ–≤ —Ä–µ–∂–∏–º)
            Object.keys(window.currentRalData).forEach(code => {
                saveUserDataChange('ral_' + code, JSON.stringify(window.currentRalData[code]));
            });
            if (!isSharedMode) {
                localStorage.setItem('ralColorData', JSON.stringify(window.currentRalData));
            }
            alert('RAL –¥–∞–Ω–Ω–∏—Ç–µ —Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–∞–Ω–∏!');
            console.log('RAL (currentRalData):', window.currentRalData);
        }

        /* –ü—Ä–µ–º–∞—Ö–Ω–∞—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è restoreMissingRalEntries() –∑–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç—è–≤–∞–Ω–µ –Ω–∞ —Å–ª—É—á–∞–π–Ω–∏ –ø—Ä–µ–∑–∞–ø–∏—Å–∏ */

        // –î–æ–±–∞–≤—è–º–µ event listener –∑–∞ –≤—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ —Å—ä—Å—Ç–æ—è–Ω–∏–µ—Ç–æ –ø—Ä–∏ —Å–º—è–Ω–∞ –Ω–∞ —Ç–∞–± –∏–ª–∏ —Ä–µ–∂–∏–º
        document.addEventListener('DOMContentLoaded', function() {
            // –ú–∞–ª–∫–æ –∑–∞–∫—ä—Å–Ω–µ–Ω–∏–µ –∑–∞ –¥–∞ —Å–µ –∑–∞—Ä–µ–∂–¥–∞ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ—Ç–æ
            setTimeout(restoreCheckboxStates, 500);
        });

        // ===== –§–£–ù–ö–¶ÔøΩ?ÔøΩ? –ó–ê –†–ê–ë–û–¢–ê –° ÔøΩ?–ó–û–ë–†–ê–ñ–ï–ùÔøΩ?–Ø =====
        
        // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –∞–±—Å–æ–ª—é—Ç–µ–Ω –ø—ä—Ç –≤ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª–µ–Ω
        function convertImagePath(imagePath) {
            if (!imagePath || imagePath.trim() === '') {
                return null;
            }
            
            console.log('–û—Ä–∏–≥–∏–Ω–∞–ª–µ–Ω –ø—ä—Ç:', imagePath);
            
            // –ê–∫–æ –ø—ä—Ç—è—Ç –µ –∞–±—Å–æ–ª—é—Ç–µ–Ω, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–∞–º–µ –≥–æ –≤ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª–µ–Ω
            if (imagePath.includes('Screenshots\\')) {
                // ÔøΩ?–∑–≤–ª–∏—á–∞–º–µ —á–∞—Å—Ç—Ç–∞ —Å–ª–µ–¥ Screenshots
                const parts = imagePath.split('Screenshots\\');
                if (parts.length > 1) {
                    // –ó–∞–º–µ–Ω—è–º–µ –æ–±—Ä–∞—Ç–Ω–∏—Ç–µ —Å–ª–µ—à–æ–≤–µ —Å –æ–±–∏–∫–Ω–æ–≤–µ–Ω–∏
                    let relativePath = parts[1].replace(/\\/g, '/');
                    
                    const finalPath = `images/${relativePath}`;
                    console.log('–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–∞–Ω –ø—ä—Ç:', finalPath);
                    return finalPath;
                }
            }
            
            // –ê–∫–æ –ø—ä—Ç—è—Ç –≤–µ—á–µ –µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª–µ–Ω, –≤—Ä—ä—â–∞–º–µ –≥–æ –∫–∞–∫—Ç–æ –µ
            console.log('ÔøΩ?–∑–ø–æ–ª–∑–≤–∞–º–µ –æ—Ä–∏–≥–∏–Ω–∞–ª–Ω–∏—è –ø—ä—Ç:', imagePath);
            return imagePath;
        }

        // –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ HTML —Å tooltip –∏ modal —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç
        // ============================================
        // –†–ï–ß–ùÔøΩ?–ö –ó–ê –ü–†–ï–í–û–î –ù–ê ÔøΩ?–ú–ï–ù–ê
        // ============================================
        
        const translationDictionary = {
            // –û—Å–Ω–æ–≤–Ω–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏
            'Komplekt': '–ö–æ–º–ø–ª–µ–∫—Ç',
            'komplekt': '–∫–æ–º–ø–ª–µ–∫—Ç',
            'Bufer': '–ë—É—Ñ–µ—Ä', 
            'bufer': '–±—É—Ñ–µ—Ä',
            'Planka': '–ü–ª–∞–Ω–∫–∞',
            'planka': '–ø–ª–∞–Ω–∫–∞',
            'Anker': '–ê–Ω–∫–µ—Ä',
            'anker': '–∞–Ω–∫–µ—Ä', 
            'Pizzato': '–ü–∏–∑–∞—Ç–æ',
            'pizzato': '–ø–∏–∑–∞—Ç–æ',
            'Reze': '–†–µ–∑–µ',
            'reze': '—Ä–µ–∑–µ',
            'Chast': '–ß–∞—Å—Ç',
            'chast': '—á–∞—Å—Ç',
            'Service': '–°–µ—Ä–≤–∏–∑',
            'service': '—Å–µ—Ä–≤–∏–∑',
            
            // –í–∏–Ω—Ç–æ–≤–µ –∏ –∫—Ä–µ–ø–µ–∂–∏ - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏ —Ä–∞–∑–º–µ—Ä–∏
            'M4x16': '–ú4—Ö16',
            'M4x35': '–ú4—Ö35', 
            'M8x20': '–ú8—Ö20',
            'M10x80': '–ú10—Ö80',
            'M12x30': '–ú12—Ö30',
            
            // –û–±—â–∏ –¥—É–º–∏
            'ALL': '–í–°ÔøΩ?–ß–öÔøΩ?',
            'GE': '–ì–ï',
            'ot': '–æ—Ç'
        };

        // –§—É–Ω–∫—Ü–∏—è –∑–∞ –ø—Ä–µ–≤–æ–¥ –Ω–∞ –∏–º–µ–Ω–∞
        function translateName(name) {
            let translatedName = name;
            
            // –ü—Ä–µ–≤–æ–¥–∏–º –≤—Å—è–∫–∞ –¥—É–º–∞ –æ—Ç —Ä–µ—á–Ω–∏–∫–∞
            Object.keys(translationDictionary).forEach(englishWord => {
                const bulgarianWord = translationDictionary[englishWord];
                // ÔøΩ?–∑–ø–æ–ª–∑–≤–∞–º–µ —Ä–µ–≥—É–ª—è—Ä–µ–Ω –∏–∑—Ä–∞–∑ –∑–∞ –¥–∞ –∑–∞–º–µ–Ω–∏–º —Ü—è–ª–∞—Ç–∞ –¥—É–º–∞ (–Ω–µ —á–∞—Å—Ç –æ—Ç –¥—Ä—É–≥–∞ –¥—É–º–∞)
                const regex = new RegExp('\\b' + englishWord.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + '\\b', 'g');
                translatedName = translatedName.replace(regex, bulgarianWord);
            });
            
            return translatedName;
        }

        // ============================================
        // –§–£–ù–ö–¶ÔøΩ?ÔøΩ? –ó–ê –†–ê–ë–û–¢–ê –°–™–° –°–ùÔøΩ?–ú–öÔøΩ?
        // ============================================

        function createImageTooltip(name, imagePath, isAssembly = false) {
            try {
                // –ê–∫–æ –Ω—è–º–∞ imagePath, –≥–µ–Ω–µ—Ä–∏—Ä–∞–º–µ –≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –Ω–∞ –±–∞–∑–∞—Ç–∞ –Ω–∞ –∏–º–µ—Ç–æ
                if (!imagePath || imagePath.trim() === '') {
                    // –û–ø—Ä–µ–¥–µ–ª—è–º–µ –ø–∞–ø–∫–∞—Ç–∞ —Å–ø–æ—Ä–µ–¥ —Ç–æ–≤–∞ –¥–∞–ª–∏ –µ –∞—Å–µ–º–±–ª–∏
                    const folder = isAssembly ? 'Assemblies' : 'Parts';
                    imagePath = `Screenshots/${folder}/${name}.png`;
                    console.log('[createImageTooltip] –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ–Ω –ø—ä—Ç:', imagePath, '–∑–∞', isAssembly ? '–∞—Å–µ–º–±–ª–∏' : '–¥–µ—Ç–∞–π–ª', ':', name);
                }
                
                // Debug –∑–∞ GE - Pizzato
                if (name.includes('Pizzato')) {
                    console.log('[createImageTooltip DEBUG] –û–±—Ä–∞–±–æ—Ç–≤–∞–º Pizzato - –∏–º–µ:', name, '–ø—ä—Ç:', imagePath, 'isAssembly:', isAssembly);
                }
                
                const convertedPath = convertImagePath(imagePath);
                if (!convertedPath) {
                    console.log('[createImageTooltip] convertImagePath –≤—ä—Ä–Ω–∞ null –∑–∞:', imagePath);
                    return name;
                }
                
                console.log('[createImageTooltip] –°—ä–∑–¥–∞–≤–∞–º tooltip –∑–∞:', name, '—Å –ø—ä—Ç:', convertedPath);
                
                // –ü—Ä–µ–≤–µ–∂–¥–∞–º–µ –∏–º–µ—Ç–æ –∑–∞ –ø–æ–∫–∞–∑–≤–∞–Ω–µ
                const translatedName = translateName(name);
                
                // Escape-–≤–∞–º–µ –∫–∞–≤–∏—á–∫–∏—Ç–µ –≤ –∏–º–µ—Ç–æ –∏ –ø—ä—Ç—è
                const escapedName = (name || '').replace(/'/g, "\\'").replace(/"/g, '&quot;');
                const escapedPath = (convertedPath || '').replace(/'/g, "\\'");
                
                return `<span class="image-tooltip" 
                            onmouseover="showTooltip(event, '${escapedPath}')" 
                            onmouseout="hideTooltip()"
                            onclick="showImageModal('${escapedName}', '${escapedPath}')"
                            style="cursor: pointer;">
                            ${translatedName}
                        </span>`;
            } catch (error) {
                console.error('–ì—Ä–µ—à–∫–∞ –≤ createImageTooltip:', error, '–∑–∞ –∏–º–µ:', name);
                return name; // –í—Ä—ä—â–∞–º–µ —Å–∞–º–æ –∏–º–µ—Ç–æ –ø—Ä–∏ –≥—Ä–µ—à–∫–∞
            }
        }        // –û–ø–∏—Ç–≤–∞ —Å–µ –¥–∞ –∑–∞—Ä–µ–¥–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å fallback –æ–ø—Ü–∏–∏
        function tryLoadImage(imagePath, callback, attempt = 1) {
            if (attempt > 5) { // 5 –æ–ø–∏—Ç–∞
                console.log('–í—Å–∏—á–∫–∏ –æ–ø–∏—Ç–∏ –∑–∞ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —Å–Ω–∏–º–∫–∞—Ç–∞ —Å–µ –ø—Ä–æ–≤–∞–ª–∏—Ö–∞:', imagePath);
                callback(false);
                return;
            }

            const img = new Image();
            img.onload = function() {
                console.log('‚úÖ –°–Ω–∏–º–∫–∞—Ç–∞ —Å–µ –∑–∞—Ä–µ–¥–∏ —É—Å–ø–µ—à–Ω–æ:', imagePath);
                callback(true, imagePath);
            };
            
            img.onerror = function() {
                console.log(`‚ùå –û–ø–∏—Ç ${attempt} - –Ω–µ –º–æ–∂–µ –¥–∞ —Å–µ –∑–∞—Ä–µ–¥–∏:`, imagePath);
                const fileName = imagePath.split('/').pop();
                
                // –û–ø–∏—Ç 1: –û—Ä–∏–≥–∏–Ω–∞–ª–Ω–∏—è—Ç –ø—ä—Ç (Parts –∏–ª–∏ Assemblies —Å–ø–æ—Ä–µ–¥ isAssembly)
                if (attempt === 1) {
                    // –û–ø–∏—Ç 2: –ü—Ä–æ–±–≤–∞–º–µ –¥—Ä—É–≥–∞—Ç–∞ –ø–∞–ø–∫–∞
                    if (imagePath.includes('Parts/')) {
                        const newPath = imagePath.replace('Parts/', 'Assemblies/');
                        console.log('‚û°Ô∏è –û–ø–∏—Ç 2: –ü—Ä–æ–±–≤–∞–º –≤ Assemblies:', newPath);
                        tryLoadImage(newPath, callback, 2);
                    } else if (imagePath.includes('Assemblies/')) {
                        const newPath = imagePath.replace('Assemblies/', 'Parts/');
                        console.log('‚û°Ô∏è –û–ø–∏—Ç 2: –ü—Ä–æ–±–≤–∞–º –≤ Parts:', newPath);
                        tryLoadImage(newPath, callback, 2);
                    } else {
                        callback(false);
                    }
                    return;
                }
                
                // –û–ø–∏—Ç 2: –í–µ—á–µ —Å–º–µ –≤ –¥—Ä—É–≥–∞—Ç–∞ –ø–∞–ø–∫–∞, –ø—Ä–æ–±–≤–∞–º–µ —Å " Komplekt_1_"
                if (attempt === 2 && !fileName.includes('Komplekt')) {
                    const baseName = fileName.replace('.png', ' Komplekt_1_.png');
                    const newPath = imagePath.replace(fileName, baseName);
                    console.log('‚û°Ô∏è –û–ø–∏—Ç 3: –ü—Ä–æ–±–≤–∞–º —Å Komplekt_1_:', newPath);
                    tryLoadImage(newPath, callback, 3);
                    return;
                }
                
                // –û–ø–∏—Ç 3: –ü—Ä–æ–±–≤–∞–º–µ –ø—Ä–æ—Å—Ç–æ _1_
                if (attempt === 3 && !fileName.includes('_1_')) {
                    const baseName = fileName.replace('.png', '_1_.png');
                    const newPath = imagePath.replace(fileName, baseName);
                    console.log('‚û°Ô∏è –û–ø–∏—Ç 4: –ü—Ä–æ–±–≤–∞–º —Å _1_:', newPath);
                    tryLoadImage(newPath, callback, 4);
                    return;
                }
                
                // –û–ø–∏—Ç 4: –ü–æ—Å–ª–µ–¥–Ω–∞ –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç - –æ–±—Ä–∞—Ç–Ω–æ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–Ω–∞—Ç–∞ –ø–∞–ø–∫–∞ —Å _1_
                if (attempt === 4) {
                    let newPath;
                    if (imagePath.includes('Parts/')) {
                        newPath = imagePath.replace('Parts/', 'Assemblies/');
                    } else {
                        newPath = imagePath.replace('Assemblies/', 'Parts/');
                    }
                    if (!fileName.includes('_1_')) {
                        const baseName = fileName.replace('.png', '_1_.png');
                        newPath = newPath.replace(fileName, baseName);
                    }
                    console.log('‚û°Ô∏è –û–ø–∏—Ç 5: –ü–æ—Å–ª–µ–¥–µ–Ω –æ–ø–∏—Ç:', newPath);
                    tryLoadImage(newPath, callback, 5);
                    return;
                }
                
                callback(false);
            };
            
            img.src = imagePath;
        }

        // –ü–æ–∫–∞–∑–≤–∞ tooltip —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∏ hover
        function showTooltip(event, imagePath) {
            // –ü—Ä–µ–º–∞—Ö–≤–∞–º–µ –ø—Ä–µ–¥–∏—à–Ω–∏ tooltip-—É—Ä–∏
            hideTooltip();
            
            console.log('showTooltip –∏–∑–≤–∏–∫–∞–Ω –∑–∞:', imagePath);
            
            tryLoadImage(imagePath, function(success, finalPath) {
                if (!success) {
                    console.log('–ù—è–º–∞ –¥–æ—Å—Ç—ä–ø–Ω–∞ —Å–Ω–∏–º–∫–∞ –∑–∞:', imagePath);
                    return;
                }
                
                const tooltip = document.createElement('div');
                tooltip.id = 'imageTooltip';
                
                // ÔøΩ?–Ω—Ç–µ–ª–∏–≥–µ–Ω—Ç–Ω–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–∞–Ω–µ —Å–ø—Ä—è–º–æ –ø–æ–∑–∏—Ü–∏—è—Ç–∞ –Ω–∞ –µ–ª–µ–º–µ–Ω—Ç–∞
                const rect = event.target.getBoundingClientRect();
                const windowWidth = window.innerWidth;
                const tooltipWidth = 500; // —à–∏—Ä–∏–Ω–∞—Ç–∞ –Ω–∞ tooltip-–∞
                
                console.log('–ü–æ–∑–∏—Ü–∏—è –Ω–∞ –µ–ª–µ–º–µ–Ω—Ç–∞:', rect.left, rect.right, '–®–∏—Ä–∏–Ω–∞ –Ω–∞ –ø—Ä–æ–∑–æ—Ä–µ—Ü–∞:', windowWidth);
                
                // –ü–æ-–∞–≥—Ä–µ—Å–∏–≤–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ - –∞–∫–æ tooltip-—ä—Ç –±–∏ –∏–∑–ª—è–∑—ä–ª –∏–∑–≤—ä–Ω –µ–∫—Ä–∞–Ω–∞
                const tooltipLeftEdge = rect.left + (rect.width / 2) - (tooltipWidth / 2);
                const tooltipRightEdge = rect.left + (rect.width / 2) + (tooltipWidth / 2);
                
                console.log('Tooltip –±–∏ –±–∏–ª –º–µ–∂–¥—É:', tooltipLeftEdge, '–∏', tooltipRightEdge);
                
                // –ó–∞–¥–∞–≤–∞–º–µ –≤—Å–∏—á–∫–∏ —Å—Ç–∏–ª–æ–≤–µ inline
                tooltip.style.position = 'absolute';
                tooltip.style.bottom = '100%';
                tooltip.style.marginBottom = '10px';
                tooltip.style.background = 'white';
                tooltip.style.padding = '8px';
                tooltip.style.borderRadius = '8px';
                tooltip.style.boxShadow = '0 4px 12px rgba(0,0,0,0.2)';
                tooltip.style.border = '2px solid #007bff';
                tooltip.style.zIndex = '10000';
                tooltip.style.display = 'none';
                tooltip.style.width = '500px';
                tooltip.style.pointerEvents = 'none';
                
                // ÔøΩ?–∑—á–∏—Å–ª—è–≤–∞–º–µ –ø–æ–∑–∏—Ü–∏—è—Ç–∞ –≤ –ø–∏–∫—Å–µ–ª–∏
                const parentRect = event.target.getBoundingClientRect();
                const offsetParent = event.target.offsetParent || document.body;
                const offsetParentRect = offsetParent.getBoundingClientRect();
                
                // –û—Ç–Ω–æ—Å–∏—Ç–µ–ª–Ω–∞ –ø–æ–∑–∏—Ü–∏—è —Å–ø—Ä—è–º–æ —Ä–æ–¥–∏—Ç–µ–ª—è
                const relativeLeft = parentRect.left - offsetParentRect.left;
                const relativeWidth = parentRect.width;
                
                // –ê–∫–æ –ª—è–≤–∞—Ç–∞ —á–∞—Å—Ç –Ω–∞ tooltip-–∞ –±–∏ –±–∏–ª–∞ –∏–∑–≤—ä–Ω –µ–∫—Ä–∞–Ω–∞
                if (tooltipLeftEdge < 0) {
                    tooltip.style.cssText = 'left: 15px !important; right: auto !important;';
                    console.log('[TOOLTIP] –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–∞–Ω –Ω–∞ 15px –æ—Ç –ª–µ–≤–∏—è —Ä—ä–± (tooltipLeftEdge:', tooltipLeftEdge, ')');
                }
                // –ê–∫–æ –¥—è—Å–Ω–∞—Ç–∞ —á–∞—Å—Ç –Ω–∞ tooltip-–∞ –±–∏ –±–∏–ª–∞ –∏–∑–≤—ä–Ω –µ–∫—Ä–∞–Ω–∞
                else if (tooltipRightEdge > windowWidth) {
                    tooltip.style.cssText = 'left: auto !important; right: 10px !important;';
                    console.log('[TOOLTIP] –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–∞–Ω –æ—Ç –¥–µ—Å–Ω–∏—è —Ä—ä–± (tooltipRightEdge:', tooltipRightEdge, ')');
                }
                // –¶–µ–Ω—Ç—Ä–∞–ª–Ω–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–∞–Ω–µ —Å –º–∞–ª—ä–∫ offset –Ω–∞–¥—è—Å–Ω–æ
                else {
                    const centerPos = relativeLeft + (relativeWidth / 2) - (tooltipWidth / 2) + 10; // –°–∞–º–æ 10px offset
                    tooltip.style.cssText = `left: ${centerPos}px !important; right: auto !important;`;
                    console.log('[TOOLTIP] –¶–µ–Ω—Ç—Ä–∞–ª–Ω–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–∞–Ω –Ω–∞', centerPos, 'px (center + 10px offset)');
                }
                
                const img = document.createElement('img');
                img.src = finalPath || imagePath;
                img.style.maxWidth = '100%';
                img.style.height = 'auto';
                
                tooltip.appendChild(img);
                event.target.appendChild(tooltip);
                tooltip.style.display = 'block';
                
                console.log('Tooltip –ø–æ–∫–∞–∑–∞–Ω —Å –∫–ª–∞—Å–æ–≤–µ:', tooltip.className);
            });
        }

        // –°–∫—Ä–∏–≤–∞ tooltip
        function hideTooltip() {
            const tooltip = document.getElementById('imageTooltip');
            if (tooltip) {
                tooltip.remove();
            }
        }

        // –ü–æ–∫–∞–∑–≤–∞ modal —Å –≥–æ–ª—è–º–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∏ –∫–ª–∏–∫
        function showImageModal(name, imagePath) {
            const modal = document.getElementById('imageModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalImage = document.getElementById('modalImage');
            const noImageMessage = document.getElementById('noImageMessage');
            
            // –ü—Ä–µ–≤–µ–∂–¥–∞–º–µ –∏–º–µ—Ç–æ –∑–∞ –∑–∞–≥–ª–∞–≤–∏–µ—Ç–æ
            modalTitle.textContent = translateName(name);
            
            if (imagePath && imagePath.trim() !== '') {
                tryLoadImage(imagePath, function(success, finalPath) {
                    if (success) {
                        modalImage.src = finalPath || imagePath;
                        modalImage.style.display = 'block';
                        noImageMessage.style.display = 'none';
                    } else {
                        modalImage.style.display = 'none';
                        noImageMessage.innerHTML = '–ù—è–º–∞ –Ω–∞–ª–∏—á–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞ —Ç–æ–∑–∏ –µ–ª–µ–º–µ–Ω—Ç<br><br><small style="color: #007bff;">üí° –°—ä–≤–µ—Ç: –ü—Ä–æ–≤–µ—Ä–∏ –¥–∞–ª–∏ —Å–Ω–∏–º–∫–∞—Ç–∞ –µ –≤ –ø–∞–ø–∫–∞—Ç–∞ <code>images/</code></small>';
                        noImageMessage.style.display = 'block';
                    }
                });
            } else {
                modalImage.style.display = 'none';
                noImageMessage.innerHTML = '–ù—è–º–∞ —É–∫–∞–∑–∞–Ω –ø—ä—Ç –∫—ä–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ';
                noImageMessage.style.display = 'block';
            }
            
            modal.style.display = 'block';
        }

        // –ó–∞—Ç–≤–∞—Ä—è modal –ø—Ä–æ–∑–æ—Ä–µ—Ü–∞
        function closeImageModal() {
            document.getElementById('imageModal').style.display = 'none';
        }

        // –ó–∞—Ç–≤–∞—Ä—è–Ω–µ –Ω–∞ modal –ø—Ä–∏ –∫–ª–∏–∫–≤–∞–Ω–µ –∏–∑–≤—ä–Ω –Ω–µ–≥–æ
        window.onclick = function(event) {
            const modal = document.getElementById('imageModal');
            if (event.target == modal) {
                closeImageModal();
            }
        };

        // –ó–∞—Ç–≤–∞—Ä—è–Ω–µ –Ω–∞ modal —Å ESC –∫–ª–∞–≤–∏—à
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeImageModal();
            }
        });
    </script>

    <!-- Image Modal -->
    <div id="imageModal" class="image-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">ÔøΩ?–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</h3>
                <button class="close-btn" onclick="closeImageModal()">&times;</button>
            </div>
            <div class="modal-body">
                <img id="modalImage" src="" alt="ÔøΩ?–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –¥–µ—Ç–∞–π–ª">
                <div id="noImageMessage" class="no-image" style="display: none;">
                    –ù—è–º–∞ –Ω–∞–ª–∏—á–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞ —Ç–æ–∑–∏ –µ–ª–µ–º–µ–Ω—Ç
                </div>
            </div>
        </div>
    </div>

    <!-- Password Modal -->
    <div class="password-modal" id="passwordModal">
        <div class="password-modal-content">
            <div class="password-modal-header">
                <h2>üîê Admin —Ä–µ–∂–∏–º</h2>
                <button class="password-modal-close" onclick="closePasswordModal()">&times;</button>
            </div>
            <div class="password-modal-body">
                <p>–ú–æ–ª—è, –≤—ä–≤–µ–¥–µ—Ç–µ –ø–∞—Ä–æ–ª–∞—Ç–∞ –∑–∞ –¥–æ—Å—Ç—ä–ø –¥–æ –∞–¥–º–∏–Ω —Ä–µ–∂–∏–º:</p>
                <div class="password-input-group">
                    <input type="password" 
                           id="passwordInput" 
                           class="password-input" 
                           placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –ø–∞—Ä–æ–ª–∞..."
                           onkeypress="handlePasswordKeyPress(event)">
                    <div class="password-error" id="passwordError">
                        ‚ùå –ì—Ä–µ—à–Ω–∞ –ø–∞—Ä–æ–ª–∞. –ú–æ–ª—è, –æ–ø–∏—Ç–∞–π—Ç–µ –æ—Ç–Ω–æ–≤–æ.
                    </div>
                </div>
            </div>
            <div class="password-modal-footer">
                <button class="password-modal-button secondary" onclick="closePasswordModal()">–û—Ç–∫–∞–∂–∏</button>
                <button class="password-modal-button primary" onclick="validatePassword()">–í–ª–µ–∑</button>
            </div>
        </div>
    </div>
</body>
</html>
